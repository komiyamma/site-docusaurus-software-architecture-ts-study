# ç¬¬23ç« ã€€ã‚¨ãƒ©ãƒ¼è¨­è¨ˆâ‘¡ï¼šResultå‹ã§å¤±æ•—ã‚‚ä»•æ§˜ã«ã™ã‚‹ğŸ¯ğŸ“¦

![ç¬¬23ç« ã€€ã‚¨ãƒ©ãƒ¼è¨­è¨ˆâ‘¡ï¼šResultå‹ã§å¤±æ•—ã‚‚ä»•æ§˜ã«ã™ã‚‹ğŸ¯ğŸ“¦](./picture/invariants_ts_study_023_result_type.png)

ã“ã®ç« ã¯ã€ã€Œå¤±æ•—ãŒèµ·ãã¦ã‚‚ãƒ‘ãƒ‹ãƒƒã‚¯ã«ãªã‚‰ãªã„ã€ãŸã‚ã®ç« ã ã‚ˆã€œğŸ™‚âœ¨
ãƒã‚¤ãƒ³ãƒˆã¯ã“ã‚ŒğŸ‘‡

* **ä¾‹å¤–ï¼ˆthrowï¼‰ã«é ¼ã‚Šã™ããš**ã€äºˆæƒ³ã§ãã‚‹å¤±æ•—ã¯ **Resultã§è¿”ã™** ğŸ§¯
* å¤±æ•—ã®ç¨®é¡ï¼ˆã‚¨ãƒ©ãƒ¼å‹ï¼‰ã‚’ **å‹ã§å›ºå®š**ã—ã¦ã€**æ‰±ã„æ¼ã‚Œã‚’æ¸›ã‚‰ã™** ğŸ§ ğŸ”’
* ã€ŒVOã® `create()` ãŒ Result ã‚’è¿”ã™ã€ã¾ã§ã‚’å®Œæˆã•ã›ã‚‹ ğŸ§ªğŸ’

â€»2026-01-20 æ™‚ç‚¹ã§ã¯ TypeScript ã® npm æœ€æ–°ã¯ 5.9.3 ã§ã€6.0/7.0 ã¸å‘ã‘ãŸå‹•ãï¼ˆãƒã‚¤ãƒ†ã‚£ãƒ–åŒ–ãªã©ï¼‰ã‚‚é€²è¡Œä¸­ã ã‚ˆã€œğŸš€ ([NPM][1])

---

## 1) ãã‚‚ãã‚‚ã€Œä¾‹å¤–ã ã‘ã€ã ã¨ä½•ãŒå›°ã‚‹ã®ï¼ŸğŸ˜µâ€ğŸ’«ğŸ’¥

### ä¾‹å¤–ï¼ˆthrowï¼‰ã®ã¤ã‚‰ã„ã¨ã“ã‚

* **é–¢æ•°ã®å‹ã ã‘è¦‹ã¦ã‚‚å¤±æ•—ãŒåˆ†ã‹ã‚‰ãªã„**ï¼ˆæˆ»ã‚Šå€¤ã«å‡ºã¦ã“ãªã„ï¼‰ğŸ˜¶â€ğŸŒ«ï¸
* ã©ã“ã§ throw ã•ã‚Œã‚‹ã‹è¿½ã„ã«ããã¦ã€**try/catch ãŒæ•£ã‚‰ã°ã‚ŠãŒã¡**ğŸŒ€
* ã€Œæœ¬å½“ã¯äºˆæƒ³ã§ãã‚‹å¤±æ•—ã€ã¾ã§ä¾‹å¤–ã«ã™ã‚‹ã¨ã€**åˆ¶å¾¡ãƒ•ãƒ­ãƒ¼ãŒèª­ã¿ã«ãã„**ğŸ˜‡â¡ï¸ğŸ˜µ

ã‚‚ã¡ã‚ã‚“ä¾‹å¤–ãŒæ‚ªã„ã‚ã‘ã˜ã‚ƒãªãã¦ã­ğŸ‘‡

* **â€œæ™®é€šã«èµ·ã“ã‚Šã†ã‚‹å¤±æ•—â€**ï¼ˆå…¥åŠ›ãŒå¤‰ã€åœ¨åº«ä¸è¶³ã€æ¨©é™ãªã—ã€ãªã©ï¼‰ã¯ Result ã§è¿”ã™
* **â€œæƒ³å®šå¤–â€**ï¼ˆãƒã‚°ã€å£Šã‚ŒãŸçŠ¶æ…‹ã€åˆ°é”ã—ã¡ã‚ƒãƒ€ãƒ¡ï¼‰ã¯ä¾‹å¤–ã§è½ã¨ã™
  ã“ã® â€œä½ã¿åˆ†ã‘â€ ãŒè¶…å¤§äº‹ã€œğŸ™‚ğŸ§­âœ¨

```mermaid
flowchart LR
  Op["æ“ä½œ ğŸ§°"] --> Result{Result&lt;T, E&gt;}
  Result -- "Ok(value)" --> Success["æˆåŠŸãƒ«ãƒ¼ãƒˆ ğŸ”µ<br/>(æ¬¡ã®å‡¦ç†ã¸)"]
  Result -- "Err(error)" --> Failure["å¤±æ•—ãƒ«ãƒ¼ãƒˆ ğŸ”´<br/>(ä»•æ§˜ã¨ã—ã¦æ‰±ã†)"]
  
  Success -- andThen --> Next["æ¬¡ã®Result"]
```

---

## 2) Resultå‹ã£ã¦ãªã«ï¼Ÿï¼ˆè¶…ã–ã£ãã‚Šï¼‰ğŸ“¦âœ¨

Result ã¯ã€ŒæˆåŠŸ or å¤±æ•—ã€ã‚’**æˆ»ã‚Šå€¤ã§è¡¨ç¾ã™ã‚‹å‹**ã ã‚ˆğŸ™‚
Rust ã® `Result<T, E>` ã¨åŒã˜ãƒãƒªã§ã€TypeScript ã§ã‚‚ã‚ˆãä½¿ã‚ã‚Œã‚‹ã‚ˆã€œğŸ¦€â¡ï¸ğŸŸ¦

ãŸã¨ãˆã° `neverthrow` ã£ã¦ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã ã¨ã€æˆåŠŸã¯ `Ok`ã€å¤±æ•—ã¯ `Err` ã‚’ä½¿ã£ã¦è¡¨ã™ã‚ˆï¼ˆéåŒæœŸç”¨ã® `ResultAsync` ã‚‚ã‚ã‚‹ï¼‰ğŸ¤–âœ¨ ([GitHub][2])

---

## 3) ã¾ãšã¯ã€Œæœ€å°Resultã€ã‚’è‡ªä½œã—ã¦æ„Ÿè¦šã‚’ã¤ã‹ã‚‚ã†ğŸ§ªğŸ§±

æœ€åˆã¯è‡ªä½œã§OKï¼è¶…ãƒŸãƒ‹ç‰ˆã‚’ä½œã‚ã†ğŸ™‚âœ¨

```ts
// âœ… æœ€å° Resultï¼ˆdiscriminated unionï¼‰
export type Ok<T> = { readonly ok: true; readonly value: T };
export type Err<E> = { readonly ok: false; readonly error: E };
export type Result<T, E> = Ok<T> | Err<E>;

export const ok = <T>(value: T): Ok<T> => ({ ok: true, value });
export const err = <E>(error: E): Err<E> => ({ ok: false, error });

// âœ… åˆ†å²ã‚’å¼·åˆ¶ã™ã‚‹ãŸã‚ã® match
export const match = <T, E, R>(
  r: Result<T, E>,
  onOk: (v: T) => R,
  onErr: (e: E) => R
): R => (r.ok ? onOk(r.value) : onErr(r.error));
```

### ã“ã“ãŒæ°—æŒã¡ã„ã„ãƒã‚¤ãƒ³ãƒˆğŸ˜âœ¨

* `r.ok` ã§åˆ†å²ã™ã‚‹ã¨ã€**æˆåŠŸ/å¤±æ•—ã®ä¸­èº«ãŒå‹çš„ã«ç¢ºå®š**ã™ã‚‹
* ã€Œå¤±æ•—ã‚±ãƒ¼ã‚¹ã‚’æ›¸ãå¿˜ã‚Œã‚‹ã€äº‹æ•…ãŒæ¸›ã‚‹ğŸ¯

---

## 4) ã‚¨ãƒ©ãƒ¼ã‚‚ã€Œå‹ã€ã§å›ºå®šã—ã‚ˆã†ğŸ§ ğŸ”’

Result ã‚’ä½¿ã†ãªã‚‰ã€ã‚¨ãƒ©ãƒ¼ã‚‚ã€Œãªã‚“ã§ã‚‚Errorã€ã˜ã‚ƒãªãã¦ã€**ãƒ‰ãƒ¡ã‚¤ãƒ³ã«æ²¿ã£ãŸå‹**ã«ã—ã‚ˆğŸ™‚âœ¨
ï¼ˆç¬¬22ç« ã§ â€œåˆ†ã‹ã‚Šã‚„ã™ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸â€ ã‚’ä½œã£ãŸã‘ã©ã€ã“ã®ç« ã¯ â€œå¤±æ•—ã®ç¨®é¡ã‚’å‹ã«ã™ã‚‹â€ ã ã‚ˆğŸ«¶ï¼‰

### ä¾‹ï¼šEmailç”¨ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼

```ts
export type EmailError =
  | { readonly type: "Empty" }
  | { readonly type: "TooLong"; readonly max: number }
  | { readonly type: "InvalidFormat" };

const MAX_EMAIL_LEN = 254 as const;
```

* `type` ã‚’ã‚¿ã‚°ã«ã™ã‚‹ï¼ˆDiscriminated Unionï¼‰ã¨åˆ†å²ãŒå®‰å…¨ğŸ·ï¸âœ…
* UIå‘ã‘æ–‡è¨€ã¯ â€œåˆ¥ãƒ¬ã‚¤ãƒ¤ãƒ¼â€ ã§å¤‰æ›ã—ã¦OKï¼ˆç¬¬24ç« ã§ã‚„ã‚‹ã‚ˆï¼‰ğŸ”„ğŸ§­

---

## 5) VOã® `create()` ã‚’ Result ã«ã™ã‚‹ï¼ˆã“ã®ç« ã®ä¸»å½¹ï¼‰ğŸ’ğŸ› ï¸

### Email VOï¼ˆBranded/Opaqueé¢¨ã®ã‚„ã¤ï¼‰

```ts
declare const EmailBrand: unique symbol;

export type Email = string & { readonly [EmailBrand]: "Email" };

const normalizeEmail = (s: string) => s.trim().toLowerCase();

const isEmailFormat = (s: string) => {
  // è¶…ã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼ˆæœ¬æ°—ã®RFCã¯é‡ã„ã®ã§ã€å¢ƒç•Œã§ã»ã©ã»ã©ã«ã­ğŸ™‚ï¼‰
  return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s);
};

export const Email = {
  create(input: string): Result<Email, EmailError> {
    const v = normalizeEmail(input);

    if (v.length === 0) return err({ type: "Empty" });
    if (v.length > MAX_EMAIL_LEN) return err({ type: "TooLong", max: MAX_EMAIL_LEN });
    if (!isEmailFormat(v)) return err({ type: "InvalidFormat" });

    return ok(v as Email);
  },
} as const;
```

### ä½¿ã†å´ï¼štry/catch ã˜ã‚ƒãªãã€åˆ†å²ãŒ â€œè¦‹ãˆã‚‹â€ ğŸ˜Œâœ¨

```ts
const r = Email.create("  TEST@EXAMPLE.COM  ");

if (r.ok) {
  // r.value ã¯ Email å‹âœ¨
  console.log("email:", r.value);
} else {
  // r.error ã¯ EmailError å‹âœ¨
  console.log("error type:", r.error.type);
}
```

---

## 6) Result ã‚’ã€Œã¤ãªã’ã‚‹ã€ãŸã‚ã®é“å…·ï¼ˆmap / andThenï¼‰ğŸ§°ğŸ”—

Result ãŒä¾¿åˆ©ã«ãªã‚‹ã®ã¯ã€**é€£çµã§ãã‚‹**ã‹ã‚‰ã ã‚ˆğŸ™‚âœ¨
ï¼ˆneverthrow ã§ã‚‚ `map` / `andThen` ãŒé‡è¦ã£ã¦æ›¸ã‹ã‚Œã¦ã‚‹ã‚ˆï¼‰([GitHub][2])

### ã¾ãšã¯è‡ªä½œãƒ˜ãƒ«ãƒ‘ãƒ¼ï¼ˆè¶…ã‚ˆãä½¿ã†ï¼‰

```ts
export const map = <T, E, U>(
  r: Result<T, E>,
  f: (v: T) => U
): Result<U, E> => (r.ok ? ok(f(r.value)) : r);

export const andThen = <T, E, U, F>(
  r: Result<T, E>,
  f: (v: T) => Result<U, F>
): Result<U, E | F> => (r.ok ? f(r.value) : r);
```

### ä¾‹ï¼šEmail â†’ User ã‚’ä½œã‚‹ï¼ˆé€”ä¸­ã§å¤±æ•—ã—ãŸã‚‰æ­¢ã¾ã‚‹ï¼‰ğŸš¦ğŸ™‚

```ts
type UserError = { readonly type: "EmailInvalid"; readonly detail: EmailError };

type User = {
  readonly email: Email;
};

const createUser = (rawEmail: string): Result<User, UserError> =>
  andThen(Email.create(rawEmail), (email) =>
    ok({ email }) // æœ¬å½“ã¯ä»–VOã‚‚ã¾ã¨ã‚ã¦ä½œã‚‹ã‚ˆã­ğŸ™‚
  );
```

ã€ŒæˆåŠŸã ã‘æ¬¡ã¸é€²ã‚€ã€ã£ã¦ã„ã†èª­ã¿ã‚„ã™ã•ãŒå‡ºã‚‹ã®ãŒã€Resultã®å¼·ã¿ğŸ˜âœ¨

---

## 7) å¤±æ•—ã‚’ â€œãŸã‚ã¦è¿”ã™â€ ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆè»½ãè§¦ã‚Œã‚‹ï¼‰ğŸ§ºğŸ§¾

Result ã®åŸºæœ¬ã¯ã€Œå¤±æ•—ã—ãŸã‚‰ãã“ã§æ­¢ã¾ã‚‹ã€ã ã‘ã©ã€ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›ã¿ãŸã„ã«
**å…¨éƒ¨ã®ã‚¨ãƒ©ãƒ¼ã‚’é›†ã‚ãŸã„**ã“ã¨ã‚‚ã‚ã‚‹ã‚ˆã­ğŸ™‚ğŸ«¶

ã“ã“ã¯è¨­è¨ˆæ–¹é‡ã§å¤‰ã‚ã‚‹ã‘ã©ã€åˆå¿ƒè€…å‘ã‘ã«ã¯ã¾ãšğŸ‘‡ã§OKï¼

* **VOã® create ã¯ 1ã¤ã®å¤±æ•—ã§ Err ã‚’è¿”ã™**ï¼ˆå˜ä½“ã®è²¬å‹™ãŒæ˜ç¢ºï¼‰ğŸ’
* è¤‡æ•°é …ç›®ã®å…¥åŠ›ã¯ **å¢ƒç•Œï¼ˆã‚¹ã‚­ãƒ¼ãƒï¼‰å´ã§ã‚¨ãƒ©ãƒ¼ã‚’é›†ã‚ã‚‹**ï¼ˆç¬¬19ã€œ21ç« ã®æµã‚Œï¼‰ğŸ“âœ…

---

## 8) éåŒæœŸï¼ˆPromiseï¼‰ã§ Result ã‚’ä½¿ã†ã¨ãã®å‹ğŸ•’âš¡

éåŒæœŸã¯ã€Œä¾‹å¤–ãŒæ··ã–ã‚Šã‚„ã™ã„ã€ã‹ã‚‰ã€Result ãŒã•ã‚‰ã«åŠ¹ãã‚ˆğŸ™‚âœ¨
`neverthrow` ã ã¨ `ResultAsync` ãŒç”¨æ„ã•ã‚Œã¦ã‚‹ã‚ˆã€œ([GitHub][2])

è‡ªä½œæ´¾ãªã‚‰ â€œtry/catch ã‚’å¢ƒç•Œã§å¸ã†â€ ã ã‘ã§ã‚‚ååˆ†ğŸ‘

```ts
export const fromThrowable = async <T>(
  f: () => Promise<T>
): Promise<Result<T, unknown>> => {
  try {
    return ok(await f());
  } catch (e) {
    return err(e);
  }
};
```

* **throw ã‚’å¤–ã«æ¼ã‚‰ã•ãªã„**ã®ãŒã‚³ãƒ„ğŸ§¯
* è¿”ã™ã‚¨ãƒ©ãƒ¼å‹ã¯ `unknown` ã®ã¾ã¾ã§ã‚‚ã„ã„ã‘ã©ã€ã§ãã‚Œã°å¢ƒç•Œã§è‡ªå‰ã‚¨ãƒ©ãƒ¼ã«å¤‰æ›ï¼ˆæ¬¡ç« ï¼ï¼‰ğŸ”„âœ¨

---

## 9) ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã†ï¼Ÿè‡ªä½œã™ã‚‹ï¼Ÿã–ã£ãã‚ŠæŒ‡é‡ğŸ§­âœ¨

### âœ… åˆå­¦è€…ã«ãŠã™ã™ã‚

* **æœ€å°Resultã‚’è‡ªä½œ**ï¼ˆã“ã®ç« ã®ã‚³ãƒ¼ãƒ‰ï¼‰
  â†’ ä»•çµ„ã¿ãŒåˆ†ã‹ã‚‹ã—ã€å¿…è¦ãªæ©Ÿèƒ½ã ã‘ã«ã§ãã‚‹ğŸ™‚ğŸ§ª

### âœ… ã™ãå®Ÿæˆ¦ã§ä½¿ã„ãŸã„

* `neverthrow`ï¼šResult/ResultAsync ãŒã‚ã‚Šã€`andThen` ãªã©ãŒæƒã£ã¦ã‚‹ ([GitHub][2])

### âœ… FPã®ä¸–ç•Œã‚‚è¾¼ã¿ã§ã‚„ã‚ŠãŸã„ï¼ˆä¸Šç´šå¯„ã‚Šï¼‰

* `fp-ts` ã® `Either`ï¼ˆLeft/Rightï¼‰ ([gcanti.github.io][3])
* `Effect` ã‚‚ `Either` ã¯ã‚ã‚‹ã‘ã©ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€Œè©³ç´°ãªå¤±æ•—ã«ã¯ãƒ¡ã‚¤ãƒ³ç”¨é€”ã¨ã—ã¦æ¨å¥¨ã—ãªã„ã€ãƒ‹ãƒ¥ã‚¢ãƒ³ã‚¹ã‚‚ã‚ã‚‹ã‚ˆï¼ˆEffect ã§ã¯åˆ¥ã®çµæœè¡¨ç¾ãŒæ¨ã•ã‚Œã¦ã‚‹ï¼‰([effect.website][4])

---

## 10) AIæ´»ç”¨ãƒ†ãƒ³ãƒ—ãƒ¬ï¼ˆã“ã®ç« å‘ã‘ï¼‰ğŸ¤–ğŸ§ âœ¨

ã‚³ãƒ”ãƒšã§ä½¿ãˆã‚‹ã‚„ã¤ç½®ã„ã¨ãã­ğŸ‘‡ğŸ˜Š

* ã€Œã“ã® `Email.create` ãŒå¤±æ•—ã™ã‚‹å…¥åŠ›ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’20å€‹å‡ºã—ã¦ã€ğŸ§ª
* ã€Œ`EmailError` ã®è¨­è¨ˆãŒé›‘ã«ãªã‚ŠãŒã¡ãªç‚¹ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ã€ğŸ”
* ã€ŒResult ã‚’ä½¿ã£ãŸ `map/andThen` ã®å®Ÿè£…ã®è½ã¨ã—ç©´ã‚ã‚‹ï¼Ÿã€ğŸ§¯
* ã€Œå¢ƒç•Œå€¤ãƒ†ã‚¹ãƒˆï¼ˆç©º/æœ€å¤§é•·/ä¸æ­£å½¢å¼ï¼‰ã‚’ Vitest ã§æ›¸ã„ã¦ã€ğŸ§ªğŸ“

AIã¯ â€œç”Ÿæˆâ€ ã‚ˆã‚Š â€œæ¼ã‚Œæ¢ã—â€ ã§å¼·ã„ã‚ˆã€œğŸ’ªâœ¨

---

## 11) ãƒŸãƒ‹èª²é¡Œï¼ˆæ‰‹ã‚’å‹•ã‹ã™ã‚„ã¤ï¼‰ğŸ“âœ¨

### èª²é¡Œ1ï¼šVOã® create ã‚’ Result åŒ–ã™ã‚‹ğŸ’

* ä½•ã§ã‚‚ã„ã„ã‹ã‚‰VOã‚’1å€‹é¸ã¶ï¼ˆä¾‹ï¼š`UserId` / `Quantity` / `Money`ï¼‰ğŸ™‚
* `create(input)` ã‚’ `Result<VO, ErrorType>` ã«ã™ã‚‹âœ…

### èª²é¡Œ2ï¼šandThen ã§ â€œä¸€æœ¬ç·šâ€ ã‚’ä½œã‚‹ğŸ§µâœ¨

* `Email.create` â†’ `User.create` ã¿ãŸã„ã«ã€æˆåŠŸã ã‘é€²ã‚€æµã‚Œã‚’ä½œã‚‹

### èª²é¡Œ3ï¼šmatch ã§ UI ç”¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã™ã‚‹ğŸ«¶

* `EmailError` ã‚’å—ã‘å–ã£ã¦ã€åˆå¿ƒè€…ã§ã‚‚åˆ†ã‹ã‚‹æ–‡è¨€ã«å¤‰æ›ã™ã‚‹
  ï¼ˆç¬¬22ç« ã®å¾©ç¿’ã«ã‚‚ãªã‚‹ã‚ˆã€œğŸ™‚âœ¨ï¼‰

---

## 12) ã¾ã¨ã‚ï¼ˆã“ã®ç« ã§æŒã¡å¸°ã‚‹ã“ã¨ï¼‰ğŸğŸŒ¸

* **äºˆæƒ³ã§ãã‚‹å¤±æ•—ã¯ Result ã§è¿”ã™**ã¨ã€è¨­è¨ˆãŒè½ã¡ç€ãğŸ™‚ğŸ›¡ï¸
* **ã‚¨ãƒ©ãƒ¼å‹ã‚’ Union ã§å›ºå®š**ã™ã‚‹ã¨ã€æ‰±ã„æ¼ã‚ŒãŒæ¸›ã‚‹ğŸ·ï¸âœ…
* **VOã® `create()` ã‚’ Result åŒ–**ã§ãã‚Œã°ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ãŒä¸€æ°—ã«å¼·ããªã‚‹ğŸ’ğŸ”¥
* æ¬¡ã®ç¬¬24ç« ã§ã€Resultã®å¤±æ•—ã‚’ **å¢ƒç•Œã§â€œå±¤ã«åˆã‚ã›ã¦å¤‰æ›â€**ã—ã¦å®Œæˆåº¦ã‚’ä¸Šã’ã‚‹ã‚ˆã€œğŸ”„ğŸ§­âœ¨

[1]: https://www.npmjs.com/package/typescript?activeTab=versions&utm_source=chatgpt.com "typescript"
[2]: https://github.com/supermacro/neverthrow?utm_source=chatgpt.com "supermacro/neverthrow: Type-Safe Errors for JS & TypeScript"
[3]: https://gcanti.github.io/fp-ts/modules/Either.ts.html?utm_source=chatgpt.com "Either.ts | fp-ts"
[4]: https://effect.website/docs/data-types/either/?utm_source=chatgpt.com "Either"
