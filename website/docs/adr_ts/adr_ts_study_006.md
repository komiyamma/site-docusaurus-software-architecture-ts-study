# ç¬¬6ç« ï¼šæ›¸ãæ–¹â‘¡ Decisionï¼ˆçµè«–ï¼‰ã¯â€œä¸€æ–‡ã§è¨€ã„åˆ‡ã‚‹â€âœ¨ğŸ§ 

ADRã£ã¦ **ã€Œåˆ¤æ–­ã®ãƒ­ã‚°ã€** ã ã‹ã‚‰ã€çœŸã‚“ä¸­ã® **Decisionï¼ˆçµè«–ï¼‰** ãŒãƒ–ãƒ¬ã‚‹ã¨å…¨ä½“ãŒãƒ•ãƒ¯ãƒƒã¨ã—ã¡ã‚ƒã†ã‚“ã ã‚ˆã­ğŸ¥ºğŸ’¦
å®šç•ªã®æ§‹æˆï¼ˆContext / Decision / Consequencesï¼‰ã§ã‚‚ã€Decisionã¯â€œæ ¸â€ã¨ã—ã¦æ‰±ã‚ã‚Œã¾ã™ã€‚ ([Architectural Decision Records][1])

ã“ã®ç« ã§ã¯ã€**Decisionã‚’ã€Œä¸€æ–‡ã§ã‚ºãƒãƒƒã¨è¨€ã„åˆ‡ã‚‹ã€æ›¸ãæ–¹**ã‚’ã€TypeScriptã®ä¾‹ã§ã‚„ã•ã—ãç·´ç¿’ã—ã¦ã„ãã‚ˆã€œğŸ«¶âœ¨

---

## 1) Decisionã£ã¦ä½•ã‚’æ›¸ãå ´æ‰€ï¼ŸğŸ¤”ğŸ“

Decisionã¯ã€ã„ã¡ã°ã‚“å¤§äº‹ãªã“ã“ğŸ‘‡

* âœ… **ä½•ã‚’æ¡ç”¨ã™ã‚‹ã®ï¼Ÿ**ï¼ˆé¸ã‚“ã ã‚‚ã®ï¼‰
* âœ… **ã©ã“ã«é©ç”¨ã™ã‚‹ã®ï¼Ÿ**ï¼ˆã‚¹ã‚³ãƒ¼ãƒ—ï¼‰
* âœ… **ã„ã¤ã‹ã‚‰ï¼Ÿ**ï¼ˆé–‹å§‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼‰
* âœ… **ä¾‹å¤–ã‚ã‚‹ï¼Ÿ**ï¼ˆä¾‹å¤–ãƒ«ãƒ¼ãƒ«ï¼‰
* âœ… **â€œæ¡ç”¨ã—ãŸâ€ã£ã¦ã©ã†åˆ¤å®šã™ã‚‹ï¼Ÿ**ï¼ˆå—ã‘å…¥ã‚Œæ¡ä»¶ãƒ»è»½ãã§OKï¼‰

ADRã¯ã€Œåˆ¤æ–­ã®èƒŒæ™¯ã¨å½±éŸ¿ã€ã‚‚ã‚»ãƒƒãƒˆã§æ®‹ã™è€ƒãˆæ–¹ãŒã‚ˆãç´¹ä»‹ã•ã‚Œã¦ã‚‹ã®ã§ã€Decisionã ã‘ãŒé•·æ–‡ã«ãªã‚Šã™ããªã„ã®ãŒã‚³ãƒ„ã ã‚ˆğŸ˜‰ ([Microsoft Learn][2])

---

## 2) â€œä¸€æ–‡â€ã§è¨€ã„åˆ‡ã‚‹ãŸã‚ã®å‹ï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ï¼‰ğŸ§©âœ¨

![](./picture/adr_ts_study_006_strong_decision.png)

Decisionã®ä¸€æ–‡ã¯ã€ã ã„ãŸã„ã“ã®å½¢ãŒæœ€å¼·ğŸ’ªğŸ’•

**å‹Aï¼ˆã„ã¡ã°ã‚“åŸºæœ¬ï¼‰**

> We will **æ¡ç”¨ã™ã‚‹** X **ã‚’**ã€Y **ã®ãŸã‚ã«**ã€Z **ã®ç¯„å›²ã§**ã€‚

**å‹Bï¼ˆå¢ƒç•ŒãŒã‚ã‚‹åˆ¤æ–­ã«å¼·ã„ï¼‰**

> We will use X **at** boundary Y, and **not** use it inside Z.

**å‹Cï¼ˆé‹ç”¨ãƒ»ãƒ«ãƒ¼ãƒ«ç³»ã«å¼·ã„ï¼‰**

> We will enforce rule X by Y (lint/CI), starting from date Z.

æ—¥æœ¬èªã§ã‚‚OKã ã‚ˆğŸ‘‡

> ã€Œç§ãŸã¡ã¯ **Xã‚’æ¡ç”¨ã™ã‚‹**ï¼ˆå¯¾è±¡ï¼šYã€é–‹å§‹ï¼šZã€ä¾‹å¤–ï¼šâ€¦ï¼‰ã€

### ğŸ§  ä¸€æ–‡ã‚’å¼·ãã™ã‚‹â€œå‹•è©â€ãƒªã‚¹ãƒˆ

* âœ… use / adopt / standardize / enforce / deprecate / forbid / require
* âŒ consider / maybe / try / should / mightï¼ˆã¼ã‚“ã‚„ã‚Šãƒ¯ãƒ¼ãƒ‰ï¼‰

---

## 3) Decisionä¸€æ–‡ + â€œæ·»ãˆç‰©3ç‚¹ã‚»ãƒƒãƒˆâ€ã§ãƒ—ãƒ­ã£ã½ããªã‚‹ğŸ€

![](./picture/adr_ts_study_006_decision_package.png)

Decisionã¯ä¸€æ–‡ã§OKãªã‚“ã ã‘ã©ã€**ãã®ç›´ä¸‹ã«3ã¤ã ã‘**æ·»ãˆã‚‹ã¨ã€æ€¥ã«ã€Œé‹ç”¨ã§ãã‚‹ADRã€ã«ãªã‚‹ã‚ˆğŸ˜³âœ¨

### âœ… æ·»ãˆç‰©â‘  ã‚¹ã‚³ãƒ¼ãƒ—ï¼ˆã©ã“ã¾ã§ï¼Ÿï¼‰

* ä¾‹ï¼š`packages/api` ã®ã¿ / å¤–éƒ¨å…¥åŠ›ã®å¢ƒç•Œã®ã¿ / æ–°è¦ã‚³ãƒ¼ãƒ‰ã‹ã‚‰

### âœ… æ·»ãˆç‰©â‘¡ ä¾‹å¤–ï¼ˆã‚„ã‚‰ãªã„æ¡ä»¶ï¼‰

* ä¾‹ï¼šPoCã¯é™¤å¤– / æ—¢å­˜ã®ãƒ¬ã‚¬ã‚·ãƒ¼éƒ¨åˆ†ã¯æ®µéšç§»è¡Œ

### âœ… æ·»ãˆç‰©â‘¢ å—ã‘å…¥ã‚Œæ¡ä»¶ï¼ˆã“ã‚Œæº€ãŸã—ãŸã‚‰OKï¼‰

* ä¾‹ï¼šCIã§å‹ãƒã‚§ãƒƒã‚¯å¿…é ˆ / lintãŒé€šã‚‹ / æ—¢å­˜ãƒ†ã‚¹ãƒˆãŒè½ã¡ãªã„

---

## 4) â€œå¼±ã„Decisionâ€â†’â€œå¼·ã„Decisionâ€ æ›¸ãæ¯”ã¹ğŸ’¡âœï¸

### âŒ å¼±ã„ä¾‹ï¼ˆãµã‚ãµã‚ğŸ˜µâ€ğŸ’«ï¼‰

* ã€Œå…¥åŠ›ãƒã‚§ãƒƒã‚¯ã¯zodã¨ã‹ä½¿ã†ã‹ã‚‚ã€
* ã€ŒçŠ¶æ…‹ç®¡ç†ã¯è»½ã‚ã«ã—ãŸã„ã€
* ã€Œã‚¨ãƒ©ãƒ¼ã¯ã„ã„æ„Ÿã˜ã«çµ±ä¸€ã™ã‚‹ã€

ğŸ‘†ã“ã‚Œã€èª­ã‚€äººãŒã€Œã§ã€çµå±€ã©ã†ã™ã‚‹ã®ï¼Ÿã€ã£ã¦ãªã‚‹ã‚„ã¤ğŸ¥º

### âœ… å¼·ã„ä¾‹ï¼ˆè¨€ã„åˆ‡ã‚Šâœ¨ï¼‰

* ã€ŒWe will use **Zod** for **runtime validation** of **external inputs at API boundaries**.ã€
* ã€ŒWe will standardize client state management on **TanStack Query** for server state, and **avoid global state** unless needed.ã€
* ã€ŒWe will represent recoverable errors as **Result-like objects** (no throwing) in domain logic, and throw only at boundaries.ã€

---

## 5) TypeScriptã§ã‚ã‚ŠãŒã¡ãªDecisionãƒ†ãƒ¼ãƒä¾‹ï¼ˆãã®ã¾ã¾ä½¿ãˆã‚‹ï¼‰ğŸ¯ğŸ’•

![](./picture/adr_ts_study_006_ts_decision_topics.png)

Decisionã®é¡Œæã€TSã ã¨ã“ã®ã¸ã‚“ãŒâ€œADRå‘ãâ€ã«ãªã‚Šã‚„ã™ã„ã‚ˆã€œğŸ§

* ğŸ” **runtime validation**ï¼šZod / Valibot / è‡ªå‰â€¦ã©ã‚Œï¼Ÿ
* ğŸ§µ **ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ–¹é‡**ï¼šESMåŸºæº–ï¼ŸCJSæ··åœ¨ã©ã†ã™ã‚‹ï¼Ÿ
* ğŸ§ª **å‹ãƒã‚§ãƒƒã‚¯é‹ç”¨**ï¼š`tsc --noEmit` ã‚’CIå¿…é ˆï¼Ÿã„ã¤ã‹ã‚‰ï¼Ÿ
* ğŸ§¹ **lint/format**ï¼šESLint/Prettierã®ãƒ«ãƒ¼ãƒ«ãƒ»ä¾‹å¤–
* ğŸ§± **ã‚¢ãƒ¼ã‚­å±¤ã®å¢ƒç•Œ**ï¼šdomainã«ä¾å­˜ã‚’å…¥ã‚Œã¦ã„ã„ï¼Ÿãƒ€ãƒ¡ï¼Ÿ
* ğŸš€ **æ–°æ©Ÿèƒ½ã®æ¡ç”¨**ï¼šæ–°ã—ã„TSæ§‹æ–‡ã‚’ä½¿ã†ï¼Ÿï¼ˆæ¡ç”¨ç¯„å›²ã©ã†ã™ã‚‹ï¼Ÿï¼‰

ï¼ˆã¡ãªã¿ã«ã€TypeScriptã¯2025å¹´10æœˆã«5.9ç³»ã®ãƒªãƒªãƒ¼ã‚¹ãŒå‡ºã¦ã„ã¦ã€è¨€èªæ©Ÿèƒ½ã‚‚å¢—ãˆã¦ã‚‹ã®ã§ã€Œæ–°æ©Ÿèƒ½ã‚’æ¡ç”¨ã™ã‚‹/ã—ãªã„ã€ã‚‚åˆ¤æ–­ãƒã‚¿ã«ãªã‚ŠãŒã¡ã ã‚ˆğŸ§ ï¼‰ ([TypeScript][3])

---

## 6) â€œDecisionã‚»ã‚¯ã‚·ãƒ§ãƒ³â€ã®å®Œæˆå½¢ã‚µãƒ³ãƒ—ãƒ«ï¼ˆã‚³ãƒ”ãƒšOKï¼‰ğŸ“âœ¨

```md
### Decision
We will use Zod for runtime validation of external inputs at API boundaries.

- Scope: All new endpoints in `apps/api` starting 2026-01-XX.
- Exceptions: Internal-only modules may skip validation if inputs are fully typed and not user-controlled.
- Acceptance criteria:
  - Validation schemas exist for every request/response DTO at the boundary.
  - CI runs `pnpm typecheck` and fails on TS errors.
```

ãƒã‚¤ãƒ³ãƒˆã¯ã“ã‚ŒğŸ‘‡

* Decisionã¯ **1æ–‡** âœ…
* ä¸‹ã®ç®‡æ¡æ›¸ãã¯ **çŸ­ã** âœ…ï¼ˆé•·æ–‡ã«ã—ãªã„ï¼ï¼‰

---

## 7) AIã§Decisionã‚’â€œå¼·ãã™ã‚‹â€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆé›†ğŸ¤–âœ¨

Decisionã£ã¦ã€æ›¸ã„ãŸæœ¬äººã¯ã€Œä¼ã‚ã£ã¦ã‚‹ã¤ã‚‚ã‚Šã€ã«ãªã‚ŠãŒã¡ğŸ˜‚
AIã«ãƒã‚§ãƒƒã‚¯ã•ã›ã‚‹ã¨è¶…ãƒ©ã‚¯ã ã‚ˆã€œğŸ’•

### ğŸª„ 1æ–‡ã«åœ§ç¸®ã—ã¦ã‚‚ã‚‰ã†

```text
æ¬¡ã®Decisionæ–‡ã‚’ã€Œæ›–æ˜§ã•ã‚¼ãƒ­ã®ä¸€æ–‡ã€ã«ç›´ã—ã¦ã€‚
- ã€œã‹ã‚‚ï¼æ¤œè¨ï¼ã„ã„æ„Ÿã˜ ã‚’ç¦æ­¢
- ä½•ã‚’ã€ã©ã“ã«ã€ã„ã¤ã‹ã‚‰ ã‚’å…¥ã‚Œã¦
æ–‡ç« ï¼š<ã“ã“ã«ä¸‹æ›¸ã>
```

### ğŸ§· ã‚¹ã‚³ãƒ¼ãƒ—ã¨ä¾‹å¤–ã‚’æ´—ã„å‡ºã™

```text
ã“ã®Decisionã®ã‚¹ã‚³ãƒ¼ãƒ—ï¼ˆé©ç”¨ç¯„å›²ï¼‰ã¨ä¾‹å¤–ï¼ˆé©ç”¨ã—ãªã„æ¡ä»¶ï¼‰ã‚’3ã¤ãšã¤ææ¡ˆã—ã¦ã€‚
Decisionï¼š<ã“ã“ã«ä¸€æ–‡>
```

### ğŸ¯ å—ã‘å…¥ã‚Œæ¡ä»¶ã‚’ä½œã‚‹

```text
ã“ã®DecisionãŒã€Œæ¡ç”¨ã•ã‚ŒãŸã€ã¨è¨€ãˆã‚‹å—ã‘å…¥ã‚Œæ¡ä»¶ã‚’ã€CIã‚„ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ç¢ºèªã§ãã‚‹å½¢ã§5ã¤å‡ºã—ã¦ã€‚
Decisionï¼š<ã“ã“ã«ä¸€æ–‡>
```

---

## 8) ãƒ¯ãƒ¼ã‚¯ï¼ˆæ‰‹ã‚’å‹•ã‹ã™ã‚„ã¤ğŸ’ªâœ¨ï¼‰

### ğŸ§ª ãƒ¯ãƒ¼ã‚¯1ï¼šå¼±â†’å¼· ãƒªãƒ©ã‚¤ãƒˆï¼ˆ5åˆ†ï¼‰â±ï¸

æ¬¡ã®å¼±ã„Decisionã‚’ã€å¼·ã„ä¸€æ–‡ã«ã—ã¦ã­âœï¸ğŸ’•

1. ã€Œå…¥åŠ›ãƒã‚§ãƒƒã‚¯ã¯ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä½¿ã†ã€
2. ã€Œå‹ã¯å³ã—ã‚ã«ã™ã‚‹ã€
3. ã€ŒAPIå‘¼ã³å‡ºã—ã¯å…±é€šåŒ–ã—ãŸã„ã€

ğŸ’¡ãƒ’ãƒ³ãƒˆï¼šã€ŒWe will use/adopt/enforceâ€¦ã€ã‹ã‚‰å§‹ã‚ã‚‹ã¨å‹ã¡ğŸ†

### ğŸ§ª ãƒ¯ãƒ¼ã‚¯2ï¼šDecisionã«â€œ3ç‚¹ã‚»ãƒƒãƒˆâ€ã‚’è¶³ã™ï¼ˆ5åˆ†ï¼‰ğŸ§

ãƒ¯ãƒ¼ã‚¯1ã§ä½œã£ãŸä¸€æ–‡ã«ã€

* Scope
* Exceptions
* Acceptance criteriaï¼ˆ3ã¤ã§OKï¼‰
  ã‚’è¶³ã—ã¦å®Œæˆã€œğŸ‰

---

## 9) Decisionã‚»ãƒ«ãƒ•ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆâœ…ğŸ§ 

æ›¸ã„ãŸã‚‰æœ€å¾Œã«ã“ã‚Œã ã‘è¦‹ã¦ã­ğŸ‘€âœ¨

* âœ… â€œä¸€æ–‡â€ã ã‘èª­ã‚“ã§ã‚‚ã€ã‚„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚‹
* âœ… ã€Œä½•ã‚’ã€ã€Œã©ã“ã«ã€ã€Œã„ã¤ã‹ã‚‰ã€ãŒã‚ã‚‹
* âœ… ä¾‹å¤–ãŒã‚ã‚‹ãªã‚‰æ›¸ã„ãŸï¼ˆãªã„ãªã‚‰ç„¡ç†ã«ä½œã‚‰ãªãã¦OKï¼‰
* âœ… å—ã‘å…¥ã‚Œæ¡ä»¶ãŒâ€œç¢ºèªã§ãã‚‹å½¢â€ã«ãªã£ã¦ã‚‹
* âœ… â€œã‹ã‚‚/æ¤œè¨/ã„ã„æ„Ÿã˜â€ãŒã‚¼ãƒ­ğŸ˜ˆâŒ

```mermaid
flowchart TD
    Start["Decisionæ›¸ã„ãŸâœï¸"] --> Check1{"ä¸€æ–‡ã§æ„å‘³ã‚ã‹ã‚‹ï¼Ÿ"}
    Check1 -- Yes --> Check2{"ä½•/ã©ã“/ã„ã¤ãŒã‚ã‚‹ï¼Ÿ"}
    Check1 -- No --> Fix1["ä¸€æ–‡ã«ç›´ã—ã¦ï¼"]
    Check2 -- Yes --> Check3{"æ›–æ˜§ãƒ¯ãƒ¼ãƒ‰ãªã—ï¼Ÿ"}
    Check2 -- No --> Fix2["5W1Hã‚’å…¥ã‚Œã¦ï¼"]
    Check3 -- Yes --> Check4{"å—ã‘å…¥ã‚Œæ¡ä»¶ã‚ã‚‹ï¼Ÿ"}
    Check3 -- No --> Fix3["ã‹ã‚‚/æ¤œè¨ç¦æ­¢ğŸ‘¿"]
    Check4 -- Yes --> OK["æœ€å¼·Decisionå®ŒæˆğŸ‰"]
```

---

æ¬¡ã®ç« ï¼ˆç¬¬7ç« ï¼‰ã¯ã€Decisionã®ä¾¡å€¤ã‚’çˆ†ä¸Šã’ã™ã‚‹ **Consequencesï¼ˆçµæœï¼‰** ã«è¡Œãã‚ˆã€œğŸ’âœ¨
ã€Œãƒ¡ãƒªãƒƒãƒˆã ã‘ä½œæ–‡ã€ã‹ã‚‰å’æ¥­ã™ã‚‹å›ã ã‚ˆğŸ˜‰ğŸ’•

[1]: https://adr.github.io/adr-templates/?utm_source=chatgpt.com "ADR Templates | Architectural Decision Records"
[2]: https://learn.microsoft.com/en-us/azure/well-architected/architect-role/architecture-decision-record?utm_source=chatgpt.com "Maintain an architecture decision record (ADR)"
[3]: https://www.typescriptlang.org/docs/handbook/release-notes/typescript-5-9.html?utm_source=chatgpt.com "Documentation - TypeScript 5.9"
