# ç¬¬8ç« ï¼šçŠ¶æ…‹é·ç§»å›³ï¼ˆState Diagramï¼‰ã§ç›´æ„Ÿã‚’å¼·åŒ–ğŸ§­âœ¨

ã“ã®ç« ã¯ã€ŒçŸ¢å°ã§è¦‹ãŸç¬é–“ã«ã‚ã‹ã‚‹ï¼ã€ã‚’ä½œã‚‹å›ã§ã™ğŸ˜Š
æ–‡ç« ã‚„é·ç§»è¡¨ï¼ˆè¡¨ï¼‰ã ã‘ã ã¨ã€ã©ã†ã—ã¦ã‚‚ â€œå…¨ä½“ã®æµã‚Œâ€ ãŒé ­ã«å…¥ã‚Šã«ãã„ã‚“ã ã‚ˆã­â€¦ğŸ’­
ãã“ã§ **çŠ¶æ…‹é·ç§»å›³**ï¼ˆä¸¸ã¨çŸ¢å°ã®å›³ï¼‰ã‚’æã„ã¦ã€ç†è§£ã¨ãƒ¬ãƒ“ãƒ¥ãƒ¼é€Ÿåº¦ã‚’ä¸€æ°—ã«ä¸Šã’ã¾ã™ğŸš€ğŸ’•

---

## 8.1 çŠ¶æ…‹é·ç§»å›³ã£ã¦ã€ä½•ãŒã†ã‚Œã—ã„ã®ï¼ŸğŸ˜³âœ¨

![State Diagram](./picture/state_machine_ts_study_008_state_diagram.png)

çŠ¶æ…‹é·ç§»å›³ãŒã‚ã‚‹ã¨ã€ã“ã‚“ãªè‰¯ã„ã“ã¨ãŒèµ·ãã¾ã™ğŸ‘‡

* **å…¨ä½“ã®ãƒ«ãƒ¼ãƒˆãŒä¸€ç™ºã§è¦‹ãˆã‚‹**ğŸ‘€ï¼ˆæˆåŠŸãƒ«ãƒ¼ãƒˆï¼å¤±æ•—ãƒ«ãƒ¼ãƒˆï¼æˆ»ã‚Šé“ï¼‰
* **ã€ŒæŠœã‘ã€ã‚„ã€Œå¤‰ãªçŸ¢å°ã€ãŒç›®ã§è¦‹ã¤ã‹ã‚‹**ğŸ”ï¼ˆå­¤ç«‹çŠ¶æ…‹ã€æˆ»ã‚Œãªã„çŠ¶æ…‹ãªã©ï¼‰
* **ãƒãƒ¼ãƒ ã§ä¼šè©±ã—ã‚„ã™ã„**ğŸ—£ï¸ï¼ˆâ€œã“ã®çŸ¢å°ã„ã‚‰ãªããªã„ï¼Ÿâ€ ãŒã™ãè¨€ãˆã‚‹ï¼‰
* **å¾Œã‹ã‚‰ä»•æ§˜ãŒå¢—ãˆã¦ã‚‚å´©ã‚Œã«ãã„**ğŸ—ï¸ï¼ˆå›³ã‚’ç›´ã›ã°å½±éŸ¿ç¯„å›²ãŒè¦‹ãˆã‚‹ï¼‰

ãã—ã¦é‡è¦ãƒã‚¤ãƒ³ãƒˆğŸ‘‡
çŠ¶æ…‹é·ç§»å›³ã¯ã€ŒãŠçµµæãã€ã˜ã‚ƒãªãã¦ã€**ä»•æ§˜ã®åœ§ç¸®è¡¨ç¤º**ã§ã™ğŸ“Œâœ¨
ï¼ˆé·ç§»è¡¨ã¨åŒã˜æƒ…å ±ã‚’ã€è„³ã«å„ªã—ã„å½¢ã§ä¸¦ã¹ã‚‹â€¦ã¿ãŸã„ãªï¼ğŸ§ ğŸ’—ï¼‰

---

## 8.2 ã„ããªã‚Šæã‹ãªã„ï¼é·ç§»è¡¨â†’é·ç§»å›³ã®å¤‰æ›æ‰‹é †ğŸ“‹â¡ï¸ğŸ—ºï¸

ãŠã™ã™ã‚æ‰‹é †ã¯ã“ã‚Œã§ã™ğŸ˜Šâœ¨

1. **çŠ¶æ…‹ã‚’ç¢ºå®š**ï¼ˆä¸¸ã®å€™è£œï¼‰ğŸŸ¦
2. **ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç¢ºå®š**ï¼ˆçŸ¢å°ã®ãƒ©ãƒ™ãƒ«ï¼‰ğŸ·ï¸
3. **é·ç§»è¡¨ã‚’ v1 ã§ä½œã‚‹**ï¼ˆç©´ãŒã‚ã£ã¦OKï¼‰ğŸ“‹
4. **é·ç§»è¡¨ã‚’ãã®ã¾ã¾å›³ã«å†™ã™**ï¼ˆ1ã‚»ãƒ«=1æœ¬ã®çŸ¢å°ï¼‰â¡ï¸
5. **å›³ã‚’è¦‹ã¦ã€Œæ°—æŒã¡æ‚ªã„ã¨ã“ã‚ã€ã‚’ç›´ã™**ï¼ˆæˆ»ã‚Œãªã„ãƒ»åˆ†å²ãŒå¤‰ãªã©ï¼‰ğŸ› ï¸

> ã‚³ãƒ„ï¼š**å›³ã§æ‚©ã‚€ã‚ˆã‚Šã€è¡¨ã‚’å›³ã«â€œå†™çµŒâ€**ãŒæœ€çŸ­ã§ã™âœï¸ğŸ˜Š

```mermaid
flowchart TD
    Table["é·ç§»è¡¨ (å…¨ãƒã‚¹åŸ‹ã¾ã£ãŸçŠ¶æ…‹)"] -- "1ã‚»ãƒ« = 1çŸ¢å° ã¨ã—ã¦å†™ã™" --> Diagram["çŠ¶æ…‹é·ç§»å›³ (Mermaid)"]
    Diagram --> Audit["å›³ã‚’è¦‹ã¦çŸ›ç›¾ã«æ°—ã¥ã ğŸ‘€"]
    Audit --> Fix["ä»•æ§˜ã‚„è¡¨ã‚’ä¿®æ­£ã™ã‚‹ ğŸ› ï¸"]
    Fix --> Table
```


---

## 8.3 VS Codeã§æããªã‚‰ã€ã©ã‚ŒãŒæ¥½ï¼ŸğŸ§°âœ¨

ã“ã®ç« ã§ã¯ã€Œã™ãæã‘ã¦ã€è²¼ã‚Œã¦ã€å…±æœ‰ã—ã‚„ã™ã„ã€ã‚’å„ªå…ˆã—ã¾ã™ğŸ’•

### â‘  Mermaidï¼ˆã„ã¡ã°ã‚“æ‰‹è»½ï¼‰ğŸ§œâ€â™€ï¸âœ¨

Markdownã«ãƒ†ã‚­ã‚¹ãƒˆã§æ›¸ã‘ã¦ã€ãã®ã¾ã¾ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ãã¾ã™ã€‚
VS Codeæ‹¡å¼µã€ŒMarkdown Preview Mermaid Supportã€ã¯ **Mermaid 11.12.0 å¯¾å¿œ**ã¨æ˜è¨˜ã•ã‚Œã¦ã„ã¾ã™ğŸ“Œ ([Visual Studio Marketplace][1])
Mermaidã®çŠ¶æ…‹é·ç§»å›³ã¯ `stateDiagram-v2` ã‚’ä½¿ã„ã¾ã™ğŸ§­ ([mermaid.ai][2])

### â‘¡ PlantUMLï¼ˆUMLã£ã½ãã—ãŸã„æ´¾ï¼‰ğŸŒ¿

VS Codeæ‹¡å¼µã€ŒPlantUMLã€ãŒæœ‰åã§ã€ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚„ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ğŸ–¼ï¸ ([Visual Studio Marketplace][3])

### â‘¢ XState Inspectorï¼ˆå‹•ã‹ã—ãªãŒã‚‰å›³ã‚’è¦‹ã‚‹æ´¾ï¼‰ğŸ”âš¡

ã‚ã¨ã§å®Ÿè£…ã«å…¥ã‚‹ã¨ã€Œå®Ÿè¡Œä¸­ã®çŠ¶æ…‹ãŒå…‰ã‚‹ã€ã¿ãŸã„ãªå¯è¦–åŒ–ãŒã§ãã¾ã™âœ¨
Inspector ã¯ statecharts.io ã§æä¾›ã•ã‚Œã¦ã„ã¾ã™ğŸ§© ([statecharts.io][4])

ã“ã®ç« ã®ãƒãƒ³ã‚ºã‚ªãƒ³ã¯ **Mermaidã§ã„ãã¾ã™**ğŸ§œâ€â™€ï¸ğŸ’•

---

## 8.4 Mermaidã§ã€Œãƒ‰ã‚¢çŠ¶æ…‹æ©Ÿæ¢°ã€ã‚’å›³ã«ã™ã‚‹ğŸšªâ¡ï¸âœ¨

### âœ… ã¾ãšã¯é¡Œæï¼ˆè¶…ãƒŸãƒ‹ï¼‰

çŠ¶æ…‹ï¼š`Closed / Open / Locked`
ã‚¤ãƒ™ãƒ³ãƒˆï¼š`open / close / lock / unlock`

### âœ… Mermaidã®çŠ¶æ…‹é·ç§»å›³ã‚³ãƒ¼ãƒ‰ï¼ˆã‚³ãƒ”ãƒšOKï¼‰âœï¸

```mermaid
stateDiagram-v2
  [*] --> Closed

  Closed --> Open: open
  Open --> Closed: close

  Closed --> Locked: lock
  Locked --> Closed: unlock

  Locked --> Locked: lockï¼ˆç„¡åŠ¹ã ã‘ã©æŠ¼ã›ã¡ã‚ƒã£ãŸï¼‰
```

Mermaidã§ã¯é–‹å§‹/çµ‚äº†ã« `[*]` ã‚’ä½¿ãˆã¾ã™ğŸ§­ ([mermaid.ai][2])

#### ğŸ‘€ å›³ã«ã—ãŸç¬é–“ã«è¦‹ãˆã‚‹ã“ã¨

* `Locked --> Locked` ãŒ **å¤‰**ã‹ã‚‚ï¼ŸğŸ˜³
  â†’ ã€Œç„¡åŠ¹ã‚¤ãƒ™ãƒ³ãƒˆã¯â€œç„¡è¦–â€ã«ã™ã‚‹ï¼Ÿâ€œã‚¨ãƒ©ãƒ¼â€ã«ã™ã‚‹ï¼Ÿâ€œãƒ­ã‚°â€ã«ã™ã‚‹ï¼Ÿã€ã£ã¦è­°è«–ãŒç”Ÿã¾ã‚Œã¾ã™ğŸ§¯âœ¨
* `Open` ã‹ã‚‰ `lock` ã§ããªã„ã®ãŒä»•æ§˜ãªã‚‰ã€**ç¦æ­¢é·ç§»**ã¨ã—ã¦æ‰±ã„æ–¹ã‚’æ±ºã‚ã‚‹å¿…è¦ãŒã‚ã‚‹ğŸ‘®â€â™€ï¸

---

## 8.5 VS Codeã§ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹æ‰‹é †ï¼ˆMermaidï¼‰ğŸª„

ã‚„ã‚‹ã“ã¨ã¯ã“ã‚Œã ã‘ğŸ˜Š

1. æ‹¡å¼µæ©Ÿèƒ½ã§ **â€œMarkdown Preview Mermaid Supportâ€** ã‚’å…¥ã‚Œã‚‹ğŸ“¦ ([Visual Studio Marketplace][1])
2. `state-diagram.md` ã‚’ä½œã‚‹ğŸ“
3. ã•ã£ãã® `mermaid` ãƒ–ãƒ­ãƒƒã‚¯ã‚’è²¼ã‚‹âœï¸
4. Markdownãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’é–‹ãï¼ˆå³ä¸Šã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ï¼‰ğŸ‘€âœ¨

> ã“ã‚Œã§ â€œå›³ãŒè‡ªå‹•ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°â€ ã•ã‚Œã¾ã™ğŸ‰

---

## 8.6 å›³ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆâœ…ğŸ•µï¸â€â™€ï¸

çŠ¶æ…‹é·ç§»å›³ã‚’è¦‹ãŸã‚‰ã€ã“ã“ã‚’æ©Ÿæ¢°çš„ã«ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã¨å¼·ã„ã§ã™ğŸ’ªâœ¨

### çŠ¶æ…‹ï¼ˆä¸¸ï¼‰ã®ãƒã‚§ãƒƒã‚¯ğŸŸ¦

* å­¤ç«‹ã—ã¦ãªã„ï¼Ÿï¼ˆçŸ¢å°ãŒ1æœ¬ã‚‚ãªã„çŠ¶æ…‹ï¼‰ğŸï¸
* å…¥ã£ã¦ãã‚‹çŸ¢å°ãŒãªã„çŠ¶æ…‹ãŒã‚ã‚‹ï¼Ÿï¼ˆåˆ°é”ä¸èƒ½ï¼‰ğŸš«
* å‡ºã¦ã„ãçŸ¢å°ãŒãªã„çŠ¶æ…‹ãŒã‚ã‚‹ï¼Ÿï¼ˆè©°ã¿çŠ¶æ…‹ï¼‰ğŸ§±
* â€œçµ‚ç«¯â€ ã‚’ä½œã‚‹ãªã‚‰ã€ã¡ã‚ƒã‚“ã¨çµ‚ç«¯ã£ã½ã„ï¼Ÿï¼ˆSuccess/Cancelledãªã©ï¼‰ğŸ

### é·ç§»ï¼ˆçŸ¢å°ï¼‰ã®ãƒã‚§ãƒƒã‚¯â¡ï¸

* ã‚¤ãƒ™ãƒ³ãƒˆåãŒãƒãƒ©ã‘ã¦ãªã„ï¼Ÿï¼ˆ`submit` ã¨ `send` ã¨ `post` ãŒæ··åœ¨ğŸ˜µâ€ğŸ’«ï¼‰
* åŒã˜ã‚¤ãƒ™ãƒ³ãƒˆãŒçŠ¶æ…‹ã”ã¨ã«æ„å‘³å¤‰ã‚ã£ã¦ãªã„ï¼Ÿï¼ˆ`click` ãŒå…¨éƒ¨é•ã†å‹•ãâ€¦ï¼‰ğŸŒ€
* æˆ»ã‚Šé“ã¯ã‚ã‚‹ï¼Ÿï¼ˆErrorã‹ã‚‰ã©ã†å¾©æ—§ã™ã‚‹ï¼Ÿï¼‰ğŸ”

---

## 8.7 ã‚ˆãã‚ã‚‹å¤±æ•—ã‚ã‚‹ã‚ã‚‹ğŸ˜µâ€ğŸ’«â¡ï¸è§£æ±ºğŸ› ï¸

### âŒ å¤±æ•—1ï¼šçŠ¶æ…‹ãŒâ€œç”»é¢ã®æ°—åˆ†â€ã«ãªã£ã¦å¢—ãˆã™ãã‚‹ğŸ“ˆ

ä¾‹ï¼š`SlightlyLoading` / `SuperLoading` ã¿ãŸã„ã«å¢—æ®–â€¦ğŸ˜‚
âœ… å¯¾ç­–ï¼šã¾ãšã¯ **æ¥­å‹™ã®çŠ¶æ…‹**ï¼ˆé€ä¿¡ä¸­/æˆåŠŸ/å¤±æ•—ï¼‰ã‚’å„ªå…ˆã—ã¦ã€UIã¯å¾Œã§æ•´ç†ğŸ€

### âŒ å¤±æ•—2ï¼šã‚¤ãƒ™ãƒ³ãƒˆãŒ â€œæ“ä½œâ€ ã¨ â€œçµæœâ€ ã§æ··ã–ã‚‹ğŸ²

ä¾‹ï¼š`submit`ï¼ˆæ“ä½œï¼‰ã¨ `success`ï¼ˆçµæœï¼‰ãŒåŒåˆ—ã§ãã¡ã‚ƒãã¡ã‚ƒ
âœ… å¯¾ç­–ï¼šãƒ©ãƒ™ãƒ«ã®èªæ„Ÿã‚’æƒãˆã‚‹

* æ“ä½œï¼š`SubmitClicked` / `CancelClicked` ğŸ–±ï¸
* çµæœï¼š`RequestSucceeded` / `RequestFailed` ğŸ“¡

### âŒ å¤±æ•—3ï¼šã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ãŒã€ŒErrorã€1å€‹ã§å…¨éƒ¨å…¥ã‚‹ğŸ§¨

âœ… å¯¾ç­–ï¼šã¾ãšã¯1å€‹ã§OKï¼ãã®ä»£ã‚ã‚Š **â€œæ¬¡ã«ã§ãã‚‹è¡Œå‹•â€** ã‚’æ˜ç¢ºã«
ï¼ˆRetryã§ãã‚‹ï¼Ÿæˆ»ã‚Œã‚‹ï¼Ÿé–‰ã˜ã‚‹ï¼Ÿï¼‰ğŸ”â†©ï¸â

---

## 8.8 æ¼”ç¿’ï¼šãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã‚’ã€ŒçŸ¢å°ã§ã€è¨­è¨ˆã—ã¦ã¿ã‚ˆğŸ“ğŸ’Œ

### ãŠé¡Œï¼ˆæœ€å°ï¼‰ğŸ“Œ

çŠ¶æ…‹ï¼š`Idle â†’ Editing â†’ Submitting â†’ Success / Error`
ã‚¤ãƒ™ãƒ³ãƒˆä¾‹ï¼š`Edit` `Submit` `Succeeded` `Failed` `Retry` `Reset`

### â‘  ã¾ãšå›³ã ã‘ä½œã‚‹ï¼ˆè¡¨ã¯ã‚ã¨ï¼‰ğŸ—ºï¸

Mermaidã§ã“ã‚“ãªæ„Ÿã˜ã‚’ä½œã£ã¦ã¿ã¦ã­ğŸ‘‡

```mermaid
stateDiagram-v2
  [*] --> Idle
  Idle --> Editing: edit
  Editing --> Submitting: submit
  Submitting --> Success: succeeded
  Submitting --> Error: failed
  Error --> Submitting: retry
  Success --> Idle: reset
  Error --> Editing: backToEdit
```

### â‘¡ ãƒã‚§ãƒƒã‚¯ã—ã¦ã¿ã¦âœ…

* Error ã‹ã‚‰ **å¾©æ—§ãƒ«ãƒ¼ãƒˆãŒ2æœ¬ã‚ã‚‹**ï¼ˆretry / backToEditï¼‰ğŸ˜Š
* Success ã‹ã‚‰ **æ¬¡ã®è¡Œå‹•ãŒã‚ã‚‹**ï¼ˆresetã§åˆæœŸåŒ–ï¼‰âœ¨
* â€œSubmittingä¸­ã«submité€£æ‰“â€ ã¯ã©ã†ã™ã‚‹ï¼Ÿï¼ˆç„¡è¦–ï¼Ÿç¦æ­¢ï¼Ÿãƒ­ã‚°ï¼Ÿï¼‰ğŸ”ğŸ’¥

---

## 8.9 AIæ´»ç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆã“ã®ç« ã§ä½¿ãˆã‚‹ã‚„ã¤ï¼‰ğŸ¤–âœ¨

ã‚³ãƒ”ãƒšç”¨ã«ç½®ã„ã¨ãã­ğŸ’•

* ã€Œã“ã®çŠ¶æ…‹é·ç§»å›³ã€**åˆ°é”ä¸èƒ½çŠ¶æ…‹**ã‚„**è©°ã¿çŠ¶æ…‹**ãŒãªã„ã‹ãƒã‚§ãƒƒã‚¯ã—ã¦ã€ğŸ”
* ã€Œã‚¤ãƒ™ãƒ³ãƒˆåã®å‘½åã‚’ã€**æ“ä½œ**ã¨**çµæœ**ã§æƒãˆãŸæ¡ˆã‚’å‡ºã—ã¦ã€ğŸ·ï¸
* ã€Œç¦æ­¢é·ç§»ã‚’ã€**ç„¡è¦–/ã‚¨ãƒ©ãƒ¼/ãƒ­ã‚°**ã®3æ–¹é‡ã§æ¯”è¼ƒã—ã¦ã€ğŸš«ğŸ§¯
* ã€Œã“ã®é·ç§»å›³ã‹ã‚‰ã€é·ç§»è¡¨ï¼ˆçŠ¶æ…‹Ã—ã‚¤ãƒ™ãƒ³ãƒˆï¼‰ã‚’ä½œã£ã¦ã€ğŸ“‹
* ã€Œãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã®çŠ¶æ…‹æ©Ÿæ¢°ã« **Cancel/Timeout** ã‚’è¶³ã™ãªã‚‰ã€çŠ¶æ…‹ã¨é·ç§»æ¡ˆã‚’å‡ºã—ã¦ã€â³â

---

## 8.10 ã¾ã¨ã‚ğŸ€âœ¨

* çŠ¶æ…‹é·ç§»å›³ã¯ã€ä»•æ§˜ã‚’ â€œç›®ã§ã‚ã‹ã‚‹å½¢â€ ã«åœ§ç¸®ã™ã‚‹é“å…·ğŸ§­
* ã¾ãšé·ç§»è¡¨â†’å›³ã®å†™çµŒã§ä½œã‚‹ã¨çˆ†é€Ÿâœï¸
* Mermaidãªã‚‰Markdownã«ç½®ã‘ã¦ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒè…ã‚Šã«ãã„ğŸ§œâ€â™€ï¸ ([mermaid.ai][2])

æ¬¡ã®ç« ï¼ˆç¬¬9ç« ï¼‰ã¯ã€ã“ã®å›³ã¨è¡¨ã‚’ä½¿ã£ã¦ **æŠœã‘æ¼ã‚Œã‚’æ©Ÿæ¢°çš„ã«æ½°ã™**ãƒ•ã‚§ãƒ¼ã‚ºã«å…¥ã‚Šã¾ã™ğŸ•µï¸â€â™€ï¸ğŸ”¥

[1]: https://marketplace.visualstudio.com/items?itemName=bierner.markdown-mermaid&utm_source=chatgpt.com "Markdown Preview Mermaid Support"
[2]: https://mermaid.ai/open-source/syntax/stateDiagram.html?utm_source=chatgpt.com "State diagrams | Mermaid"
[3]: https://marketplace.visualstudio.com/items?itemName=jebbs.plantuml&utm_source=chatgpt.com "PlantUML"
[4]: https://statecharts.io/?utm_source=chatgpt.com "Statecharts.io"
