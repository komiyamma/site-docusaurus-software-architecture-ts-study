# ç¬¬10ç« ï¼šSagaå®Ÿè£…ã‚¹ã‚¿ã‚¤ãƒ«2ç¨®é¡ï¼ˆå…¨ä½“åƒï¼‰ğŸ•ºğŸ»âœ¨

## 10.0 ã“ã®ç« ã§ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã“ã¨ğŸ¯ğŸ’¡

* **Choreographyï¼ˆã‚¤ãƒ™ãƒ³ãƒˆé€£é–ï¼‰ğŸ•º** ã¨ **Orchestrationï¼ˆå¸ä»¤å¡”ï¼‰ğŸ»** ã‚’ã€å›³ã¨è¨€è‘‰ã§ã‚µã‚¯ãƒƒã¨èª¬æ˜ã§ãã‚‹
* ãã‚Œãã‚Œã® **ã€Œå¾—æ„ãªã“ã¨ï¼äº‹æ•…ã‚Šã‚„ã™ã„ã“ã¨ã€** ã‚’çŸ¥ã£ã¦ã€é›°å›²æ°—ã§é¸ã°ãªã„ã‚ˆã†ã«ã™ã‚‹ğŸ§ âœ¨
* æ¬¡ç« ï¼ˆ11ã€œ12ç« ï¼‰ã§æ·±æ˜ã‚Šã™ã‚‹å‰ã«ã€**å…¨ä½“åœ°å›³ğŸ—ºï¸** ã‚’é ­ã«å…¥ã‚Œã‚‹

---

## 10.1 ã¾ãšçµè«–ï¼šSagaã¯ã€Œã©ã†ã‚„ã£ã¦é€£æºã•ã›ã‚‹ã‹ã€ãŒ2é€šã‚Šã‚ã‚‹ğŸŒˆ

Sagaã¯ã€Œè¤‡æ•°ã‚µãƒ¼ãƒ“ã‚¹ã®å‡¦ç†ã‚’ã€å¤±æ•—ã—ã¦ã‚‚å£Šã‚Œãªã„ã‚ˆã†ã«é€²ã‚ã‚‹ã€ã‚„ã‚Šæ–¹ã§ã€ä»£è¡¨çš„ãªå®Ÿè£…ã®é€²ã‚æ–¹ï¼ˆå”èª¿ã®ä»•æ–¹ï¼‰ãŒ **2ç¨®é¡**ã‚ã‚‹ã‚ˆã€œğŸ‘‡âœ¨

* **Choreographyï¼ˆã‚³ãƒ¬ã‚ªã‚°ãƒ©ãƒ•ã‚£ï¼‰ğŸ•º**
  å‚åŠ è€…ï¼ˆå„ã‚µãƒ¼ãƒ“ã‚¹ï¼‰ãŒ **ã‚¤ãƒ™ãƒ³ãƒˆã‚’æŠ•ã’åˆã£ã¦** æ¬¡ã‚’é€²ã‚ã‚‹
* **Orchestrationï¼ˆã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ğŸ»**
  **å¸ä»¤å¡”ï¼ˆã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ï¼‰** ãŒã€æ¬¡ã«èª°ãŒä½•ã‚’ã™ã‚‹ã‹ã‚’æ±ºã‚ã‚‹

![Choreography vs Orchestration](./picture/saga_ts_study_010_styles.png)

ã“ã‚Œã¯å®šç¾©ãƒ¬ãƒ™ãƒ«ã§ã‚‚åºƒãåŒã˜èª¬æ˜ãŒã•ã‚Œã¦ã‚‹ã‚ˆğŸ“šâœ¨ ([microservices.io][1])

---

## 10.2 ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã¤ã‹ã‚€ï¼šåŒã˜æ³¨æ–‡Sagaã§ã‚‚ â€œé€²ã‚æ–¹â€ ãŒé•ã†ğŸ›’ğŸ’³ğŸ“¦

### é¡Œæï¼šæ³¨æ–‡â†’æ±ºæ¸ˆâ†’åœ¨åº«â†’ç™ºé€ï¼ˆå¤±æ•—ã—ãŸã‚‰è£œå„Ÿï¼‰ğŸ§¯ğŸ”

ã“ã“ã§ã¯ã€Œæ³¨æ–‡ã‚’ç¢ºå®šã—ãŸã„ï¼ã€ã£ã¦ã„ã†1ã¤ã®ç›®çš„ã‚’ã€è¤‡æ•°ã‚µãƒ¼ãƒ“ã‚¹ã§é”æˆã™ã‚‹ä¾‹ã«ã™ã‚‹ã­ğŸ˜Š

---

## 10.3 Choreographyï¼ˆã‚¤ãƒ™ãƒ³ãƒˆé€£é–ï¼‰ğŸ•ºğŸ“£ğŸ”—

### âœ… ã–ã£ãã‚Šå®šç¾©

* å„ã‚µãƒ¼ãƒ“ã‚¹ãŒ **ãƒ­ãƒ¼ã‚«ãƒ«ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆè‡ªåˆ†ã®DBæ›´æ–°ï¼‰** ã‚’ã—ã¦
* **ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºè¡Œ**ã—ã¦
* ãã‚Œã‚’å—ã‘å–ã£ãŸåˆ¥ã‚µãƒ¼ãƒ“ã‚¹ãŒæ¬¡ã‚’é€²ã‚ã‚‹ã€ã¨ã„ã†â€œé€£é–â€ã‚¹ã‚¿ã‚¤ãƒ«âœ¨ ([microservices.io][1])

### ğŸ—ºï¸ æµã‚Œï¼ˆæˆåŠŸãƒ‘ã‚¹ï¼‰

1. Orderã‚µãƒ¼ãƒ“ã‚¹ï¼šæ³¨æ–‡ã‚’ã€Œä½œæˆã€â†’ `OrderCreated` ã‚’ç™ºè¡ŒğŸ“£
2. Paymentã‚µãƒ¼ãƒ“ã‚¹ï¼š`OrderCreated` ã‚’è³¼èª­â†’ æ±ºæ¸ˆ â†’ `PaymentCompleted` ç™ºè¡ŒğŸ’³
3. Inventoryã‚µãƒ¼ãƒ“ã‚¹ï¼š`PaymentCompleted` ã‚’è³¼èª­â†’ åœ¨åº«ç¢ºä¿ â†’ `InventoryReserved` ç™ºè¡ŒğŸ“¦
4. Shippingã‚µãƒ¼ãƒ“ã‚¹ï¼š`InventoryReserved` ã‚’è³¼èª­â†’ ç™ºé€æº–å‚™ â†’ `ShippingArranged` ç™ºè¡ŒğŸšš

### ğŸ˜µ å¤±æ•—ã—ãŸã‚‰ï¼Ÿ

* ã©ã“ã‹ãŒå¤±æ•—ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆä¾‹ï¼š`PaymentFailed`ï¼‰ã‚’å‡ºã—ã¦
* ãã‚Œã‚’ãƒˆãƒªã‚¬ã«ã€é–¢ä¿‚è€…ãŒè£œå„Ÿï¼ˆä¾‹ï¼šæ³¨æ–‡ã‚­ãƒ£ãƒ³ã‚»ãƒ«ï¼‰ã‚’èµ°ã‚‰ã›ã‚‹ğŸ§¯
  â€»ã€Œèª°ãŒã©ã®å¤±æ•—ã‚’è¦‹ã¦ã€ã©ã®è£œå„Ÿã‚’ã™ã‚‹ã‹ã€ã‚’ã‚¤ãƒ™ãƒ³ãƒˆè¨­è¨ˆã§å®ˆã‚‹æ„Ÿã˜ï¼

### ğŸ‘ å¼·ã¿

* ã‚µãƒ¼ãƒ“ã‚¹åŒå£«ãŒæ¯”è¼ƒçš„ **ç–çµåˆ** ã«ãªã‚Šã‚„ã™ã„âœ¨
* å¸ä»¤å¡”ãŒã„ãªã„ã®ã§ã€ä¸­å¤®ã®â€œæŒ‡æ®ã‚µãƒ¼ãƒ“ã‚¹â€ãŒè½ã¡ã¦å…¨åœæ­¢â€¦ã¿ãŸã„ãªã®ã¯é¿ã‘ã‚„ã™ã„ğŸŒªï¸

### âš ï¸ ã¤ã‚‰ã¿ï¼ˆåˆå¿ƒè€…ãŒäº‹æ•…ã‚Šã‚„ã™ã„ï¼‰

* **å…¨ä½“åƒãŒè¦‹ãˆã«ãã„**ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆãŒå¢—ãˆã‚‹ã»ã©è¿·å­ï¼‰ğŸ˜µâ€ğŸ’«
* ã€Œã„ã¤ã®é–“ã«ã‹ A ãŒ B ã«ä¾å­˜ã€B ãŒ C ã«ä¾å­˜ã€C ãŒ A ã«â€¦ã€ã¿ãŸã„ãª **ã‚¤ãƒ™ãƒ³ãƒˆåœ°ç„** ã«ãªã‚Šã‚„ã™ã„ğŸ”¥
* ãƒ†ã‚¹ãƒˆã‚„ãƒ‡ãƒãƒƒã‚°ã§ã€Œçµå±€ã©ã“ã‹ã‚‰è¿½ã†ã®ï¼Ÿã€ã«ãªã‚ŠãŒã¡ğŸ‘€ğŸ’¦

---

## 10.4 Orchestrationï¼ˆå¸ä»¤å¡”ï¼‰ğŸ»ğŸ§ ğŸ“

### âœ… ã–ã£ãã‚Šå®šç¾©

* çœŸã‚“ä¸­ã« **ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ï¼ˆå¸ä»¤å¡”ï¼‰** ãŒã„ã¦
* ã€Œæ¬¡ã¯Paymentã‚„ã£ã¦ã€ã€ŒOKãªã‚‰æ¬¡ã¯Inventoryã€ã¿ãŸã„ã« **é †ç•ªãƒ»åˆ†å²ãƒ»å¤±æ•—æ™‚ã®è£œå„Ÿ** ã‚’ç®¡ç†ã™ã‚‹æ–¹å¼ã ã‚ˆğŸ»âœ¨
  ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ã¯ã€ŒçŠ¶æ…‹ã®ä¿å­˜ã€ã€Œå„ã‚¿ã‚¹ã‚¯çµæœã®è§£é‡ˆã€ã€Œè£œå„Ÿã§ã®å¾©æ—§ã€ã¾ã§ã‚„ã‚‹ã€ã£ã¦èª¬æ˜ã•ã‚Œã‚‹ã“ã¨ãŒå¤šã„ã‚ˆğŸ“ ([Microsoft Learn][2])

### ğŸ—ºï¸ æµã‚Œï¼ˆæˆåŠŸãƒ‘ã‚¹ï¼‰

1. Orchestratorï¼šSagaé–‹å§‹ï¼ˆæ³¨æ–‡IDã‚’å—ã‘å–ã‚‹ï¼‰ğŸ¬
2. Orchestrator â†’ Paymentã¸ã€Œæ±ºæ¸ˆã—ã¦ã­ã€ã‚³ãƒãƒ³ãƒ‰âœ‰ï¸
3. Payment â†’ Orchestratorã¸ã€ŒæˆåŠŸ/å¤±æ•—ã€ã‚’è¿”ä¿¡ğŸ“©
4. æˆåŠŸãªã‚‰ Orchestrator â†’ Inventoryã¸ã€Œåœ¨åº«ç¢ºä¿ã—ã¦ã­ã€ğŸ“¦
5. â€¦ã¨ã„ã†ãµã†ã«å¸ä»¤å¡”ãŒé †ç•ªã«é€²ã‚ã‚‹ğŸ»

### ğŸ˜µ å¤±æ•—ã—ãŸã‚‰ï¼Ÿ

* OrchestratorãŒã€Œã©ã“ã¾ã§æˆåŠŸã—ãŸã‹ã€ã‚’è¦‹ã¦ã€**é€†é †ã«è£œå„Ÿ** ã‚’æŒ‡ç¤ºã™ã‚‹ğŸ§¯ğŸ”
  ï¼ˆä¾‹ï¼šåœ¨åº«ç¢ºä¿ã¾ã§çµ‚ã‚ã£ã¦ãŸ â†’ åœ¨åº«æˆ»ã— â†’ æ±ºæ¸ˆå–æ¶ˆ/è¿”é‡‘ â†’ æ³¨æ–‡ã‚­ãƒ£ãƒ³ã‚»ãƒ«ï¼‰

### ğŸ‘ å¼·ã¿

* **å…¨ä½“ã®è¦‹é€šã—ãŒè‰¯ã„**ï¼ˆãƒ•ãƒ­ãƒ¼ãŒ1ã‹æ‰€ã«é›†ã¾ã‚‹ï¼‰ğŸ—ºï¸âœ¨
* ç›£è¦–ãƒ»é‹ç”¨ãŒã‚„ã‚Šã‚„ã™ã„ï¼ˆçŠ¶æ…‹ãŒã¾ã¨ã¾ã‚‹ï¼‰ğŸ”
* è¤‡é›‘ãªåˆ†å²ãŒå…¥ã£ã¦ã‚‚ã€Œå¸ä»¤å¡”ã«æ›¸ã‘ã°è¿½ãˆã‚‹ã€ã«ãªã‚Šã‚„ã™ã„ğŸ»

### âš ï¸ ã¤ã‚‰ã¿

* ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ãŒè‚¥å¤§åŒ–ã™ã‚‹ã¨ **â€œç¥ã‚µãƒ¼ãƒ“ã‚¹â€** ã«ãªã‚ŠãŒã¡ğŸ‘‘ğŸ’¥
* å¸ä»¤å¡”ãŒè½ã¡ã‚‹ã¨å½±éŸ¿ãŒå¤§ãã„ï¼ˆå†—é•·åŒ–ã‚„å†é–‹è¨­è¨ˆãŒå¤§äº‹ï¼‰ğŸ§¯
* è¨­è¨ˆã®è²¬ä»»ãŒé›†ä¸­ã™ã‚‹ã®ã§ã€æœ€åˆã®è¨­è¨ˆåŠ›ãŒå°‘ã—å¿…è¦ğŸ’¦

---

## 10.5 2ã¤ã‚’æ¯”è¼ƒï¼ãƒ‘ãƒƒã¨è¦‹è¡¨ğŸ§ğŸ“Š

| è¦³ç‚¹      | Choreography ğŸ•º    | Orchestration ğŸ»  |
| ------- | ------------------ | ----------------- |
| ä¸»å½¹      | å„ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆé€£é–ï¼‰      | å¸ä»¤å¡”ï¼ˆã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ï¼‰    |
| åˆ†ã‹ã‚Šã‚„ã™ã•  | å°è¦æ¨¡ãªã‚‰â—‹ã€å¤§è¦æ¨¡ã§è¿·å­ğŸ˜µâ€ğŸ’« | å…¨ä½“åƒãŒè¦‹ãˆã‚„ã™ã„ğŸ—ºï¸      |
| å¤‰æ›´ã®ã—ã‚„ã™ã• | ã‚¤ãƒ™ãƒ³ãƒˆè¨­è¨ˆãŒä¸Šæ‰‹ã„ã¨å¼·ã„âœ¨     | å¸ä»¤å¡”ã®ä¿®æ­£ã§æµã‚Œã‚’å¤‰ãˆã‚„ã™ã„ğŸ”§ |
| äº‹æ•…ã‚Šãƒã‚¤ãƒ³ãƒˆ | ã‚¤ãƒ™ãƒ³ãƒˆå¢—æ®–ã€å¾ªç’°ä¾å­˜ã€å‘½åå´©å£ŠğŸ”¥ | ç¥ã‚µãƒ¼ãƒ“ã‚¹åŒ–ã€è²¬å‹™éå¤šğŸ‘‘ğŸ’¥   |
| å‘ã      | å˜ç´”ãªé€£é–ãƒ»ç–çµåˆé‡è¦–        | è¤‡é›‘ãªåˆ†å²ãƒ»ç›£è¦–é‡è¦–        |

ï¼ˆã€Œ2ç¨®é¡ãŒå…¸å‹ã€ã£ã¦æ•´ç†ã¯ã€ä¸»è¦ãªè¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã‚‚åŒã˜ã ã‚ˆğŸ“šï¼‰ ([Microsoft Learn][2])

---

## 10.6 â€œã©ã£ã¡é¸ã¶ï¼Ÿâ€ è¿·ã£ãŸã¨ãã®ç›®å®‰ğŸ§­ğŸ’•

åˆ¤æ–­ã®ã‚³ãƒ„ã¯ã€ã‚ã£ã¡ã‚ƒã‚·ãƒ³ãƒ—ãƒ«ã«ã™ã‚‹ã¨ğŸ‘‡

### ğŸ» Orchestration ã‚’é¸ã³ã‚„ã™ã„ã‚±ãƒ¼ã‚¹

* åˆ†å²ãŒå¤šã„ï¼ˆä¾‹ï¼šæœ¬äººç¢ºèªã€ä¸ä¿¡ã€ã‚¯ãƒ¼ãƒãƒ³ã€å†è¨ˆç®—â€¦ï¼‰ğŸŒ€
* å¤±æ•—æ™‚ã®æˆ»ã—ãŒé›£ã—ãã¦ã€**é †ç•ªã‚’å³å¯†ã«ç®¡ç†ã—ãŸã„**ğŸ§¯
* é‹ç”¨ã§ã€Œä»Šã©ã“ï¼Ÿã€ã‚’è¿½ã„ãŸã„ï¼ˆç›£è¦–ãƒ»èª¿æŸ»ãŒé‡è¦ï¼‰ğŸ”

### ğŸ•º Choreography ã‚’é¸ã³ã‚„ã™ã„ã‚±ãƒ¼ã‚¹

* é€£é–ãŒçŸ­ãã¦åˆ†ã‹ã‚Šã‚„ã™ã„ï¼ˆ2ã€œ3æ®µãã‚‰ã„ï¼‰ğŸ”—
* å„ã‚µãƒ¼ãƒ“ã‚¹ãŒã€Œè‡ªåˆ†ã®ã‚¤ãƒ™ãƒ³ãƒˆã ã‘è¦‹ã‚Œã°ã„ã„ã€è¨­è¨ˆãŒä½œã‚Œã‚‹âœ¨
* ä¸­å¤®ã«ãƒ­ã‚¸ãƒƒã‚¯ã‚’é›†ã‚ãŸããªã„ï¼ˆãƒãƒ¼ãƒ åˆ†é›¢ãƒ»è‡ªå¾‹æ€§ï¼‰ğŸï¸

â€»ã‚¯ãƒ©ã‚¦ãƒ‰ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ç³»ã§ã‚‚ã€Sagaï¼ˆè£œå„Ÿï¼‰ã‚’ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã§æ‰±ã†è©±ãŒã‚ˆãå‡ºã‚‹ã‚ˆï¼ˆï¼ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¯„ã‚Šã®è€ƒãˆæ–¹ã¨ç›¸æ€§ãŒã„ã„ï¼‰ğŸ“®âœ¨ ([Google Cloud Documentation][3])

---

## 10.7 TypeScriptã§ã® â€œå½¢â€ ã‚’è¦‹ã‚‹ï¼ˆãƒŸãƒ‹é››å½¢ï¼‰ğŸ§©ğŸ§‘â€ğŸ’»âœ¨

> ã“ã“ã¯ã€Œé›°å›²æ°—ã‚’ã¤ã‹ã‚€ç”¨ã€ã ã‹ã‚‰ã€ç´°éƒ¨ã¯æ¬¡ç« ã§ã—ã£ã‹ã‚Šã‚„ã‚‹ã‚ˆğŸ˜Š
> ãƒã‚¤ãƒ³ãƒˆã¯ **è²¬å‹™ã®ç½®ãå ´æ‰€** ã ã‘è¦‹ã‚‹ã“ã¨ğŸ‘€ğŸ’•

### ğŸ•º Choreographyï¼šã‚¤ãƒ™ãƒ³ãƒˆè³¼èª­ã§é€²ã‚€ï¼ˆè¶…ãƒŸãƒ‹ï¼‰

```ts
// ä¾‹ï¼šPaymentã‚µãƒ¼ãƒ“ã‚¹å´ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆã‚’å—ã‘ãŸã‚‰è‡ªåˆ†ã®ä»•äº‹ã‚’ã™ã‚‹ï¼‰
type OrderCreated = { orderId: string; amount: number };

async function onOrderCreated(evt: OrderCreated) {
  // 1) è‡ªåˆ†ã®DBã‚’æ›´æ–°ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ï¼‰
  // 2) å¤–éƒ¨æ±ºæ¸ˆãªã©ã‚’å®Ÿè¡Œ
  // 3) çµæœã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºè¡Œ
  // publish({ type: "PaymentCompleted", orderId: evt.orderId })
  // å¤±æ•—ãªã‚‰ publish({ type: "PaymentFailed", orderId: evt.orderId, reason: "..." })
}
```

### ğŸ» Orchestrationï¼šå¸ä»¤å¡”ãŒé †ç•ªã«æŒ‡ç¤ºï¼ˆè¶…ãƒŸãƒ‹ï¼‰

```ts
type SagaState =
  | { status: "STARTED"; orderId: string }
  | { status: "PAID"; orderId: string; paymentId: string }
  | { status: "RESERVED"; orderId: string; paymentId: string; reservationId: string }
  | { status: "COMPLETED"; orderId: string }
  | { status: "COMPENSATING"; orderId: string };

async function runOrderSaga(orderId: string) {
  // 0) çŠ¶æ…‹ã‚’ä¿å­˜ï¼ˆã©ã“ã¾ã§é€²ã‚“ã ã‹ï¼‰
  // save({ status: "STARTED", orderId })

  try {
    const paymentId = await pay(orderId);         // Paymentã¸æŒ‡ç¤º
    // save({ status: "PAID", orderId, paymentId })

    const reservationId = await reserve(orderId); // Inventoryã¸æŒ‡ç¤º
    // save({ status: "RESERVED", orderId, paymentId, reservationId })

    await arrangeShipping(orderId);               // Shippingã¸æŒ‡ç¤º
    // save({ status: "COMPLETED", orderId })
  } catch (e) {
    // save({ status: "COMPENSATING", orderId })
    // é€²æ—ã«å¿œã˜ã¦é€†é †ã«è£œå„Ÿï¼ˆåœ¨åº«æˆ»ã—â†’è¿”é‡‘â†’æ³¨æ–‡ã‚­ãƒ£ãƒ³ã‚»ãƒ«â€¦ï¼‰
    await compensateIfNeeded(orderId);
    throw e;
  }
}
```

---

## 10.8 ã‚ã‚ŠãŒã¡äº‹æ•…ã¾ã¨ã‚ï¼ˆã“ã®ç« ã§å…ˆã«äºˆé˜²æ³¨å°„ğŸ’‰âš ï¸ï¼‰

### ğŸ•º Choreographyã§èµ·ããŒã¡

* ã€Œã‚¤ãƒ™ãƒ³ãƒˆåãŒé©å½“ã€â†’ å¾Œã§å…¨å“¡ãŒæ··ä¹±ğŸŒ€
* ã€Œèª°ãŒã©ã®å¤±æ•—ã‚’è¦‹ã¦è£œå„Ÿã™ã‚‹ã‹ã€æ›–æ˜§ â†’ è£œå„Ÿæ¼ã‚ŒğŸ§¯ğŸ’¦
* ã‚¤ãƒ™ãƒ³ãƒˆãŒå¢—ãˆã¦ **å…¨ä½“ãŒèª­ã‚ãªã„** ğŸ˜µâ€ğŸ’«

ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆé€£é–å‹ã®èª¬æ˜ã‚„æ³¨æ„ç‚¹ã¯ã€Sagaè§£èª¬ã§å®šç•ªã¨ã—ã¦è§¦ã‚Œã‚‰ã‚Œã‚‹ã‚ˆï¼‰ ([microservices.io][4])

### ğŸ» Orchestrationã§èµ·ããŒã¡

* å¸ä»¤å¡”ã«å…¨éƒ¨è©°ã‚è¾¼ã¿ â†’ ç¥ã‚µãƒ¼ãƒ“ã‚¹åŒ–ğŸ‘‘ğŸ’¥
* çŠ¶æ…‹ä¿å­˜ãŒé›‘ â†’ å†é–‹ã§ããšã«æ³£ãğŸ˜­
* å¸ä»¤å¡”ã®è²¬å‹™ãŒã€Œæ¥­å‹™ãƒ­ã‚¸ãƒƒã‚¯å…¨éƒ¨ã€ã«ãªã£ã¦ã€å¢ƒç•ŒãŒå´©å£ŠğŸš§

ï¼ˆã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ãŒã€ŒçŠ¶æ…‹ã‚’ä¿å­˜ã—ã€çµæœã‚’è§£é‡ˆã—ã€è£œå„Ÿã§å¾©æ—§ã™ã‚‹ã€ã£ã¦ã„ã†è²¬å‹™ã‚’æŒã¤ã®ãŒä¸€èˆ¬çš„ãªæ•´ç†ã ã‚ˆï¼‰ ([Microsoft Learn][2])

---

## 10.9 ãƒŸãƒ‹æ¼”ç¿’ï¼ˆ3åˆ†ï¼‰ğŸ“âœ¨

æ¬¡ã®ã‚·ãƒŠãƒªã‚ªã§ã€Œã©ã£ã¡ãŒå…ˆã«æ¥ãã†ï¼Ÿã€ã‚’é¸ã‚“ã§ã¿ã‚ˆã€œğŸ˜ŠğŸ’•

1. **é€šçŸ¥ï¼ˆãƒ¡ãƒ¼ãƒ«ãƒ»Pushï¼‰**ï¼šå¤±æ•—ã—ã¦ã‚‚è‡´å‘½å‚·ã˜ã‚ƒãªã„ğŸ“©
   â†’ ğŸ•º / ğŸ» ã©ã£ã¡ï¼Ÿ
2. **æ±ºæ¸ˆï¼‹åœ¨åº«ï¼‹ç™ºé€**ï¼šå¤±æ•—ã™ã‚‹ã¨ãŠé‡‘ãƒ»åœ¨åº«ãŒå£Šã‚Œã‚‹ğŸ’³ğŸ“¦
   â†’ ğŸ•º / ğŸ» ã©ã£ã¡ï¼Ÿ
3. **åˆ†å²ãŒå¤šã„**ï¼šæœ¬äººç¢ºèªã®çµæœã§å‡¦ç†ãŒå¤‰ã‚ã‚‹ğŸªª
   â†’ ğŸ•º / ğŸ» ã©ã£ã¡ï¼Ÿ

ï¼ˆç­”ãˆã®â€œè€ƒãˆæ–¹â€ã¯æ¬¡ç« ã§ãƒãƒãƒƒã¨å›ºã‚ã‚‹ã‚ˆğŸ”¥ï¼‰

---

## 10.10 ã¾ã¨ã‚ğŸŒŸ

* Sagaã®é€²ã‚æ–¹ã¯å¤§ãã **ã‚¤ãƒ™ãƒ³ãƒˆé€£é–ï¼ˆChoreographyï¼‰ğŸ•º** ã¨ **å¸ä»¤å¡”ï¼ˆOrchestrationï¼‰ğŸ»** ã®2ã¤
* **åˆ†å²ãƒ»é‹ç”¨ãƒ»èª¿æŸ»ãŒé‡ã„ã»ã©ğŸ»ãŒåˆ†ã‹ã‚Šã‚„ã™ã„**ã€ã‚·ãƒ³ãƒ—ãƒ«é€£é–ã§ç–çµåˆã‚’æ´»ã‹ã™ãªã‚‰ğŸ•ºã‚‚å¼·ã„
* ã©ã¡ã‚‰ã§ã‚‚ã€ŒçŠ¶æ…‹ï¼ˆé€²æ—ï¼‰ã€ã€Œå¤±æ•—æ™‚ã®è£œå„Ÿã€ã€Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ•´åˆæ€§ã€ãŒè¶…å¤§äº‹ğŸ§ ğŸ§¯âœ¨

# æ¬¡ã¯ã€ã¾ãš **Choreographyå…¥é–€ï¼ˆç¬¬11ç« ï¼‰ğŸ“£ğŸ”—** ã§ã‚¤ãƒ™ãƒ³ãƒˆé€£é–ã®ä¸–ç•Œè¦³ã‚’ä½“é¨“ã—ã¦ã„ãã‚ˆã€œğŸ˜ŠğŸ“šâœ¨

[1]: https://microservices.io/patterns/data/saga.html?utm_source=chatgpt.com "Pattern: Saga"
[2]: https://learn.microsoft.com/en-us/azure/architecture/patterns/saga?utm_source=chatgpt.com "Saga Design Pattern - Azure Architecture Center"
[3]: https://docs.cloud.google.com/workflows/docs/best-practice?utm_source=chatgpt.com "Best practices for Workflows"
[4]: https://microservices.io/post/sagas/2019/08/15/developing-sagas-part-3.html?utm_source=chatgpt.com "Implementing a choreography-based saga"
