# ç¬¬22ç« ï¼šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–“é€£æºâ‘¢ï¼ˆä¾å­˜ã®å‘ãã‚’æ•´ãˆã‚‹ï¼‰ğŸ”„ğŸ§©

ã“ã®ç« ã¯ã‚ºãƒãƒªã€ã€ŒAãŒBã‚’çŸ¥ã‚Šã™ãå•é¡Œã€ã‚’æ¸›ã‚‰ã—ã¦ã€å¤‰æ›´ã«å¼·ã„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é€£æºã«ã™ã‚‹å›ã ã‚ˆã€œâ˜ºï¸âœ¨
ï¼ˆå‘¼ã³å‡ºã—ã¯ã—ã¦ã„ã„ã€‚ã§ã‚‚â€œä¾å­˜ã®ã—ã‹ãŸâ€ã‚’è³¢ãã™ã‚‹ï¼ã£ã¦æ„Ÿã˜ğŸ§ ğŸ’¡ï¼‰

---

## 0. ã¾ãšè¶…å¤§äº‹ï¼š**å‘¼ã³å‡ºã—ã®çŸ¢å°**ã¨**ä¾å­˜ã®çŸ¢å°**ã¯åˆ¥ã‚‚ã®ã ã‚ˆğŸ“Œ

* **å‘¼ã³å‡ºã—ï¼ˆruntimeï¼‰**ï¼šå®Ÿè¡Œæ™‚ã«AãŒBã‚’ä½¿ã†ï¼ˆé–¢æ•°ã‚³ãƒ¼ãƒ«ã¨ã‹ï¼‰
* **ä¾å­˜ï¼ˆcompile-timeï¼‰**ï¼šã‚³ãƒ¼ãƒ‰ä¸Šã§AãŒBã‚’`import`ã—ã¦ã‚‹ï¼ˆå‹ãƒ»ã‚¯ãƒ©ã‚¹ãƒ»å®šæ•°ã‚’çŸ¥ã£ã¦ã‚‹ï¼‰

ã“ã®ç« ã§æ•´ãˆã‚‹ã®ã¯ **ã€Œä¾å­˜ï¼ˆimportï¼‰ã®å‘ãã€** ã®æ–¹ã ã‚ˆã€œğŸ”§âœ¨

---

## 1. â€œAãŒBã‚’çŸ¥ã‚Šã™ãâ€ã£ã¦ã©ã‚“ãªçŠ¶æ…‹ï¼ŸğŸ˜µâ€ğŸ’«

æ¬¡ãŒå¢—ãˆã‚‹ã»ã©ã€ŒçŸ¥ã‚Šã™ãã€ã§ã€å°†æ¥ã¤ã‚‰ããªã‚‹â€¦ï¼

* AãŒBã®**å†…éƒ¨ãƒ•ã‚©ãƒ«ãƒ€**ã‚’`import`ã—ã¦ã‚‹ğŸ™…â€â™€ï¸
* AãŒBã®**ãƒ‰ãƒ¡ã‚¤ãƒ³å‹**ã‚’ãã®ã¾ã¾æ¡ã£ã¦ã‚‹ï¼ˆBã®éƒ½åˆãŒAã«æ¼ã‚Œã‚‹ï¼‰ğŸ« 
* AãŒBã®**DBæ§‹é€ **ã‚„**å…·ä½“å®Ÿè£…**ã‚’å‰æã«ã—ã¦ã‚‹ğŸ§¨
* Aâ†”Bã§**å¾ªç’°ä¾å­˜**ãŒèµ·ãã¦ã‚‹ï¼ˆæœ€æ‚ªã®ã‚„ã¤ï¼‰ğŸ’¥

---

## 2. ä¾å­˜ã®å‘ãã‚’æ•´ãˆã‚‹ã€Œ3ã¤ã®ä½œæˆ¦ã€ğŸ§¤âœ¨

### ä½œæˆ¦Aï¼šã¾ãšã¯â€œæ­£æ”»æ³•â€âœ…ã€Œå…¬é–‹APIã ã‘ã«ä¾å­˜ã™ã‚‹ã€

ç¬¬20ç« ã®å¾©ç¿’ã£ã½ã„ã‘ã©æœ€å¼·ï¼
Bã®`index.ts`ï¼ˆå…¬é–‹APIï¼‰**ã ã‘**ã‚’AãŒä½¿ã†ã€‚

* ğŸ‘ é€Ÿã„ãƒ»åˆ†ã‹ã‚Šã‚„ã™ã„
* ğŸ‘€ ãŸã ã—ã€ŒBã®å…¬é–‹APIãŒè‚²ã¡ã™ãã¦å·¨å¤§ã€ã«ãªã‚‹ã¨åœ°ç„ã¸â€¦ï¼ˆæ¬¡ç« ã®ç½ ï¼‰ğŸ•³ï¸

---

### ä½œæˆ¦Bï¼šã“ã®ç« ã®ä¸»å½¹ğŸŒŸã€Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§è·é›¢ã‚’å–ã£ã¦ã€ä¾å­˜ã‚’â€œåè»¢â€ã™ã‚‹ã€ğŸ”

![ä¾å­˜ã®åè»¢ (Dependency Inversion)](./picture/mod_mono_ts_study_022_dependency_inversion.png)

```mermaid
graph TD
    subgraph Before [Before: ç›´æ¥ä¾å­˜]
        App1[Application] -->|Direct call| Infra1["Infrastructure<br/>(Specific DB)"]
    end
    
    subgraph After ["After: ä¾å­˜ã®åè»¢ (DIP)"]
        App2[Application] -->|Uses| Port["Port<br/>(Interface)"]
        Infra2[Infrastructure] -.->|Implements| Port
    end
    
    style App1 fill:#ffccbc
    style Infra1 fill:#ffe0b2
    
    style App2 fill:#c8e6c9
    style Port fill:#fff9c4,stroke:#fbc02d
    style Infra2 fill:#e1bee7
```

ãƒã‚¤ãƒ³ãƒˆã¯ã“ã‚ŒğŸ‘‡
**AãŒæ¬²ã—ã„â€œå½¢ï¼ˆå¥‘ç´„ï¼‰â€ã‚’Aå´ã§å®šç¾©ã™ã‚‹**
â†’ Bã¯ãã®å¥‘ç´„ã‚’æº€ãŸã™â€œå®Ÿè£…è€…â€ã«ãªã‚‹

ã“ã‚Œã€DIPï¼ˆDependency Inversion Principleï¼‰ã£ã¦å‘¼ã°ã‚Œã‚‹è€ƒãˆæ–¹ã ã‚ˆğŸ”Œâ¬†ï¸
ã€Œä¸Šä½ã‚‚ä¸‹ä½ã‚‚â€œæŠ½è±¡ï¼ˆinterfaceï¼‰â€ã«ä¾å­˜ã—ã‚ˆã†ã­ã€ã£ã¦ã‚„ã¤ï¼ ([ã‚¦ã‚£ã‚­ãƒšãƒ‡ã‚£ã‚¢][1])

---

### ä½œæˆ¦Cï¼šä¾å­˜ã‚’â€œã»ã¼æ¶ˆã™â€âœ¨ã€Œã‚¤ãƒ™ãƒ³ãƒˆ/é€šçŸ¥ã§ã¤ãªãã€ğŸ“£

ã“ã‚Œã¯æœ€çµ‚ç« å¯„ã‚Šã®è©±ã ã‘ã©ã€è¶…ã–ã£ãã‚Šè¨€ã†ã¨
ã€ŒBã«ç›´æ¥ãŠé¡˜ã„ã—ãªã„ã§ã€â€œèµ·ããŸäº‹å®Ÿâ€ã ã‘æŠ•ã’ã‚‹ã€æ„Ÿã˜ã€‚

ãŸã ã—ã€è¨­è¨ˆã¨é‹ç”¨ãŒå°‘ã—ä¸Šç´šã«ãªã‚‹ã‹ã‚‰ã€ã“ã®ç« ã§ã¯**å…¥ã‚Šå£ã ã‘**ã«ã™ã‚‹ã­â˜ºï¸

---

## 3. ä½œæˆ¦Bã®â€œå‹â€ã‚’æ‰‹ã§è¦šãˆã‚ˆã†ğŸ§©âœï¸ï¼ˆä¾‹ã¤ãï¼‰

### ä¾‹ï¼š`billing`ãŒã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã®çŠ¶æ…‹æ›´æ–°ã€ã‚’ã—ãŸã„

ã§ã‚‚ `billing -> user` ã«**å¼·ã„ä¾å­˜**ã‚’ä½œã‚ŠãŸããªã„ï¼

ãã“ã§ğŸ‘‡
`billing` ãŒ **æ¬²ã—ã„æ©Ÿèƒ½ã ã‘** `interface` ã§å®šç¾©ã™ã‚‹ã‚ˆâœ¨

```ts
// modules/billing/ports/UserStatusPort.ts
export interface UserStatusPort {
  markAsPaid(userId: string): Promise<void>;
}
```

`billing`å´ã¯ã€ã‚‚ã†ã“ã‚Œã—ã‹çŸ¥ã‚‰ãªã„ğŸ™†â€â™€ï¸ï¼ˆuserãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å†…éƒ¨äº‹æƒ…ã‚¼ãƒ­ï¼ï¼‰

---

### `billing`ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã¯â€œæŠ½è±¡â€ã ã‘ã‚’è¦‹ã‚‹ğŸ‘€âœ¨

```ts
// modules/billing/application/PayInvoice.ts
import type { UserStatusPort } from "../ports/UserStatusPort";

export class PayInvoice {
  constructor(private readonly userStatus: UserStatusPort) {}

  async execute(input: { userId: string; invoiceId: string }) {
    // â€¦è«‹æ±‚ã®æ”¯æ‰•ã„å‡¦ç†ï¼ˆçœç•¥ï¼‰
    await this.userStatus.markAsPaid(input.userId);
  }
}
```

ã“ã“ã§ã®æ°—æŒã¡ï¼š
ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼å´ã®å®Ÿè£…ï¼ŸçŸ¥ã‚‰ã‚“ï¼ã§ã‚‚â€œæ”¯æ‰•ã„æ¸ˆã¿ã«ã™ã‚‹â€ã£ã¦æ©Ÿèƒ½ã ã‘æ¬²ã—ã„ï¼ã€ğŸ˜¤âœ¨

---

### `user`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯â€œå®Ÿè£…â€ã‚’æä¾›ã™ã‚‹ğŸ§¤

```ts
// modules/user/adapters/UserStatusAdapter.ts
import type { UserStatusPort } from "../../billing/ports/UserStatusPort";
import { Users } from "../index"; // userã®å…¬é–‹APIã ã‘ï¼

export class UserStatusAdapter implements UserStatusPort {
  async markAsPaid(userId: string): Promise<void> {
    await Users.markAsPaid(userId);
  }
}
```

> ã‚ã‚Œï¼Ÿ `user` ãŒ `billing` ã® `ports` ã‚’importã—ã¦ã‚‹ã˜ã‚ƒã‚“ï¼
> ãã†ï¼ãã‚ŒãŒ **ä¾å­˜ã®åè»¢**ã ã‚ˆğŸ”âœ¨
> **ã€ŒæŠ½è±¡ï¼ˆinterfaceï¼‰ã¯â€œå¿…è¦ã¨ã—ã¦ã‚‹å´â€ãŒæŒã¤ã€**ã“ã¨ãŒå¤šã„ã‚“ã ã€œ ([martinfowler.com][2])

---

### æœ€å¾Œã«ã€Œçµ„ã¿ç«‹ã¦å½¹ï¼ˆComposition Rootï¼‰ã€ã§æ¥ç¶šã™ã‚‹ğŸ”§ğŸ€

```ts
// app/compositionRoot.ts
import { PayInvoice } from "../modules/billing/application/PayInvoice";
import { UserStatusAdapter } from "../modules/user/adapters/UserStatusAdapter";

export function createPayInvoice() {
  const userStatus = new UserStatusAdapter();
  return new PayInvoice(userStatus);
}
```

ã“ã“ãŒâ€œé…ç·šâ€ã®å ´æ‰€ã ã‚ˆâš¡
ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚„ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ä¸­ã§`new`ã—ã¾ãã‚‹ã¨ã€ä¾å­˜ãŒãã¡ã‚ƒãã¡ã‚ƒã«ãªã‚‹ã‹ã‚‰æ³¨æ„ã­ğŸ™…â€â™€ï¸ğŸ’¦

---

## 4. ã“ã†ã™ã‚‹ã¨å‹ã¡ã‚„ã™ã„ğŸ†âœ¨ã€Œä¾å­˜ã®å‘ãã€æ•´ç†ãƒ«ãƒ¼ãƒ«

### âœ… ãƒ«ãƒ¼ãƒ«1ï¼šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–“ã§æ¸¡ã™ã®ã¯ã€ŒDTOï¼ˆå¢ƒç•Œç”¨ã®å½¢ï¼‰ã€ãŒåŸºæœ¬

åˆ¥ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒ‰ãƒ¡ã‚¤ãƒ³å‹ã‚’ãã®ã¾ã¾æŒã¤ã¨ã€ä»•æ§˜å¤‰æ›´ãŒä¼æŸ“ã™ã‚‹ã‚ˆğŸ¦ ğŸ’¥

* ğŸ‘ `UserSummaryDTO`ã¿ãŸã„ãªâ€œå¢ƒç•Œç”¨ã®å‹â€ã«ã™ã‚‹
* ğŸ™…â€â™€ï¸ `UserAggregate` ã‚’ãã®ã¾ã¾æ¡ã‚‹ï¼ˆã‚„ã‚ã¦ã€œï¼ï¼‰

---

### âœ… ãƒ«ãƒ¼ãƒ«2ï¼šinterfaceã¯â€œå¢—ã‚„ã—ã™ããªã„â€

DIPã¯ä¸‡èƒ½ã˜ã‚ƒãªãã¦ã€ã‚„ã‚Šã™ãã‚‹ã¨é€†ã«èª­ã¿ã«ãã„ğŸ¥º
ã€Œå°†æ¥å·®ã—æ›¿ãˆã‚‹å¯èƒ½æ€§ãŒé«˜ã„ã¨ã“ã‚ã€ã€Œãƒ†ã‚¹ãƒˆã§ç½®ãæ›ãˆãŸã„ã¨ã“ã‚ã€ã ã‘ã§OKï¼

> â€œã¨ã‚Šã‚ãˆãšå…¨éƒ¨interfaceåŒ–â€ã¯ã€ã‚ã‚Šã¨äº‹æ•…ã‚‹ã‚ˆã€œğŸ’¦ ([martinfowler.com][2])

---

### âœ… ãƒ«ãƒ¼ãƒ«3ï¼šå¾ªç’°ä¾å­˜ã¯å³ã‚¢ã‚¦ãƒˆğŸ’£

è¦‹ã¤ã‘ãŸã‚‰ã€ã ã„ãŸã„ã©ã£ã¡ã‹ğŸ‘‡

* æŠ½è±¡ï¼ˆportï¼‰ã‚’ç‰‡æ–¹ã¸å¯„ã›ã¦åè»¢ã™ã‚‹ğŸ”
* â€œå…±é€šã«è¦‹ãˆã‚‹æ¦‚å¿µâ€ã‚’å¢ƒç•Œç”¨DTOã¨ã—ã¦åˆ‡ã‚Šå‡ºã™âœ‚ï¸

---

## 5. ãƒŸãƒ‹æ¼”ç¿’ğŸ§©âœ¨ï¼ˆã‚„ã£ã¦ã¿ã‚ˆã€œï¼ï¼‰

### ãŠé¡Œï¼šã“ã®â€œçŸ¥ã‚Šã™ãâ€ã‚’ç›´ã—ã¦ã­ğŸ˜ˆ

```ts
// modules/billing/application/Pay.ts
import { UserRepository } from "../../user/internal/UserRepository"; // ğŸ™…â€â™€ï¸å†…éƒ¨å‚ç…§ï¼

export async function pay(userId: string) {
  const repo = new UserRepository();
  await repo.markAsPaid(userId);
}
```

### ã‚´ãƒ¼ãƒ«ğŸ¯

* `billing`å´ã«`UserStatusPort`ã‚’ä½œã‚‹
* `user`å´ã«`UserStatusAdapter`ã‚’ä½œã‚‹
* `compositionRoot`ã§æ³¨å…¥ã™ã‚‹

ï¼ˆã•ã£ãã®ä¾‹ã‚’â€œè‡ªåˆ†ã®æ‰‹ã§å†ç¾â€ã§ããŸã‚‰å‹ã¡ã ã‚ˆã€œğŸ’®ğŸ’•ï¼‰

---

## 6. AIã§ä¾å­˜å›³ãƒ¬ãƒ“ãƒ¥ãƒ¼ğŸ¤–ğŸ‘€ï¼ˆè¶…ä½¿ãˆã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹ï¼‰

### ä¾å­˜ã®æ´—ã„å‡ºã—

* ã€Œ`modules/`é…ä¸‹ã®importã‚’è¦‹ã¦ã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–“ä¾å­˜ã‚°ãƒ©ãƒ•ã‚’ä½œã£ã¦ã€‚å¾ªç’°ãŒã‚ã‚Œã°æŒ‡æ‘˜ã—ã¦ã€ğŸ—ºï¸

### â€œçŸ¥ã‚Šã™ãâ€å€™è£œã®æ¤œå‡º

* ã€Œ`modules/a`ãŒ`modules/b`ã®ä½•ã‚’çŸ¥ã‚Šã™ãã¦ã‚‹ï¼Ÿå…¬é–‹APIä»¥å¤–importã—ã¦ãŸã‚‰åˆ—æŒ™ã—ã¦ã€ğŸ”

### ç›´ã—æ–¹ã®ææ¡ˆ

* ã€Œã“ã®ä¾å­˜ã‚’DIPï¼ˆconsumerå´portï¼‰ã§åè»¢ã™ã‚‹ã¨ã—ãŸã‚‰ã€portåã¨ãƒ¡ã‚½ãƒƒãƒ‰æ¡ˆã€æ³¨å…¥ãƒã‚¤ãƒ³ãƒˆã¾ã§ææ¡ˆã—ã¦ã€ğŸ”

---

## 7. ç« æœ«ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆâœ…ğŸ’–

* [ ] ä»–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®`internal/`ã‚’importã—ã¦ãªã„ğŸ™…â€â™€ï¸
* [ ] ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–“ã®å‹ã¯DTOä¸­å¿ƒï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³å‹ã®æ¼ã‚ŒãŒå°‘ãªã„ï¼‰ğŸ§¼
* [ ] ä¾å­˜ã®åè»¢ãŒå¿…è¦ãªç®‡æ‰€ã¯`port(interface)`ï¼‹`adapter`ã«ãªã£ã¦ã‚‹ğŸ”
* [ ] â€œé…ç·šâ€ã¯composition rootã«é›†ã‚ã¦ã‚‹ğŸ€
* [ ] å¾ªç’°ä¾å­˜ãŒãªã„ğŸ’¥

---

## 8. ãŠã¾ã‘ï¼šå¢ƒç•Œã‚’ãƒ«ãƒ¼ãƒ«ã§å®ˆã‚‹è©±ï¼ˆè¶…ã•ã‚‰ã£ã¨ï¼‰ğŸ‘®â€â™€ï¸âœ¨

ESLintã§ã€Œã“ã“ã‹ã‚‰ã“ã“ã¯importç¦æ­¢ï¼ã€ã¿ãŸã„ãªå¢ƒç•Œãƒã‚§ãƒƒã‚¯ã‚‚ã§ãã‚‹ã‚ˆã€œğŸ§±
ãŸã¨ãˆã° `eslint-plugin-boundaries` ã¿ãŸã„ãªã‚„ã¤ğŸ§° ([NPM][3])
ï¼ˆã“ã®ç« ã§ã¯æ¦‚å¿µä¸­å¿ƒã€å®Ÿè£…ã¯â€œãƒ«ãƒ¼ãƒ«/CIå›â€ã§ã‚¬ãƒƒãƒ„ãƒªã‚„ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§OKï¼ï¼‰

---

## å‚è€ƒï¼š2026åˆé ­ã®â€œæœ€æ–°ãƒ„ãƒ¼ãƒ«äº‹æƒ…â€ãƒ¡ãƒ¢ğŸ—ï¸âœ¨ï¼ˆä¼šè©±ã®å®‰å¿ƒææ–™ï¼‰

* TypeScriptã®å®‰å®šæœ€æ–°ç‰ˆã¯ **5.9.3** ãŒnpmã§æœ€æ–°ã¨ã—ã¦æ¡ˆå†…ã•ã‚Œã¦ã‚‹ã‚ˆ ([NPM][4])
* ãã®ä¸€æ–¹ã§ã€å°†æ¥ã«å‘ã‘ã¦ **TypeScript 6.0/7.0**ï¼ˆãƒã‚¤ãƒ†ã‚£ãƒ–åŒ–å«ã‚€ï¼‰ã®è¨ˆç”»ãƒ»é€²æ—ã‚‚å…¬å¼ãŒå‡ºã—ã¦ã‚‹ ([Microsoft for Developers][5])
* Node.jsã¯ 2026-01 æ™‚ç‚¹ã§ **v24ãŒActive LTS** ãªã©ã€ãƒªãƒªãƒ¼ã‚¹è¡¨ãŒå…¬å¼ã«è¼‰ã£ã¦ã‚‹ã‚ˆ ([Node.js][6])

---

æ¬¡ã®ç« ï¼ˆç¬¬23ç« ï¼‰ã§ã€ã“ã®æµã‚Œã‚’ã€ŒDIPï¼ˆæŠ½è±¡ã«ä¾å­˜ã™ã‚‹ï¼‰ã€ã¨ã—ã¦ã€ã‚‚ã†ä¸€æ®µâ€œå‹â€ã«ã—ã¦ã„ãã‚ˆã€œğŸ”Œâ¬†ï¸ğŸ’–

[1]: https://en.wikipedia.org/wiki/Dependency_inversion_principle?utm_source=chatgpt.com "Dependency inversion principle"
[2]: https://martinfowler.com/articles/dipInTheWild.html?utm_source=chatgpt.com "DIP in the Wild"
[3]: https://www.npmjs.com/package/eslint-plugin-boundaries?utm_source=chatgpt.com "eslint-plugin-boundaries"
[4]: https://www.npmjs.com/package/typescript?utm_source=chatgpt.com "typescript"
[5]: https://devblogs.microsoft.com/typescript/progress-on-typescript-7-december-2025/?utm_source=chatgpt.com "Progress on TypeScript 7 - December 2025"
[6]: https://nodejs.org/en/about/previous-releases?utm_source=chatgpt.com "Node.js Releases"
