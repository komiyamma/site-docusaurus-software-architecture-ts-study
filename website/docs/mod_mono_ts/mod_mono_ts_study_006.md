# ç¬¬6ç« ï¼šè¨­è¨ˆã®è¶…åŸºç¤ã€Œé–¢å¿ƒã®åˆ†é›¢ã€ğŸ±âœ¨ï¼ˆSoCï¼‰

## ã“ã®ç« ã®ã‚´ãƒ¼ãƒ«ğŸ¯

* ã€Œ1ã¤ã®ã‚³ãƒ¼ãƒ‰ã«è‰²ã‚“ãªå½¹ç›®ãŒæ··ã–ã‚‹ã¨ã€ãªãœåœ°ç„ğŸ˜±ãªã®ã‹ã€ã‚’èª¬æ˜ã§ãã‚‹
* ã–ã£ãã‚Š **UI / æ¥­å‹™ãƒ«ãƒ¼ãƒ« / DB / å¤–éƒ¨I/O** ã‚’åˆ†ã‘ã¦è€ƒãˆã‚‰ã‚Œã‚‹
* â€œåˆ†ã‘ã‚‹â€ ã®ç¬¬ä¸€æ­©ã¨ã—ã¦ **ã€Œä¸­å¿ƒï¼ˆãƒ«ãƒ¼ãƒ«ï¼‰ã€ã¨ã€Œå¤–å´ï¼ˆé“å…·ï¼‰ã€** ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒæŒã¦ã‚‹ğŸŒ€

---

## 1) ã€Œé–¢å¿ƒã€ã£ã¦ãªã«ï¼ŸğŸ¤”ğŸ’­

**é–¢å¿ƒï¼ˆconcernï¼‰ï¼ãã®ã‚³ãƒ¼ãƒ‰ãŒâ€œæ°—ã«ã—ã¦ã‚‹ã“ã¨ï¼ˆå½¹ç›®ï¼‰â€** ã ã‚ˆã€œï¼

ãŸã¨ãˆã°ã€Œã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²ã€ã§ã‚‚ã€å®Ÿã¯åˆ¥ã€…ã®é–¢å¿ƒãŒæ··ã–ã‚ŠãŒã¡ğŸ‘‡

* ç”»é¢/UIã®éƒ½åˆï¼ˆå…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã€è¡¨ç¤ºãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰ğŸ–¥ï¸
* å…¥åŠ›ãƒã‚§ãƒƒã‚¯ï¼ˆç©ºæ¬„ã€æ–‡å­—æ•°ã€å½¢å¼ï¼‰âœ…
* æ¥­å‹™ãƒ«ãƒ¼ãƒ«ï¼ˆç· åˆ‡ã€å®šå“¡ã€é‡è¤‡ç¦æ­¢ï¼‰ğŸ“Œ
* DBã«ä¿å­˜ï¼ˆSQLã€ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ï¼‰ğŸ—„ï¸
* å¤–éƒ¨é€£æºï¼ˆãƒ¡ãƒ¼ãƒ«é€ä¿¡ã€æ±ºæ¸ˆã€é€šçŸ¥ï¼‰ğŸ“®

ã“ã‚Œã‚‰ã‚’ **åŒã˜é–¢æ•°ã«å…¨éƒ¨è©°ã‚è¾¼ã‚€** ã¨â€¦ã‚ã¨ã§æ³£ãğŸ˜­

â€»ã“ã®è€ƒãˆæ–¹ã¯ä¸€èˆ¬ã« **Separation of Concernsï¼ˆSoCï¼‰** ã¨å‘¼ã°ã‚Œã‚‹ã‚ˆã€œ ([ã‚¦ã‚£ã‚­ãƒšãƒ‡ã‚£ã‚¢][1])

---

## 2) æ··ãœã‚‹ã¨ä½•ãŒèµ·ãã‚‹ã®ï¼ŸğŸ˜µâ€ğŸ’«ï¼ˆâ€œåœ°ç„ãƒã‚¤ãƒ³ãƒˆâ€ï¼‰

### âœ… å¤‰æ›´ãŒæ€–ããªã‚‹

UIã®æ–‡è¨€ã‚’ç›´ã—ãŸã ã‘ãªã®ã«ã€æ¥­å‹™ãƒ«ãƒ¼ãƒ«ãŒå£Šã‚Œã‚‹â€¦ã¿ãŸã„ãªäº‹æ•…ğŸ’¥

### âœ… ãƒ†ã‚¹ãƒˆãŒã¤ã‚‰ã„

DBã‚„å¤–éƒ¨APIãŒçµ¡ã‚€ã¨ã€ãƒ†ã‚¹ãƒˆã®æº–å‚™ãŒé‡ããªã‚‹ğŸ§ªğŸ’¦
â†’ â€œãƒ«ãƒ¼ãƒ«ã ã‘â€ ã‚’è»½ããƒ†ã‚¹ãƒˆã§ããªããªã‚‹

### âœ… ä½¿ã„å›ã—ã§ããªã„

åŒã˜ã€Œã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²ã€ã‚’

* Webç”»é¢
* ç®¡ç†ç”»é¢
* ãƒãƒƒãƒå‡¦ç†
  ã§ä½¿ã„ãŸã„ã®ã«ã€UIä¾å­˜ã§å†åˆ©ç”¨ã§ããªã„ğŸ™…â€â™€ï¸

---

## 3) è¶…ã–ã£ãã‚Šå›³ï¼šä¸­å¿ƒã¨å¤–å´ğŸŒ€ğŸ§¡

ã¾ãšã¯ã“ã®ä¸€æšçµµã§OKï¼

[ DB / å¤–éƒ¨API ]      â† é“å…·ğŸ› ï¸ï¼ˆå…¥ã‚Œæ›¿ã‚ã‚Šã‚„ã™ã„ï¼‰
```

```mermaid
flowchart TD
    Req[Req: HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆ] -->|æ•´ãˆã‚‹| A[A: å…¥åŠ›å¤‰æ›<br/>parseInput]
    A -->|åˆ¤æ–­ã™ã‚‹| B[B: ãƒ«ãƒ¼ãƒ«åˆ¤å®š<br/>validateCreateEvent]
    B -->|ä¿å­˜ã™ã‚‹| C[C: DBä¿å­˜<br/>saveEvent]
    
    style A fill:#f1f8e9,stroke:#33691e
    style B fill:#e3f2fd,stroke:#1565c0,stroke-width:2px
    style C fill:#fff3e0,stroke:#e65100
```

ã“ã®ã€Œå†…å´ã»ã©å¤§äº‹ã€å¤–å´ã»ã©é“å…·ã€ã£ã¦ç™ºæƒ³ã¯ã€ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ç³»ã§ã‚‚ã‚ˆãèªã‚‰ã‚Œã‚‹ã‚ˆğŸŒ€ ([blog.cleancoder.com][2])

---

## 4) ä¾‹ï¼šæ··ã–ã£ãŸã‚³ãƒ¼ãƒ‰ï¼ˆã‚ã‚ŠãŒã¡ğŸ˜‡â†’ğŸ˜±ï¼‰

ã€Œã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²ã€ã‚’1é–¢æ•°ã«å…¨éƒ¨å…¥ã‚Œã¡ã‚ƒã†ã¨ã“ã†ãªã‚‹ğŸ‘‡

```ts
// âŒ ãœã‚“ã¶å…¥ã‚Šï¼šUIãƒ»æ¤œè¨¼ãƒ»æ¥­å‹™ãƒ«ãƒ¼ãƒ«ãƒ»DBãƒ»æ•´å½¢ãŒæ··åœ¨
export async function postCreateEvent(req: any, res: any, db: any) {
  const title = String(req.body.title ?? "").trim();
  const date = new Date(req.body.date);

  // å…¥åŠ›ãƒã‚§ãƒƒã‚¯
  if (!title) return res.status(400).send("ã‚¿ã‚¤ãƒˆãƒ«ã¯å¿…é ˆã§ã™");
  if (Number.isNaN(date.getTime())) return res.status(400).send("æ—¥ä»˜ãŒä¸æ­£ã§ã™");

  // æ¥­å‹™ãƒ«ãƒ¼ãƒ«ï¼ˆä¾‹ï¼šéå»æ—¥ç¦æ­¢ï¼‰
  const now = new Date();
  if (date < now) return res.status(400).send("éå»æ—¥ã¯ç™»éŒ²ã§ãã¾ã›ã‚“");

  // DBç›´æ›¸ã
  await db.query("INSERT INTO events(title, date) VALUES (?, ?)", [title, date.toISOString()]);

  // UIå‘ã‘ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•´å½¢
  return res.send(`ã‚¤ãƒ™ãƒ³ãƒˆã€Œ${title}ã€ã‚’ç™»éŒ²ã—ã¾ã—ãŸğŸ‰`);
}
```

ãƒ‘ãƒƒã¨è¦‹ã¯ã€Œå‹•ãã€ã‘ã©ã€ã‚ã¨ã§å¢—ç¯‰ã™ã‚‹ã¨å£Šã‚Œã‚„ã™ã„ã‚¿ã‚¤ãƒ—ğŸ˜±

---

## 5) åˆ†ã‘æ–¹ã®â€œã‚³ãƒ„â€ã¯ã“ã‚Œã ã‘ğŸ±âœ¨

### ãƒ«ãƒ¼ãƒ«ï¼š**ã€Œåˆ¤æ–­ã€ã¨ã€ŒI/Oã€ã‚’åˆ†ã‘ã‚‹**ğŸ§ â†”ï¸ğŸ”Œ

* **åˆ¤æ–­**ï¼æ¥­å‹™ãƒ«ãƒ¼ãƒ«ï¼ˆifã®å¡Šã€æˆå¦ã®æ±ºå®šï¼‰
* **I/O**ï¼DBã€HTTPã€å¤–éƒ¨APIã€ãƒ•ã‚¡ã‚¤ãƒ«ã€æ™‚é–“ï¼ˆDate.nowï¼‰ãªã©

ğŸ‘‰ **åˆ¤æ–­ï¼ˆãƒ«ãƒ¼ãƒ«ï¼‰ã¯ã€ã§ãã‚‹ã ã‘â€œç´”ç²‹â€ã«**ã™ã‚‹ã¨å¼·ã„ğŸ’ªâœ¨
ï¼ˆãƒ†ã‚¹ãƒˆã—ã‚„ã™ã„ï¼å†åˆ©ç”¨ã—ã‚„ã™ã„ï¼‰

---

## 6) ã¾ãšã¯â€œ3ã¤â€ã«å‰²ã‚‹ã ã‘ã§å‹ã¡ğŸ†âœ¨

![é–¢å¿ƒã®åˆ†é›¢ (Separation of Concerns)](./picture/mod_mono_ts_study_006_soc_layers.png)

ã“ã“ã§ã¯ç´°ã‹ã„å±¤ã¯å¾Œã§OKï¼ã¾ãšã¯ã“ã®3ã¤ğŸ¡

### A. å…¥åŠ›ã‚’æ•´ãˆã‚‹ï¼ˆUIå´ã®éƒ½åˆï¼‰ğŸ§¼

* req.body ã‚’å‹ã£ã½ãæ•´ãˆã‚‹
* ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆè¡¨ç¤ºç”¨ï¼‰ã‚‚ã“ã“å¯„ã‚Š

### B. ãƒ«ãƒ¼ãƒ«ã§åˆ¤å®šã™ã‚‹ï¼ˆä¸­å¿ƒï¼‰ğŸ’

* éå»æ—¥ç¦æ­¢ã€å®šå“¡ã€ç· åˆ‡ãªã©
* â€œã§ãã‚‹/ã§ããªã„â€ ã‚’æ±ºã‚ã‚‹

### C. ä¿å­˜ã™ã‚‹ï¼ˆé“å…·ï¼‰ğŸ—„ï¸

* DBã¸INSERT
* ã“ã“ã¯å°†æ¥å·®ã—æ›¿ãˆã‚„ã™ã„å ´æ‰€

---

## 7) åˆ†é›¢å¾Œã®ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼ˆã‚¹ãƒƒã‚­ãƒªç‰ˆğŸŒ¿ï¼‰

```ts
// âœ… A: å…¥åŠ›ã‚’æ•´ãˆã‚‹
type CreateEventInput = { title: string; dateISO: string };

function parseInput(body: any): CreateEventInput {
  return {
    title: String(body.title ?? "").trim(),
    dateISO: String(body.date ?? ""),
  };
}

// âœ… B: ãƒ«ãƒ¼ãƒ«ï¼ˆä¸­å¿ƒï¼‰
type CreateEventResult =
  | { ok: true }
  | { ok: false; message: string };

function validateCreateEvent(input: CreateEventInput, now: Date): CreateEventResult {
  if (!input.title) return { ok: false, message: "ã‚¿ã‚¤ãƒˆãƒ«ã¯å¿…é ˆã§ã™" };

  const date = new Date(input.dateISO);
  if (Number.isNaN(date.getTime())) return { ok: false, message: "æ—¥ä»˜ãŒä¸æ­£ã§ã™" };

  if (date < now) return { ok: false, message: "éå»æ—¥ã¯ç™»éŒ²ã§ãã¾ã›ã‚“" };

  return { ok: true };
}

// âœ… C: ä¿å­˜ï¼ˆé“å…·ï¼‰
async function saveEvent(db: any, input: CreateEventInput) {
  await db.query("INSERT INTO events(title, date) VALUES (?, ?)", [
    input.title,
    new Date(input.dateISO).toISOString(),
  ]);
}

// âœ… ã¾ã¨ã‚å½¹ï¼ˆController/Usecaseã£ã½ã„ï¼‰
export async function postCreateEvent(req: any, res: any, db: any) {
  const input = parseInput(req.body);

  const result = validateCreateEvent(input, new Date());
  if (!result.ok) return res.status(400).send(result.message);

  await saveEvent(db, input);
  return res.send(`ã‚¤ãƒ™ãƒ³ãƒˆã€Œ${input.title}ã€ã‚’ç™»éŒ²ã—ã¾ã—ãŸğŸ‰`);
}
```

ãƒã‚¤ãƒ³ãƒˆã¯ã“ã‚ŒğŸ‘‡

* **ãƒ«ãƒ¼ãƒ«ï¼ˆvalidateCreateEventï¼‰** ãŒ â€œå˜ä½“ã§èª­ã‚ã‚‹ï¼†ãƒ†ã‚¹ãƒˆã—ã‚„ã™ã„â€ ğŸ§ªâœ¨
* DBã‚„HTTPãŒå¤‰ã‚ã£ã¦ã‚‚ã€ä¸­å¿ƒãŒå·»ãè¾¼ã¾ã‚Œã«ãã„ğŸ›¡ï¸

---

## 8) ãƒŸãƒ‹æ¼”ç¿’ğŸ§©ğŸ—£ï¸ï¼ˆç´™ã«æ›¸ãã ã‘ã§ã‚‚OKï¼ï¼‰

### æ¼”ç¿’1ï¼šã“ã®é–¢æ•°ã€ä½•ã®é–¢å¿ƒãŒæ··ã–ã£ã¦ã‚‹ï¼ŸğŸ”

æœ€åˆã®ã€Œãœã‚“ã¶å…¥ã‚Šã‚³ãƒ¼ãƒ‰ã€ã‚’è¦‹ã¦ã€æ··ã–ã£ã¦ã‚‹é–¢å¿ƒã‚’ **æœ€ä½4ã¤** æ›¸ãå‡ºã—ã¦ã¿ã¦âœï¸
ï¼ˆä¾‹ï¼šå…¥åŠ›ãƒã‚§ãƒƒã‚¯ã€æ¥­å‹™ãƒ«ãƒ¼ãƒ«ã€DBã€è¡¨ç¤ºï¼‰

### æ¼”ç¿’2ï¼šãƒ«ãƒ¼ãƒ«ã ã‘é–¢æ•°ã«æŠœãâœ‚ï¸

* ã€Œéå»æ—¥ç¦æ­¢ã€ä»¥å¤–ã«ã€**ã‚‚ã†1ã¤** ãƒ«ãƒ¼ãƒ«ã‚’è¶³ã—ã¦
* ãã‚Œã‚‚ `validateCreateEvent` ã«å…¥ã‚Œã‚‹ï¼ˆä¾‹ï¼šã‚¿ã‚¤ãƒˆãƒ«20æ–‡å­—ã¾ã§ï¼‰ğŸ“

### æ¼”ç¿’3ï¼šæ™‚é–“ã‚’å¤–ã‹ã‚‰æ¸¡ã™â°â¡ï¸

* `new Date()` ã‚’ãƒ«ãƒ¼ãƒ«é–¢æ•°ã®å¤–ã§ä½œã£ã¦æ¸¡ã™ï¼ˆä»Šã‚„ã£ãŸã‚„ã¤ï¼ï¼‰
* ã“ã‚ŒãŒã§ãã‚‹ã¨ãƒ†ã‚¹ãƒˆãŒä¸€æ°—ã«ãƒ©ã‚¯ã«ãªã‚‹ã‚ˆã€œğŸ§ªğŸ’š

---

## 9) AIã«é ¼ã‚‹ã¨å¼·ã„ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹ğŸ¤–ğŸ“

### â‘  é–¢å¿ƒã®æ´—ã„å‡ºã—

* ã€Œã“ã®é–¢æ•°ã®è²¬å‹™ï¼ˆé–¢å¿ƒï¼‰ã‚’åˆ—æŒ™ã—ã¦ã€åˆ†é›¢æ¡ˆã‚’å‡ºã—ã¦ã€‚UI/æ¥­å‹™/DB/å¤–éƒ¨I/Oã«åˆ†é¡ã—ã¦ã€

### â‘¡ åˆ†é›¢ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿æ¡ˆ

* ã€Œã“ã®ã‚³ãƒ¼ãƒ‰ã‚’ â€œparse / validate / persistâ€ ã®3åˆ†å‰²ã«ãƒªãƒ•ã‚¡ã‚¯ã‚¿ã—ã¦ã€‚TypeScriptã§ã€é–¢æ•°ã®å…¥å‡ºåŠ›ã®å‹ã‚‚ä»˜ã‘ã¦ã€

### â‘¢ ãƒ«ãƒ¼ãƒ«é–¢æ•°ã®ãƒ†ã‚¹ãƒˆè¦³ç‚¹

* ã€ŒvalidateCreateEvent ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’å¢ƒç•Œå€¤ä¸­å¿ƒã«10å€‹ã€‚æ—¥æœ¬èªã§ç†ç”±ã‚‚æ·»ãˆã¦ã€

---

## 10) ã“ã®ç« ã®ã¾ã¨ã‚ğŸ±ğŸ’–

* **SoCï¼å½¹ç›®ã‚’åˆ†ã‘ã‚‹**ï¼ˆæ··ãœã‚‹ã¨å¤‰æ›´ãƒ»ãƒ†ã‚¹ãƒˆãƒ»å†åˆ©ç”¨ãŒã—ã‚“ã©ã„ï¼‰ ([ã‚¦ã‚£ã‚­ãƒšãƒ‡ã‚£ã‚¢][1])
* ã¾ãšã¯ **åˆ¤æ–­ï¼ˆãƒ«ãƒ¼ãƒ«ï¼‰** ã¨ **I/Oï¼ˆDBãƒ»HTTPãƒ»å¤–éƒ¨ï¼‰** ã‚’åˆ†ã‘ã‚ˆã†ğŸ§ â†”ï¸ğŸ”Œ
* â€œä¸­å¿ƒã¨å¤–å´â€ ã®æ„Ÿè¦šãŒã€ã‚ã¨ã§ **ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å¢ƒç•Œ** ã‚’ä½œã‚‹åœŸå°ã«ãªã‚‹ğŸ§©âœ¨

---

## ãŠã¾ã‘ï¼šç’°å¢ƒã¾ã‚ã‚Šã®â€œæœ€æ–°ã¡ã‚‡ã„ãƒ¡ãƒ¢â€ğŸªŸğŸ§ 

ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£çš„ã«ã€Node.jsã¯LTSã®æ›´æ–°ãŒã¡ã‚‡ã“ã¡ã‚‡ã“å…¥ã‚‹ã‚ˆã€œã®è©±ğŸ“Œï¼‰

* Node.js ã¯ **v24 ç³»ãŒ Active LTS** ã¨ã—ã¦æ›´æ–°ã•ã‚Œã¦ã„ã‚‹ã‚ˆ ([Node.js][3])
* TypeScript ã¯ **5.9 ç³»ã®ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆãŒæ›´æ–°**ã•ã‚Œã¦ã‚‹ï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæœ€çµ‚æ›´æ–°ã‚‚æ–°ã—ã‚ï¼‰ ([typescriptlang.org][4])

æ¬¡ç« ï¼ˆç¬¬7ç« ï¼‰ã§ã€ã“ã®ã€Œåˆ†ã‘ãŸããªã‚‹æ°—æŒã¡ğŸ±ã€ã‚’ **â€œãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®æ€æƒ³â€** ã«æ¥ç¶šã—ã¦ã„ãã‚ˆã€œğŸ§©ğŸš€

[1]: https://en.wikipedia.org/wiki/Separation_of_concerns?utm_source=chatgpt.com "Separation of concerns"
[2]: https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html?utm_source=chatgpt.com "The Clean Architecture by Uncle Bob - Clean Coder Blog"
[3]: https://nodejs.org/en/about/previous-releases?utm_source=chatgpt.com "Node.js Releases"
[4]: https://www.typescriptlang.org/docs/handbook/release-notes/typescript-5-9.html?utm_source=chatgpt.com "Documentation - TypeScript 5.9"
