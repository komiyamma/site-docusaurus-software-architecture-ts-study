# ç¬¬35ç«  ä¸å¤‰æ¡ä»¶ï¼ˆInvariantsï¼‰ã‚’å…¥å£ã§å®ˆã‚‹ğŸ”’ğŸšª

## 0. ä»Šæ—¥ã®ã‚´ãƒ¼ãƒ«ğŸ¯âœ¨

ã“ã®ç« ãŒçµ‚ã‚ã£ãŸã‚‰ã€ã“ã‚ŒãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã‚ˆğŸ˜ŠğŸ’¡

* ã€Œä¸å¤‰æ¡ä»¶ï¼ˆInvariantsï¼‰ã€ãŒä½•ã‹èª¬æ˜ã§ãã‚‹ğŸ§ âœ¨
* ã€Œå…¥å£ï¼ˆã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆï¼‰ã€ã‚’æ„è­˜ã—ã¦ã€å£Šã‚ŒãŸçŠ¶æ…‹ã‚’ä½œã‚‰ãªã„è¨­è¨ˆã«ã§ãã‚‹ğŸšªğŸ›¡ï¸
* ä¾‹é¡Œï¼ˆå­¦å†…ãƒ•ãƒªãƒğŸ›ï¸ï¼‰ã®BCã§ã€Œå®ˆã‚ŠãŸã„ãƒ«ãƒ¼ãƒ«ã€ã‚’ã‚³ãƒ¼ãƒ‰ã«è½ã¨ã›ã‚‹âœï¸ğŸ’»
* AIç›¸æ£’ğŸ¤–ã«ãƒ¬ãƒ“ãƒ¥ãƒ¼ã•ã›ã¦ã€æŠœã‘æ¼ã‚Œã‚’æ¸›ã‚‰ã›ã‚‹âœ…âœ¨

---

## 1. ä¸å¤‰æ¡ä»¶ã£ã¦ãªã«ï¼ŸğŸ§±ğŸ”’

![ã‚¤ãƒ¡ãƒ¼ã‚¸](./picture/bc_ts_study_035_invariants.png)

**ä¸å¤‰æ¡ä»¶ï¼ˆInvariantï¼‰**ã¯ã€ã‹ã‚“ãŸã‚“ã«è¨€ã†ã¨ğŸ‘‡

> ã€Œã“ã®BCã®ä¸­ã§ã¯ã€ã„ã¤ã§ã‚‚å¿…ãšæˆã‚Šç«‹ã£ã¦ã„ã¦ã»ã—ã„ãƒ«ãƒ¼ãƒ«ã€ğŸ›¡ï¸âœ¨

ãŸã¨ãˆã°å­¦å†…ãƒ•ãƒªãƒğŸ›ï¸ã® **å‡ºå“ï¼ˆListingï¼‰BC** ãªã‚‰â€¦

* ä¾¡æ ¼ã¯ **0å††ä»¥ä¸‹ã«ãªã‚‰ãªã„** ğŸ’°ğŸš«
* ã‚¿ã‚¤ãƒˆãƒ«ã¯ **ç©ºã˜ã‚ƒãªã„** ğŸ·ï¸ğŸš«
* å‡ºå“ãŒã€Œå£²å´æ¸ˆã¿ã€ãªã‚‰ **ã‚‚ã†ä¾¡æ ¼å¤‰æ›´ã§ããªã„** ğŸ”ğŸš«
* ã€Œå…¬é–‹ã€ã™ã‚‹ãªã‚‰ **å¿…è¦ãªæƒ…å ±ãŒæƒã£ã¦ã„ã‚‹** âœ…ğŸ“¦

ã“ã†ã„ã†ã®ãŒã€Œä¸å¤‰æ¡ä»¶ã€ã ã‚ˆğŸ˜Šâœ¨
ãƒã‚¤ãƒ³ãƒˆã¯ **â€œãƒ¢ãƒ‡ãƒ«ã®ä¸­ã‚’å¸¸ã«æ­£ã—ã„çŠ¶æ…‹ã«ä¿ã¤â€** ã£ã¦ã“ã¨ğŸ§¼ğŸ§ 

---

## 2. ã€Œå…¥åŠ›ãƒã‚§ãƒƒã‚¯ã€ã¨ä¸å¤‰æ¡ä»¶ã¯ã€ä¼¼ã¦ã‚‹ã‘ã©åˆ¥ã‚‚ã®ğŸ§ªğŸ†šğŸ§±

æ··ã–ã‚Šã‚„ã™ã„ã®ã§ã€ã“ã“è¶…å¤§äº‹ğŸ’¡

### å…¥åŠ›ãƒã‚§ãƒƒã‚¯ï¼ˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ğŸ§ª

* ç”»é¢å…¥åŠ›ã‚„APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã¿ãŸã„ãª **æœªçŸ¥ã®ãƒ‡ãƒ¼ã‚¿** ã‚’å¼¾ãğŸš«
* ã“ã“ã§ã¯ã‚¹ã‚­ãƒ¼ãƒãƒãƒªãƒ‡ãƒ¼ã‚¿ï¼ˆä¾‹ï¼šZod / Valibotï¼‰ã‚’ä½¿ã†ã“ã¨ãŒå¤šã„ã‚ˆğŸ“¦âœ¨

  * Zod 4 ã¯ã€Œå®‰å®šç‰ˆã€ã¨ã—ã¦å…¬é–‹ã•ã‚Œã¦ã‚‹ã‚ˆğŸ“Œ ([Zod][1])
  * Valibot ã¯TypeScriptå‘ã‘ã®ã‚¹ã‚­ãƒ¼ãƒãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã—ã¦æ¡ˆå†…ã•ã‚Œã¦ã‚‹ã‚ˆğŸ“Œ ([valibot.dev][2])

### ä¸å¤‰æ¡ä»¶ï¼ˆInvariantsï¼‰ğŸ§±

* â€œãƒ¢ãƒ‡ãƒ«ãŒå­˜åœ¨ã™ã‚‹é™ã‚Šâ€ ãšã£ã¨å®ˆã‚ŠãŸã„ãƒ«ãƒ¼ãƒ«ğŸ”’
* å…¥åŠ›ãƒã‚§ãƒƒã‚¯ã‚’ã™ã‚ŠæŠœã‘ã¦ã‚‚ã€**ãƒ¢ãƒ‡ãƒ«å†…éƒ¨ã§çµ¶å¯¾ã«å£Šã‚Œãªã„** ã‚ˆã†ã«ã™ã‚‹ğŸ›¡ï¸

ã¤ã¾ã‚Šâ€¦

* å…¥åŠ›ãƒã‚§ãƒƒã‚¯ï¼šå…¥å£ã®ã€Œé–€ç•ªã€ğŸ§â€â™€ï¸ğŸšª
* ä¸å¤‰æ¡ä»¶ï¼šä¸­ã«å…¥ã£ã¦ã‹ã‚‰ã‚‚ã€Œç§©åºã‚’ä¿ã¤æ³•å¾‹ã€âš–ï¸ğŸ›ï¸

ä¸¡æ–¹ã„ã‚‹ã‚ˆğŸ˜Šâœ¨

---

## 3. ã€Œå…¥å£ã€ã£ã¦ã©ã“ï¼ŸğŸšªğŸ‘€

ä¸å¤‰æ¡ä»¶ã¯ **â€œå…¥å£ã§å®ˆã‚‹â€** ã®ãŒã‚³ãƒ„ã ã‚ˆğŸ”’âœ¨

```mermaid
flowchart LR
    Req[å¤–éƒ¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆ] -- "1. å…¥åŠ›ãƒã‚§ãƒƒã‚¯<br/>(Zodç­‰)" --> Gate[é–€ç•ª / å…¥å£]
    Gate -- "2. ç”Ÿæˆãƒ»å¤‰æ›<br/>(VO / ACL)" --> Protect[ä¸å¤‰æ¡ä»¶ã®ä¿è­·]
    Protect -- "3. æ“ä½œãƒ¡ã‚½ãƒƒãƒ‰" --> Correct[å¸¸ã«æ­£ã—ã„çŠ¶æ…‹]
    
    style Protect fill:#E8F5E9,stroke:#2E7D32
```
å…¥å£ã£ã¦ã„ã†ã®ã¯ã€ã–ã£ãã‚Šã“ã†ã„ã†å ´æ‰€ğŸ‘‡

* **ç”Ÿæˆã®å…¥å£**ï¼š`create()` / `from()` / `new` ç›¸å½“ã®å ´æ‰€ğŸ§¸
* **æ›´æ–°ã®å…¥å£**ï¼š`changePrice()` / `publish()` ã¿ãŸã„ãªã€Œæ“ä½œãƒ¡ã‚½ãƒƒãƒ‰ã€ğŸ®
* **ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®å…¥å£**ï¼š`CreateListingUseCase` ã¿ãŸã„ãªã‚¢ãƒ—ãƒªå±¤ã®å‡¦ç†ğŸ“©
* **å¢ƒç•Œã®å…¥å£**ï¼šå¤–éƒ¨ã‹ã‚‰æ¥ãŸDTOã‚’å†…éƒ¨ãƒ¢ãƒ‡ãƒ«ã«å¤‰æ›ã™ã‚‹å ´æ‰€ï¼ˆACL/å¤‰æ›ï¼‰ğŸ“¦ğŸ§¼

ã“ã®ç« ã®åˆè¨€è‘‰ã¯ã“ã‚ŒğŸ‘‡

> ã€Œå£Šã‚ŒãŸçŠ¶æ…‹ã‚’ â€œä½œã‚Œãªã„/å…¥ã‚Œãªã„â€ ã‚ˆã†ã«ã™ã‚‹ã€ğŸ”’ğŸš«

---

## 4. ã‚ˆãã‚ã‚‹äº‹æ•…ğŸ˜±ğŸ’¥ï¼ˆã“ã‚Œã€ã‚ã£ã¡ã‚ƒèµ·ãã‚‹ï¼‰

### äº‹æ•…ãƒ‘ã‚¿ãƒ¼ãƒ³Aï¼šã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãŒè‡ªç”±ã™ãã‚‹ğŸŒ€

* ã©ã“ã‹ã‚‰ã§ã‚‚ `new Listing(...)` ã§ãã‚‹
* ã¤ã¾ã‚Šã€ã©ã“ã‹ã‚‰ã§ã‚‚å£Šã›ã‚‹ğŸ˜±

### äº‹æ•…ãƒ‘ã‚¿ãƒ¼ãƒ³Bï¼šãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒæ›¸ãæ›ãˆæ”¾é¡Œâœï¸ğŸ’£

* `listing.price = -100;` ã¿ãŸã„ãªã®ãŒé€šã‚‹
* â€œå£Šã‚ŒãŸå‡ºå“â€ ãŒBCå†…ã«å­˜åœ¨ã—ã¡ã‚ƒã†ğŸ˜µ

### äº‹æ•…ãƒ‘ã‚¿ãƒ¼ãƒ³Cï¼šã€Œã¨ã‚Šã‚ãˆãš anyã€ğŸ« 

* ä¸€ç¬ãƒ©ã‚¯ã ã‘ã©ã€å¾Œã§åœ°ç„ğŸ‘¹
* ä¸å¤‰æ¡ä»¶ãŒå´©å£Šã—ã¦ã‚‚æ°—ã¥ã‘ãªã„â€¦

---

## 5. å…¥å£ã§å®ˆã‚‹ãŸã‚ã®åŸºæœ¬ã‚»ãƒƒãƒˆğŸ§°âœ¨

åˆå¿ƒè€…ã€œä¸­ç´šãªã‚‰ã€ã¾ãšã“ã®3ç‚¹ã‚»ãƒƒãƒˆãŒå¼·ã„ã‚ˆğŸ’ªğŸ˜Š

1. **Value Objectã§å°ã•ãå®ˆã‚‹** ğŸ’
2. **Entity/Aggregateã®ãƒ¡ã‚½ãƒƒãƒ‰ã§å®ˆã‚‹** ğŸ§±
3. **Resultå‹ã§å¤±æ•—ã‚’å®‰å…¨ã«è¿”ã™** ğŸ§¾

ã“ã®ã‚ã¨ã€ãƒŸãƒ‹å®Ÿè£…ã§å…¨éƒ¨ä½¿ã†ã‚ˆã€œğŸ›ï¸âœ¨

---

## 6. ãƒŸãƒ‹å®Ÿè£…ï¼šå‡ºå“ï¼ˆListingï¼‰BCã§ã€Œå£Šã‚ŒãŸå‡ºå“ã€ã‚’å°å°ã™ã‚‹ğŸ›¡ï¸ğŸ“¦

### 6-1. Resultå‹ï¼ˆæˆåŠŸ/å¤±æ•—ã‚’å®‰å…¨ã«è¡¨ç¾ï¼‰ğŸ§¾âœ¨

```ts
export type Result<T, E> =
  | { ok: true; value: T }
  | { ok: false; error: E };

export const ok = <T>(value: T): Result<T, never> => ({ ok: true, value });
export const err = <E>(error: E): Result<never, E> => ({ ok: false, error });
```

---

### 6-2. ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼ï¼ˆä½•ãŒãƒ€ãƒ¡ã‹ã‚’è¨€ãˆã‚‹ã‚ˆã†ã«ï¼‰ğŸ§¯ğŸ’¬

```ts
export type DomainError =
  | { type: "invalid_title"; reason: string }
  | { type: "invalid_price"; reason: string }
  | { type: "invalid_status_transition"; reason: string }
  | { type: "invalid_operation"; reason: string };
```

---

### 6-3. Value Objectï¼šTitleï¼ˆã‚¿ã‚¤ãƒˆãƒ«ã¯ç©ºNGï¼†é•·ã•åˆ¶é™ï¼‰ğŸ·ï¸ğŸ”’

```ts
import { Result, ok, err } from "./result";
import { DomainError } from "./errors";

export class Title {
  private constructor(private readonly value: string) {}

  static create(raw: string): Result<Title, DomainError> {
    const trimmed = raw.trim();
    if (trimmed.length === 0) {
      return err({ type: "invalid_title", reason: "ã‚¿ã‚¤ãƒˆãƒ«ãŒç©ºã£ã½ã ã‚ˆğŸ¥º" });
    }
    if (trimmed.length > 80) {
      return err({ type: "invalid_title", reason: "ã‚¿ã‚¤ãƒˆãƒ«ã¯80æ–‡å­—ã¾ã§ã ã‚ˆğŸ“" });
    }
    return ok(new Title(trimmed));
  }

  toString(): string {
    return this.value;
  }
}
```

---

### 6-4. Value Objectï¼šMoneyï¼ˆä¾¡æ ¼ã¯æ­£ã®æ•´æ•°ã ã‘ï¼‰ğŸ’°ğŸ”’

```ts
import { Result, ok, err } from "./result";
import { DomainError } from "./errors";

export class Money {
  private constructor(private readonly amount: number) {}

  static yen(amount: number): Result<Money, DomainError> {
    if (!Number.isInteger(amount)) {
      return err({ type: "invalid_price", reason: "ä¾¡æ ¼ã¯æ•´æ•°ãŒã„ã„ã‚ˆğŸ”¢" });
    }
    if (amount <= 0) {
      return err({ type: "invalid_price", reason: "ä¾¡æ ¼ã¯1å††ä»¥ä¸Šã ã‚ˆğŸ’´" });
    }
    if (amount > 1_000_000) {
      return err({ type: "invalid_price", reason: "é«˜ã™ãã‚‹ã‹ã‚‚â€¦ä¸Šé™ã‚’æ±ºã‚ã‚ˆã†ğŸ’¦" });
    }
    return ok(new Money(amount));
  }

  get value(): number {
    return this.amount;
  }
}
```

---

### 6-5. Entityï¼šListingï¼ˆçŠ¶æ…‹ã¨æ“ä½œã§ä¸å¤‰æ¡ä»¶ã‚’å®ˆã‚‹ï¼‰ğŸš¦ğŸ§±

ã“ã“ãŒã€Œå…¥å£ã§å®ˆã‚‹ã€ã®æœ¬ä½“ã ã‚ˆğŸ”’âœ¨

```ts
import { Result, ok, err } from "./result";
import { DomainError } from "./errors";
import { Title } from "./title";
import { Money } from "./money";

type ListingStatus = "draft" | "published" | "sold" | "closed";

export class Listing {
  private constructor(
    private readonly id: string,
    private title: Title,
    private price: Money,
    private status: ListingStatus
  ) {}

  // âœ… ç”Ÿæˆã®å…¥å£ï¼ˆã“ã“ä»¥å¤–ã§ new ã—ãªã„ï¼‰
  static createDraft(params: {
    id: string;
    title: Title;
    price: Money;
  }): Listing {
    return new Listing(params.id, params.title, params.price, "draft");
  }

  // âœ… æ›´æ–°ã®å…¥å£ï¼ˆãƒ¡ã‚½ãƒƒãƒ‰ã§ã—ã‹å¤‰ãˆã‚‰ã‚Œãªã„ï¼‰
  changePrice(newPrice: Money): Result<void, DomainError> {
    if (this.status !== "draft" && this.status !== "published") {
      return err({
        type: "invalid_operation",
        reason: "å£²å´æ¸ˆã¿/çµ‚äº†å¾Œã¯ä¾¡æ ¼å¤‰æ›´ã§ããªã„ã‚ˆğŸš«",
      });
    }
    this.price = newPrice;
    return ok(undefined);
  }

  publish(): Result<void, DomainError> {
    if (this.status !== "draft") {
      return err({
        type: "invalid_status_transition",
        reason: "ä¸‹æ›¸ãä»¥å¤–ã¯å…¬é–‹ã«ã§ããªã„ã‚ˆğŸš¦",
      });
    }
    // ğŸ‘‡ ã“ã“ã§ã€Œå…¬é–‹ã«å¿…è¦ãªæ¡ä»¶ã€ã‚’é›†ä¸­ç®¡ç†ã§ãã‚‹âœ¨
    // ï¼ˆä¾‹ï¼šã‚¿ã‚¤ãƒˆãƒ«/ä¾¡æ ¼ãŒã™ã§ã«VOã§å®ˆã‚‰ã‚Œã¦ã‚‹ã®ã§å®‰å¿ƒï¼‰
    this.status = "published";
    return ok(undefined);
  }

  markSold(): Result<void, DomainError> {
    if (this.status !== "published") {
      return err({
        type: "invalid_status_transition",
        reason: "å…¬é–‹ä¸­ã ã‘ãŒå£²å´æ¸ˆã¿ã«ã§ãã‚‹ã‚ˆğŸ›ï¸â¡ï¸ğŸ’³",
      });
    }
    this.status = "sold";
    return ok(undefined);
  }

  close(): Result<void, DomainError> {
    if (this.status === "closed") {
      return ok(undefined); // ã‚‚ã†é–‰ã˜ã¦ãŸã‚‰OKæ‰±ã„ã§ã‚‚è‰¯ã„ï¼ˆå†ªç­‰ã£ã½ãï¼‰ğŸ˜Š
    }
    if (this.status === "draft") {
      return err({
        type: "invalid_status_transition",
        reason: "ä¸‹æ›¸ãã¯é–‰ã˜ã‚‹å‰ã«å…¬é–‹ã™ã‚‹ãƒ«ãƒ¼ãƒ«ã«ã—ã‚ˆã†ğŸšª",
      });
    }
    this.status = "closed";
    return ok(undefined);
  }

  snapshot() {
    return {
      id: this.id,
      title: this.title.toString(),
      priceYen: this.price.value,
      status: this.status,
    };
  }
}
```

ã“ã“ã§å¤§äº‹ãªã®ã¯ğŸ‘‡âœ¨

* **VOãŒå…¥åŠ›ã®å½¢ã‚’å®ˆã‚‹**ï¼ˆTitle/Moneyï¼‰ğŸ’
* **Entityã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒçŠ¶æ…‹ã®ãƒ«ãƒ¼ãƒ«ã‚’å®ˆã‚‹**ï¼ˆpublish/markSoldãªã©ï¼‰ğŸš¦
* çµæœã¯ **Resultã§è¿”ã™**ï¼ˆå‘¼ã³å‡ºã—å´ãŒå®‰å…¨ã«æ‰±ãˆã‚‹ï¼‰ğŸ§¾âœ…

---

## 7. æ¼”ç¿’ï¼šä¸å¤‰æ¡ä»¶ã‚’5ã¤ä½œã£ã¦ã€å…¥å£ã«ç½®ã“ã†âœï¸ğŸ§ âœ¨

### ã‚¹ãƒ†ãƒƒãƒ—1ï¼šãƒ«ãƒ¼ãƒ«å€™è£œã‚’å‡ºã™ğŸ“

ä¾‹ï¼ˆå‡ºå“BCï¼‰ğŸ‘‡

```mermaid
mindmap
  root((å®ˆã‚‹ã¹ãä¸å¤‰æ¡ä»¶))
    ç”Ÿæˆæ™‚ã®ãƒ«ãƒ¼ãƒ«
      ã‚¿ã‚¤ãƒˆãƒ«å¿…é ˆ
      ä¾¡æ ¼1å††ä»¥ä¸Š
    æ“ä½œæ™‚ã®ãƒ«ãƒ¼ãƒ«
      å…¬é–‹ã¯ä¸‹æ›¸ãã‹ã‚‰ã®ã¿
      å£²å´å¾Œã®ä¾¡æ ¼å¤‰æ›´ç¦æ­¢
    ãƒ‡ãƒ¼ã‚¿ã®æ•´åˆæ€§
      çŠ¶æ…‹ã¨æ“ä½œã®ä¸ä¸€è‡´é˜²æ­¢
      IDã®é‡è¤‡ç¦æ­¢
```

* ã‚¿ã‚¤ãƒˆãƒ«ã¯ç©ºNG
* ä¾¡æ ¼ã¯1å††ä»¥ä¸Š
* å…¬é–‹ã¯ä¸‹æ›¸ãã‹ã‚‰ã ã‘
* å£²å´æ¸ˆã¿å¾Œã¯ä¾¡æ ¼å¤‰æ›´NG
* çµ‚äº†å¾Œã¯ä½•ã‚‚å¤‰æ›´ã§ããªã„ï¼ˆã¾ãŸã¯ä¸€éƒ¨ã ã‘ï¼‰

### ã‚¹ãƒ†ãƒƒãƒ—2ï¼šã€Œã„ã¤ã§ã‚‚å¿…ãšå®ˆã‚ŠãŸã„ï¼Ÿã€ã§ãµã‚‹ã„åˆ†ã‘ğŸ§º

* **ã„ã¤ã§ã‚‚å¿…ãšå®ˆã‚ŠãŸã„** â†’ ä¸å¤‰æ¡ä»¶âœ…
* **ç”»é¢ã ã‘ã®éƒ½åˆ** â†’ å…¥åŠ›ãƒã‚§ãƒƒã‚¯å´ğŸ§ª
* **ä»–BCã®äº‹æƒ…** â†’ ã“ã“ã«æ··ãœãªã„ï¼ˆå¿…è¦ãªã‚‰ACL/çµ±åˆå´ï¼‰ğŸ§¼ğŸ”—

### ã‚¹ãƒ†ãƒƒãƒ—3ï¼šã©ã®å…¥å£ã§å®ˆã‚‹ã‹æ±ºã‚ã‚‹ğŸšª

* ç”Ÿæˆæ™‚ã«ã—ã‹æ±ºã¾ã‚‰ãªã„ â†’ `create...()`
* æ“ä½œã§å¤‰ã‚ã‚‹ â†’ `change...()` / `publish()`
* å¤–éƒ¨å…¥åŠ›ã®å½¢ â†’ DTOâ†’VOå¤‰æ›ã‚„ã‚¹ã‚­ãƒ¼ãƒãƒã‚§ãƒƒã‚¯

---

## 8. AIç›¸æ£’ğŸ¤–ã«é ¼ã‚€ã¨å¼·ã„ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹âœ¨

### ä¸å¤‰æ¡ä»¶ã®æ´—ã„å‡ºã—ğŸ§ ğŸ“

* ã€Œå‡ºå“ï¼ˆListingï¼‰BCã®ä¸å¤‰æ¡ä»¶ã‚’10å€‹ææ¡ˆã—ã¦ã€‚åˆå¿ƒè€…å‘ã‘ã«ã€ç†ç”±ã‚‚1è¡Œãšã¤ã¤ã‘ã¦ã€ğŸ¤–âœ¨

### æŠœã‘æ¼ã‚Œãƒ¬ãƒ“ãƒ¥ãƒ¼ğŸ‘€âœ…

* ã€Œã“ã®Entityã®ãƒ¡ã‚½ãƒƒãƒ‰ã§ç ´ã‚Œã‚‹ä¸å¤‰æ¡ä»¶ãŒãªã„ã‹æ¢ã—ã¦ã€‚ç ´ã‚Œã‚‹ãªã‚‰å†ç¾æ‰‹é †ã‚‚æ›¸ã„ã¦ã€ğŸ•µï¸â€â™€ï¸ğŸ¤–

### ãƒ†ã‚¹ãƒˆç”ŸæˆğŸ§ª

* ã€Œpublish / markSold / changePrice ã®æ­£å¸¸ç³»ãƒ»ç•°å¸¸ç³»ãƒ†ã‚¹ãƒˆã‚’ä½œã£ã¦ã€‚Resultã®ã‚¨ãƒ©ãƒ¼å‹ã‚‚ç¢ºèªã—ã¦ã€âœ…ğŸ§ªğŸ¤–

---

## 9. ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆâœ…âœ¨ï¼ˆæå‡ºå‰ã«ã“ã‚Œè¦‹ã‚‹ã¨äº‹æ•…ãŒæ¸›ã‚‹ã‚ˆï¼‰

* [ ] `new` ã‚’å¤–ã‹ã‚‰å‘¼ã¹ãªã„ï¼ˆç”Ÿæˆã®å…¥å£ãŒ1ã¤ï¼‰ğŸ”’
* [ ] ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ç›´æ›¸ãæ›ãˆãŒã§ããªã„ï¼ˆæ›´æ–°ã¯ãƒ¡ã‚½ãƒƒãƒ‰ã ã‘ï¼‰âœï¸ğŸš«
* [ ] â€œå£Šã‚ŒãŸçŠ¶æ…‹â€ ã‚’è¡¨ã™å€¤ãŒå‹/VOã§ä½œã‚Œãªã„ğŸ’
* [ ] çŠ¶æ…‹é·ç§»ï¼ˆdraftâ†’publishedâ†’soldâ€¦ï¼‰ãŒã‚³ãƒ¼ãƒ‰ã«æ˜æ–‡åŒ–ã•ã‚Œã¦ã‚‹ğŸš¦

```mermaid
stateDiagram-v2
    [*] --> Draft: createDraft()
    Draft --> Published: publish()
    Published --> Sold: markSold()
    Published --> Closed: close()
    Sold --> Closed: close()
    Draft --> Closed: close()
    
    note right of Published
        å…¬é–‹ä¸­: ä¾¡æ ¼å¤‰æ›´OK
    end note
    note right of Sold
        å£²å´å¾Œ: ä¾¡æ ¼å¤‰æ›´ç¦æ­¢ğŸš«
    end note
```
* [ ] å¤±æ•—ãŒResult/ã‚¨ãƒ©ãƒ¼ã§èª¬æ˜ã§ãã‚‹ï¼ˆé»™ã£ã¦å£Šã‚Œãªã„ï¼‰ğŸ§¾
ãªã©ã€AIã¨ä¸€ç·’ã«è€ƒãˆãªãŒã‚‰ã€Œå®ˆå‚™ç¯„å›²ã€ã‚’åºƒã’ã¦ã„ã“ã†ã­ğŸ˜ŠğŸ§¤

![ã‚¤ãƒ¡ãƒ¼ã‚¸](./picture/bc_ts_study_035_invariant_validation_diff.png)

---

## 10. ã¾ã¨ã‚ğŸâœ¨

* ä¸å¤‰æ¡ä»¶ã¯ã€ŒBCã®ä¸­ã§ã¯ãšã£ã¨å®ˆã‚ŠãŸã„ãƒ«ãƒ¼ãƒ«ã€ğŸ”’ğŸ§±
* å…¥å£ï¼ˆç”Ÿæˆãƒ»æ›´æ–°ãƒ»ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ãƒ»å¢ƒç•Œå¤‰æ›ï¼‰ã§å®ˆã‚‹ã¨å¼·ã„ğŸšªğŸ›¡ï¸
* VOï¼‹Entityãƒ¡ã‚½ãƒƒãƒ‰ï¼‹Resultå‹ã®3ç‚¹ã‚»ãƒƒãƒˆãŒåˆå¿ƒè€…ã«è¶…ãŠã™ã™ã‚ğŸ’ğŸ§±ğŸ§¾
* ã‚¹ã‚­ãƒ¼ãƒãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆZod/Valibotç­‰ï¼‰ã¯ã€ŒæœªçŸ¥ãƒ‡ãƒ¼ã‚¿ã®é–€ç•ªã€ã¨ã—ã¦ç›¸æ€§â—ğŸ§ªğŸšª ([Zod][1])
* TypeScriptã®æœ€æ–°å®‰å®šç‰ˆãƒ©ã‚¤ãƒ³ã¯ npm ä¸Šã§ 5.9.3 ãŒæœ€æ–°ã¨ã—ã¦æ²è¼‰ã•ã‚Œã¦ã„ã‚‹ã‚ˆğŸ“Œ ([npmjs.com][3])

[1]: https://zod.dev/v4?utm_source=chatgpt.com "Release notes"
[2]: https://valibot.dev/?utm_source=chatgpt.com "Valibot: The modular and type safe schema library"
[3]: https://www.npmjs.com/package/typescript?utm_source=chatgpt.com "TypeScript"
