# ç¬¬10ç« ã€€äº‹å¾Œæ¡ä»¶ï¼ˆPostconditionï¼‰å…¥é–€ï¼šçµæœã®å“è³ªã‚’ä¿è¨¼ğŸâœ…

## 10.1 äº‹å¾Œæ¡ä»¶ã£ã¦ãªã«ï¼ŸğŸ™‚ğŸ’¡

![äº‹å¾Œæ¡ä»¶ä¿è¨¼](./picture/dbc_ts_study_010_qc_inspector.png)

äº‹å¾Œæ¡ä»¶ï¼ˆPostconditionï¼‰ã¯ã€**ã€Œã“ã®å‡¦ç†ãŒæˆåŠŸã—ãŸãªã‚‰ã€å¿…ãšã“ã†ãªã£ã¦ã‚‹ï¼ã€**ã‚’ç´„æŸã™ã‚‹ãƒ«ãƒ¼ãƒ«ã§ã™ğŸ§¾âœ¨
ã¤ã¾ã‚Šã€é–¢æ•°ã®â€œå‡ºå£â€ã§å“è³ªãƒã‚§ãƒƒã‚¯ã‚’ã™ã‚‹æ„Ÿã˜ã§ã™ğŸšªâœ…

* äº‹å‰æ¡ä»¶ï¼ˆPreconditionï¼‰ï¼å…¥å£ãƒã‚§ãƒƒã‚¯ğŸšª
* äº‹å¾Œæ¡ä»¶ï¼ˆPostconditionï¼‰ï¼å‡ºå£ãƒã‚§ãƒƒã‚¯ğŸšªâ¡ï¸âœ…

ãŸã¨ãˆã°ã€Œãƒã‚¤ãƒ³ãƒˆä»˜ä¸ã€ãªã‚‰â€¦

* âœ… æˆåŠŸã—ãŸãªã‚‰ã€**åˆè¨ˆãƒã‚¤ãƒ³ãƒˆãŒå¢—ãˆã¦ã„ã‚‹**
* âœ… å¢—ãˆãŸé‡ã¯ã€**ä»˜ä¸ã—ãŸåˆ†ã¨ä¸€è‡´ã—ã¦ã„ã‚‹**
* âœ… å¤‰ãˆã¡ã‚ƒãƒ€ãƒ¡ãªã‚‚ã®ã¯ã€**å¤‰ã‚ã£ã¦ã„ãªã„**

ã“ã†ã„ã†ã®ã‚’**ã‚³ãƒ¼ãƒ‰ã§è¨€ã„åˆ‡ã‚‹**ã®ãŒäº‹å¾Œæ¡ä»¶ã§ã™ğŸ—£ï¸ğŸ”¥

```mermaid
flowchart LR
    Call["é–¢æ•°å‘¼ã³å‡ºã—"] --> Pre["äº‹å‰æ¡ä»¶<br/>(å…¥å£) ğŸšª"]
    Pre --> Logic["ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯"]
    Logic --> Post["äº‹å¾Œæ¡ä»¶<br/>(å‡ºå£) ğŸâœ…"]
    Post --> Return["çµæœã‚’è¿”ã™"]
```

---

## 10.2 äº‹å¾Œæ¡ä»¶ãŒåŠ¹ãâ€œäº‹æ•…â€ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚ã‚‹ã‚ã‚‹ğŸ’¥ğŸ˜µâ€ğŸ’«

### ã‚ã‚‹ã‚ã‚‹â‘ ï¼šæˆåŠŸã—ãŸã£ã½ã„ã®ã«ã€å€¤ãŒå¢—ãˆã¦ãªã„ğŸ«¥

* ãƒ­ã‚¸ãƒƒã‚¯ãŒé€”ä¸­ã§æŠœã‘ã¦ã€åŠ ç®—ã•ã‚Œã¦ãªã„
* ä»£å…¥å…ˆã‚’é–“é•ãˆã¦ã€åˆ¥ã®å¤‰æ•°ã«å…¥ã‚Œã¦ãŸ
* ä¸¦è¡Œå‡¦ç†ã§ä¸Šæ›¸ãã•ã‚Œã¦ãŸï¼ˆã‚ã¨ã§å‡ºãŒã¡ï¼‰

ğŸ‘‰ **ã€Œæˆ»ã‚Šå€¤ã ã‘è¦‹ãŸã‚‰æˆåŠŸã«è¦‹ãˆã‚‹ã€**ã®ãŒæ€–ã„ã¨ã“ã‚ğŸ˜±
äº‹å¾Œæ¡ä»¶ãŒã‚ã‚‹ã¨ã€å‡ºå£ã§å³ãƒãƒ¬ã—ã¾ã™ğŸ”¦âœ…

### ã‚ã‚‹ã‚ã‚‹â‘¡ï¼šå¢—ãˆã¦ã‚‹ã‘ã©â€œå¢—ãˆæ–¹â€ãŒé–“é•ã£ã¦ã‚‹ğŸ“‰ğŸ“ˆ

* +100 ã®ã¤ã‚‚ã‚ŠãŒ +10
* ç«¯æ•°å‡¦ç†ã‚„ä¸¸ã‚ã§ã‚ºãƒ¬ï¼ˆä¸¸ã‚äº‹æ•…ã¯æ¬¡ç« ã§æ·±æ˜ã‚ŠğŸ§®âœ¨ï¼‰

---

## 10.3 äº‹å¾Œæ¡ä»¶ã®åŸºæœ¬ãƒ«ãƒ¼ãƒ«3ã¤ğŸ“Œâœ…

### ãƒ«ãƒ¼ãƒ«â‘ ï¼šã€ŒæˆåŠŸã—ãŸãªã‚‰ã€ã‚’å¯¾è±¡ã«ã™ã‚‹ğŸ™‚

äº‹å¾Œæ¡ä»¶ã¯ **ã€Œæ­£å¸¸çµ‚äº†ã—ãŸã¨ãã®ä¿è¨¼ã€** ã§ã™ğŸ
ä¾‹å¤–ã§è½ã¡ãŸå ´åˆã¯ã€ãã®æ™‚ç‚¹ã§â€œå¤±æ•—â€ãªã®ã§ã€äº‹å¾Œæ¡ä»¶ã‚’æº€ãŸã™å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ğŸ™…â€â™€ï¸ğŸ’¥

### ãƒ«ãƒ¼ãƒ«â‘¡ï¼šã€Œè¦³æ¸¬ã§ãã‚‹çµæœã€ã‚’ç´„æŸã™ã‚‹ğŸ‘€

* æˆ»ã‚Šå€¤
* çŠ¶æ…‹ã®å¤‰åŒ–ï¼ˆå‰¯ä½œç”¨ï¼‰
* å¤‰æ›´ã—ãªã„ã“ã¨ï¼ˆä¸å¤‰ç³»ã®ä¿è¨¼ï¼‰

### ãƒ«ãƒ¼ãƒ«â‘¢ï¼šé‡ã™ãã‚‹æ¤œè¨¼ã¯ã‚„ã‚Šã™ãæ³¨æ„âš–ï¸

äº‹å¾Œæ¡ä»¶ã¯ä¾¿åˆ©ã ã‘ã©ã€**æ¯å›DBå…¨ä»¶ãƒã‚§ãƒƒã‚¯**ã¨ã‹ã‚„ã‚‹ã¨é‡ã„ã§ã™ğŸ¢ğŸ’¦
ã¾ãšã¯ã€Œãã®é–¢æ•°ãŒè²¬ä»»ã‚’æŒã¤ç¯„å›²ã€ã§è»½ããƒ»ç¢ºå®Ÿã«âœ…

---

## 10.4 ã¾ãšã¯é“å…·ã¥ãã‚Šï¼šè»½ã„ `ensure` ã‚’ç”¨æ„ã—ã‚ˆã†ğŸ§°âœ¨

â€œå‡ºå£ãƒã‚§ãƒƒã‚¯â€ã‚’ã‚µã‚¯ãƒƒã¨æ›¸ããŸã‚ã«ã€ã¾ãšã¯å°ã•ãªé–¢æ•°ã‚’ä½œã‚Šã¾ã™ğŸ™‚

```ts
export function ensure(condition: unknown, message: string): asserts condition {
  if (!condition) {
    throw new Error(`Postcondition violated: ${message}`);
  }
}
```

ãƒã‚¤ãƒ³ãƒˆğŸ’¡

* `asserts condition` ã‚’ä»˜ã‘ã‚‹ã¨ã€TypeScriptçš„ã«ã‚‚ã€Œã“ã“ä»¥é™ã¯æˆã‚Šç«‹ã¤ã€æ‰±ã„ã«ãªã‚Šã¾ã™ğŸ§ âœ…
* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ **ã€Œä½•ãŒã©ã†ãŠã‹ã—ã„ã‹ã€** ãŒåˆ†ã‹ã‚‹ã‚ˆã†ã«æ›¸ãã¨ãƒ‡ãƒãƒƒã‚°ãŒé€Ÿã„ã§ã™ğŸï¸ğŸ’¨

---

## 10.5 äº‹å¾Œæ¡ä»¶ãƒ‘ã‚¿ãƒ¼ãƒ³â‘ ï¼šæˆ»ã‚Šå€¤ã‚’ä¿è¨¼ã™ã‚‹ğŸâœ…

### ä¾‹ï¼šãƒã‚¤ãƒ³ãƒˆè¨ˆç®—ï¼ˆç´”ç²‹é–¢æ•°ï¼‰ã§ã€Œå¿…ãšå¢—ãˆã‚‹ã€ã‚’ä¿è¨¼ğŸ«â¬†ï¸

```ts
import { ensure } from "./ensure";

export function addPoints(current: number, add: number): number {
  // ã“ã“ã§ã¯â€œå…¥å£â€ã¯åˆ¥ç« ï¼ˆäº‹å‰æ¡ä»¶ï¼‰ã§ã‚„ã£ãŸå‰æã¨ã—ã¦ã€
  // ä»Šå›ã¯â€œå‡ºå£â€ã®ç´„æŸã«é›†ä¸­ã™ã‚‹ã‚ˆğŸ™‚

  const result = current + add;

  // âœ… äº‹å¾Œæ¡ä»¶ï¼šçµæœã¯ current ä»¥ä¸Šã§ã‚ã‚‹ï¼ˆæ¸›ã£ã¦ãªã„ï¼‰
  ensure(result >= current, `result(${result}) must be >= current(${current})`);

  // âœ… äº‹å¾Œæ¡ä»¶ï¼šå¢—åŠ åˆ†ãŒ add ã¨ä¸€è‡´ã™ã‚‹
  ensure(result - current === add, `delta(${result - current}) must equal add(${add})`);

  return result;
}
```

ã“ã“ãŒã‚­ãƒ¢ğŸ’¡

* ã€Œå¢—ãˆã¦ã‚‹ã“ã¨ã€ã ã‘ã˜ã‚ƒãªãã€**â€œå¢—ãˆæ–¹ãŒæ­£ã—ã„ã“ã¨â€**ã¾ã§è¨€ã„åˆ‡ã‚‹ã¨å¼·ã„ã§ã™ğŸ’ªâœ¨

---

## 10.6 äº‹å¾Œæ¡ä»¶ãƒ‘ã‚¿ãƒ¼ãƒ³â‘¡ï¼šå‰¯ä½œç”¨ï¼ˆçŠ¶æ…‹å¤‰åŒ–ï¼‰ã‚’ä¿è¨¼ã™ã‚‹ğŸ“¤âœ…

![å‰å¾Œã®æ¯”è¼ƒ](./picture/dbc_ts_study_010_before_after_snapshot.png)

### ä¾‹ï¼šã‚¦ã‚©ãƒ¬ãƒƒãƒˆã«ãƒã‚¤ãƒ³ãƒˆä»˜ä¸ï¼ˆãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ãƒˆã™ã‚‹ç‰ˆï¼‰ğŸ‘›ğŸ«

```ts
import { ensure } from "./ensure";

export class PointWallet {
  private _total = 0;

  get total(): number {
    return this._total;
  }

  add(points: number): void {
    const before = this._total;

    // ä½•ã‹ã®å‡¦ç†â€¦
    this._total += points;

    const after = this._total;

    // âœ… äº‹å¾Œæ¡ä»¶ï¼šåˆè¨ˆãŒå¢—ãˆã¦ã„ã‚‹
    ensure(after > before, `total must increase (before=${before}, after=${after})`);

    // âœ… äº‹å¾Œæ¡ä»¶ï¼šå¢—ãˆãŸé‡ãŒ points ã¨ä¸€è‡´
    ensure(after - before === points, `delta must be points (delta=${after - before}, points=${points})`);
  }
}
```

ã‚³ãƒ„ğŸ’¡

* **ã€Œbefore ã‚’ä¿å­˜ã—ã¦ã‹ã‚‰å‡¦ç†ã€â†’ã€Œafter ã§æ¤œè¨¼ã€** ãŒè¶…å®šç•ªã§ã™ğŸ§ âœ¨
* â€œå‰¯ä½œç”¨â€ãŒã‚ã‚‹å‡¦ç†ã»ã©ã€äº‹å¾Œæ¡ä»¶ã®æ©æµãŒå¤§ãã„ã§ã™ğŸ“ˆâœ…

```mermaid
flowchart LR
    before["before ä¿å­˜ ğŸ“¸"] --> action["å‡¦ç†å®Ÿè¡Œ âš¡"]
    action --> after["after ã§æ¤œè¨¼ âœ…"]
    after -- "delta ãŒæ­£ã—ã„ã‹ï¼Ÿ" --> finish["å®Œäº† âœ¨"]
```

---

## 10.7 äº‹å¾Œæ¡ä»¶ãƒ‘ã‚¿ãƒ¼ãƒ³â‘¢ï¼šã€Œå¤‰ãˆã¡ã‚ƒãƒ€ãƒ¡ã€ã‚’ä¿è¨¼ã™ã‚‹ğŸ§ŠğŸš«

ã¨ãã©ãå¿…è¦ãªã®ãŒã‚³ãƒ¬ğŸ‘‡

* ã“ã®é–¢æ•°ã¯ãƒã‚¤ãƒ³ãƒˆã¯å¤‰ãˆã‚‹ã‘ã©
* **ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚„ãƒ©ãƒ³ã‚¯ã¯å¤‰ãˆãªã„** ã¿ãŸã„ãªä¿è¨¼

```ts
import { ensure } from "./ensure";

type User = {
  id: string;
  rank: "Bronze" | "Silver" | "Gold";
  points: number;
};

export function grant(user: User, add: number): User {
  const beforeId = user.id;
  const beforeRank = user.rank;

  const updated: User = { ...user, points: user.points + add };

  // âœ… äº‹å¾Œæ¡ä»¶ï¼šãƒã‚¤ãƒ³ãƒˆã¯å¢—ãˆã¦ã„ã‚‹
  ensure(updated.points > user.points, "points must increase");

  // âœ… äº‹å¾Œæ¡ä»¶ï¼šid/rank ã¯å¤‰ã‚ã‚‰ãªã„ï¼ˆã“ã“å¤§äº‹ï¼ï¼‰
  ensure(updated.id === beforeId, "id must not change");
  ensure(updated.rank === beforeRank, "rank must not change");

  return updated;
}
```

ã€Œé–¢ä¿‚ãªã„ã¨ã“ã‚ãŒå¤‰ã‚ã£ã¦ãŸäº‹æ•…ã€ã£ã¦ã€åœ°å‘³ã«å¤šã„ã§ã™ğŸ˜µâ€ğŸ’«
äº‹å¾Œæ¡ä»¶ã§ **â€œå½±éŸ¿ç¯„å›²â€ã‚’å›ºå®š**ã™ã‚‹ã¨å¼·ã„ã§ã™ğŸ§±âœ…

---

## 10.8 éåŒæœŸï¼ˆasyncï¼‰ã§ã‚‚åŒã˜ï¼â€œawaitå¾Œâ€ã«å‡ºå£ãƒã‚§ãƒƒã‚¯â³âœ…

```ts
import { ensure } from "./ensure";

export async function fetchAndNormalizeScore(userId: string): Promise<number> {
  const score = await fakeApi(userId); // 0ã€œ100ãŒè¿”ã‚‹æƒ³å®š

  const normalized = Math.max(0, Math.min(100, score));

  // âœ… äº‹å¾Œæ¡ä»¶ï¼šæ­£è¦åŒ–ã—ãŸçµæœã¯å¿…ãš 0ã€œ100
  ensure(normalized >= 0 && normalized <= 100, `normalized must be 0..100, got ${normalized}`);

  return normalized;
}

async function fakeApi(_userId: string): Promise<number> {
  return 120; // ã‚ã–ã¨ãƒã‚°ã£ã½ã„å€¤
}
```

---

## 10.9 ãƒŸãƒ‹å®Ÿé¨“ï¼šã‚ã–ã¨å£Šã—ã¦ã€Œäº‹å¾Œæ¡ä»¶ã§æ­¢ã¾ã‚‹ã€ã‚’ä½“æ„Ÿã—ã‚ˆã†ğŸ§ªğŸ˜ˆ

### æ‰‹é †ğŸ’»âœ¨

1. `PointWallet.add()` ã‚’ã‚ã–ã¨å£Šã™ï¼ˆä¾‹ï¼š`+= points` ã‚’ `+= 0` ã«ã™ã‚‹ï¼‰
2. é©å½“ã«å‘¼ã³å‡ºã™
3. **ã€ŒPostcondition violatedã€** ãŒå‡ºãŸã‚‰æˆåŠŸğŸ‰

å‘¼ã³å‡ºã—ä¾‹ğŸ‘‡

```ts
import { PointWallet } from "./PointWallet";

const w = new PointWallet();
w.add(10);
console.log(w.total);
```

ä½“æ„Ÿãƒã‚¤ãƒ³ãƒˆğŸ™‚

* ã€Œãƒã‚°ãŒã©ã“ã§èµ·ããŸã‹ã€ãŒã€ã‚ã¡ã‚ƒãã¡ã‚ƒè¿½ã„ã‚„ã™ããªã‚Šã¾ã™ğŸ”¦âœ¨
* **â€œå¤±æ•—ã®ä»•æ–¹ãŒã‚­ãƒ¬ã‚¤â€**ã«ãªã‚‹ã®ãŒDbCã®æ°—æŒã¡ã‚ˆã•ã§ã™ğŸ’–

---

## 10.10 AIæ´»ç”¨ï¼ˆçŸ­ã„æŒ‡ç¤ºã§OKï¼‰ğŸ¤–âœ¨

### äº‹å¾Œæ¡ä»¶ã®å€™è£œã‚’å‡ºã—ã¦ã‚‚ã‚‰ã†ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹ğŸ“

* ã€Œã“ã®é–¢æ•°ã®**æˆåŠŸæ™‚ã«å¿…ãšæˆã‚Šç«‹ã¤æ¡ä»¶ï¼ˆäº‹å¾Œæ¡ä»¶ï¼‰**ã‚’3ã¤ææ¡ˆã—ã¦ã€‚æˆ»ã‚Šå€¤ãƒ»å‰¯ä½œç”¨ãƒ»å¤‰æ›´ç¦æ­¢ã®è¦³ç‚¹ã§ã€‚ã€
* ã€Œ`before/after` ã‚’ä½¿ã£ãŸäº‹å¾Œæ¡ä»¶ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚ŒãŸå®Ÿè£…ä¾‹ã‚’TypeScriptã§å‡ºã—ã¦ã€‚ã€
* ã€Œäº‹å¾Œæ¡ä»¶ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã€åŸå› ãŒåˆ†ã‹ã‚‹å½¢ã«æ”¹å–„ã—ã¦æ¡ˆã‚’å‡ºã—ã¦ã€‚ã€

âš ï¸ å¤§äº‹ğŸ™‚
AIãŒå‡ºã™äº‹å¾Œæ¡ä»¶ã¯â€œå€™è£œâ€ãªã®ã§ã€æœ€å¾Œã¯ **ä»•æ§˜ã¨ã—ã¦æ­£ã—ã„ã‹**ã‚’äººé–“ãŒæ±ºã‚ã¾ã™âš–ï¸âœ…

---

## 10.11 ã¡ã‚‡ã„æœ€æ–°ã‚³ãƒ©ãƒ ï¼šå‰¯ä½œç”¨ã‚’é…ã‚‰ã›ã‚‹ `import defer` ğŸ•°ï¸ğŸ“¦

æœ€è¿‘ã®TypeScriptã§ã¯ã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å®Ÿè¡Œï¼ˆå‰¯ä½œç”¨ï¼‰ã‚’â€œé…ã‚‰ã›ã‚‹â€æ›¸ãæ–¹ã¨ã—ã¦ `import defer` ãŒè¿½åŠ ã•ã‚Œã¦ã„ã¾ã™ğŸ’¡
å‰¯ä½œç”¨ãŒçµ¡ã‚€ã¨ã€Œã„ã¤çŠ¶æ…‹ãŒå¤‰ã‚ã‚‹ã®ï¼Ÿã€ãŒã‚„ã‚„ã“ã—ããªã‚ŠãŒã¡ãªã®ã§ã€ã“ã†ã„ã†ä»•çµ„ã¿ã¯è¨­è¨ˆã®åŠ©ã‘ã«ãªã‚Šã¾ã™ğŸ™‚âœ¨ ([TypeScript][1])

---

## 10.12 ç« æœ«ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆâœ…âœ¨

* âœ… äº‹å¾Œæ¡ä»¶ã¯ã€ŒæˆåŠŸã—ãŸãªã‚‰å¿…ãšã“ã†ãªã‚‹ã€ã‚’è¨€ã„åˆ‡ã‚‹
* âœ… æˆ»ã‚Šå€¤ã ã‘ã˜ã‚ƒãªãã€å‰¯ä½œç”¨ï¼ˆçŠ¶æ…‹å¤‰åŒ–ï¼‰ã‚‚ä¿è¨¼ã§ãã‚‹
* âœ… `before/after` ã§æ¤œè¨¼ã™ã‚‹ã¨åˆ†ã‹ã‚Šã‚„ã™ã„
* âœ… ã€Œå¤‰ãˆã¡ã‚ƒãƒ€ãƒ¡ã€ã‚‚äº‹å¾Œæ¡ä»¶ã§å›ºå®šã§ãã‚‹
* âœ… é‡ã™ãã‚‹æ¤œè¨¼ã¯ã‚„ã‚Šã™ãæ³¨æ„ï¼ˆã¾ãšã¯è²¬ä»»ç¯„å›²ã§è»½ãï¼‰

---

## 10.13 æ¼”ç¿’ğŸ§ªâœï¸

### æ¼”ç¿’1ï¼šãƒã‚¤ãƒ³ãƒˆä»˜ä¸ã®äº‹å¾Œæ¡ä»¶ã‚’å¢—ã‚„ãã†ğŸ«âœ…

`PointWallet.add(points)` ã«ã€æ¬¡ã®äº‹å¾Œæ¡ä»¶ã‚’è¿½åŠ ã—ã¦ã­ğŸ™‚

* âœ… `total` ã¯ **è² ã«ãªã‚‰ãªã„**
* âœ… `total` ã¯ **æ•´æ•°ã®ã¾ã¾**ï¼ˆå°æ•°ãŒæ··ã–ã‚‰ãªã„æƒ³å®šï¼‰

ãƒ’ãƒ³ãƒˆğŸ’¡

* `Number.isInteger(x)` ãŒä½¿ãˆã¾ã™ğŸ§ 

---

### æ¼”ç¿’2ï¼šè³¼å…¥å‡¦ç†ã®äº‹å¾Œæ¡ä»¶ï¼ˆåˆè¨ˆãŒä¸€è‡´ï¼‰ğŸ›’ğŸ’´

æ¬¡ã®é–¢æ•°ã‚’ä½œã£ã¦ã€äº‹å¾Œæ¡ä»¶ã§å®ˆã£ã¦ã­ğŸ™‚âœ¨

è¦ä»¶ï¼š

* `items` ã®åˆè¨ˆã‚’è¿”ã™
* âœ… è¿”ã—ãŸ `total` ã¯ã€å„ `price * qty` ã®åˆè¨ˆã¨ä¸€è‡´ã™ã‚‹
* âœ… `total` ã¯ 0 ä»¥ä¸Š

```ts
type Item = { price: number; qty: number };

export function calcTotal(items: Item[]): number {
  // TODO
  return 0;
}
```

---

### æ¼”ç¿’3ï¼šå¤‰æ›´ç¦æ­¢ã®äº‹å¾Œæ¡ä»¶ğŸ”’ğŸ§Š

`grant(user, add)` ã§ã€`id` ã¨ `rank` ãŒçµ¶å¯¾ã«å¤‰ã‚ã‚‰ãªã„ã“ã¨ã‚’äº‹å¾Œæ¡ä»¶ã§ä¿è¨¼ã—ã¦ã­ğŸ™‚
ï¼ˆç« ã®ä¾‹ã‚’å‚è€ƒã«OKï¼ï¼‰

---

## 10.14 è§£ç­”ä¾‹ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰ğŸ§ âœ¨

### æ¼”ç¿’2 è§£ç­”ä¾‹

```ts
import { ensure } from "./ensure";

type Item = { price: number; qty: number };

export function calcTotal(items: Item[]): number {
  const total = items.reduce((sum, it) => sum + it.price * it.qty, 0);

  ensure(total >= 0, `total must be >= 0, got ${total}`);

  const expected = items.reduce((sum, it) => sum + it.price * it.qty, 0);
  ensure(total === expected, `total must equal expected (total=${total}, expected=${expected})`);

  return total;
}
```

---

### æ¬¡ç« äºˆå‘ŠğŸ“˜âœ¨

æ¬¡ã®ç« ã§ã¯ã€é‡‘é¡ãƒ»ç¨ãƒ»ä¸¸ã‚ã®â€œã‚ºãƒ¬äº‹æ•…â€ã‚’ **äº‹å¾Œæ¡ä»¶ã§å°ã˜ã‚‹**ã‚³ãƒ„ã‚’ã‚„ã‚Šã¾ã™ğŸ’´ğŸ§®âœ…

[1]: https://www.typescriptlang.org/docs/handbook/release-notes/typescript-5-9.html?utm_source=chatgpt.com "Documentation - TypeScript 5.9"

