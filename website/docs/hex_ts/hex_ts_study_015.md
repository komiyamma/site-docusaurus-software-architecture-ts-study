# ç¬¬15ç« ã€€ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆã‚’å›ºå®šï¼ˆè¿·å­é˜²æ­¢ï¼‰ğŸ“ğŸ§­

![hex_ts_study_015[(./picture/hex_ts_study_015_the_domain_layer.png)

ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¢—ãˆã¦ãã‚‹ã¨ã­ã€**ã€Œã©ã“ã«ä½•ç½®ãã‚“ã ã£ã‘â€¦ï¼Ÿã€**ã£ã¦è¿·å­ã«ãªã‚ŠãŒã¡ğŸ˜µâ€ğŸ’«
ã“ã®ç« ã¯ãã‚Œã‚’é˜²ããŸã‚ã«ã€**ãƒ•ã‚©ãƒ«ãƒ€ã®â€œä½æ‰€â€ã‚’æœ€åˆã«å›ºå®š**ã—ã¡ã‚ƒã†å›ã ã‚ˆã€œï¼ğŸ€âœ¨

---

## 15.1 è¿·å­ãŒèµ·ãã‚‹ç†ç”±ã‚ã‚‹ã‚ã‚‹ ğŸ˜µâ€ğŸ’«ğŸŒ€

* `todo.ts` ãŒ3ã¤ã‚ã‚‹ï¼ˆã©ã‚ŒãŒæœ¬ä½“ï¼ï¼Ÿï¼‰ğŸ˜‡
* `controller` ã«ãƒ«ãƒ¼ãƒ«ãŒæ··ã–ã£ã¦ä¿®æ­£ãŒæ€–ã„ğŸ’¥
* DB/HTTP/ç”»é¢ã®éƒ½åˆãŒä¸­å¿ƒã«å…¥ã‚Šè¾¼ã‚“ã§ã‚´ãƒãƒ£ã‚´ãƒãƒ£ğŸ¤¯

ãªã®ã§ã€**æœ€åˆã« â€œç½®ãå ´æ‰€ãƒ«ãƒ¼ãƒ«â€ ã‚’æ±ºã‚ã¦å®ˆã‚‹**ã®ãŒå‹ã¡ğŸ¥‡âœ¨

---

## 15.2 3ç‚¹ã‚»ãƒƒãƒˆã§å›ºå®šã™ã‚‹ã‚ˆï¼ğŸ“¦âœ¨

ã“ã®æ•™æã¯ã€ã¾ãšã“ã‚Œã ã‘è¦šãˆã‚Œã°OKğŸ™†â€â™€ï¸ğŸ’•

* `domain/`ï¼š**ãƒ«ãƒ¼ãƒ«ã¨çŠ¶æ…‹**ï¼ˆä¸€ç•ªå¤§äº‹ãªä¸­å¿ƒğŸ›¡ï¸ï¼‰
* `app/`ï¼š**ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹**ï¼ˆæ‰‹é †ï¼‹åˆ¤æ–­ï¼‰ğŸ®â¡ï¸ğŸ§ 
* `adapters/`ï¼š**å¤–å´ã®éƒ½åˆ**ï¼ˆCLI/HTTP/DB/ãƒ•ã‚¡ã‚¤ãƒ«â€¦ï¼‰ğŸŒğŸ”

> âœ¨ãƒã‚¤ãƒ³ãƒˆï¼š**ã€Œä¸­å¿ƒï¼ˆdomain/appï¼‰ã€ã‚’å®ˆã‚‹ãŸã‚ã«ã€å¤–å´ï¼ˆadaptersï¼‰ã‚’éš”é›¢ã™ã‚‹**æ„Ÿã˜ã ã‚ˆã€œğŸ°ğŸ›¡ï¸

---

## 15.3 ä»Šå›ã®ToDoãƒŸãƒ‹ã®â€œå®Œæˆãƒ•ã‚©ãƒ«ãƒ€â€è¦‹æœ¬ ğŸ“âœ¨

ã¾ãšã‚´ãƒ¼ãƒ«å½¢ã‚’ç½®ã„ã¡ã‚ƒã†ã­ï¼ï¼ˆã“ã‚Œã«å¯„ã›ã¦ã„ãï¼‰ğŸ§©

```text
your-app/
â”œâ”€ src/
â”‚  â”œâ”€ domain/
â”‚  â”‚  â”œâ”€ todo/
â”‚  â”‚  â”‚  â”œâ”€ Todo.ts
â”‚  â”‚  â”‚  â”œâ”€ TodoId.ts
â”‚  â”‚  â”‚  â””â”€ errors.ts
â”‚  â”‚  â””â”€ index.ts
â”‚  â”‚
â”‚  â”œâ”€ app/
â”‚  â”‚  â”œâ”€ ports/
â”‚  â”‚  â”‚  â”œâ”€ TodoRepositoryPort.ts
â”‚  â”‚  â”‚  â””â”€ ClockPort.ts
â”‚  â”‚  â”œâ”€ usecases/
â”‚  â”‚  â”‚  â”œâ”€ AddTodoUseCase.ts
â”‚  â”‚  â”‚  â”œâ”€ CompleteTodoUseCase.ts
â”‚  â”‚  â”‚  â””â”€ ListTodosUseCase.ts
â”‚  â”‚  â”œâ”€ dto/
â”‚  â”‚  â”‚  â”œâ”€ AddTodoDTO.ts
â”‚  â”‚  â”‚  â””â”€ TodoView.ts
â”‚  â”‚  â””â”€ index.ts
â”‚  â”‚
â”‚  â”œâ”€ adapters/
â”‚  â”‚  â”œâ”€ inbound/
â”‚  â”‚  â”‚  â””â”€ cli/
â”‚  â”‚  â”‚     â”œâ”€ parseArgs.ts
â”‚  â”‚  â”‚     â””â”€ cliAdapter.ts
â”‚  â”‚  â”œâ”€ outbound/
â”‚  â”‚  â”‚  â”œâ”€ memory/
â”‚  â”‚  â”‚  â”‚  â””â”€ InMemoryTodoRepositoryAdapter.ts
â”‚  â”‚  â”‚  â””â”€ file/
â”‚  â”‚  â”‚     â””â”€ FileTodoRepositoryAdapter.ts
â”‚  â”‚  â””â”€ index.ts
â”‚  â”‚
â”‚  â””â”€ main.ts   â† Composition Rootï¼ˆçµ„ã¿ç«‹ã¦å ´æ‰€ï¼‰ğŸ§©ğŸ—ï¸
â”‚
â”œâ”€ eslint.config.js
â”œâ”€ tsconfig.json
â””â”€ package.json
```

ğŸ’¡`index.ts` ã¯ã€Œã“ã®ãƒ•ã‚©ãƒ«ãƒ€ã‹ã‚‰å¤–ã«å‡ºã—ã¦ã„ã„ã‚‚ã®ã€ã‚’ã¾ã¨ã‚ã‚‹â€œå‡ºå£â€ğŸšªâœ¨
ï¼ˆå¾Œã§ import ãŒã‚­ãƒ¬ã‚¤ã«ãªã‚‹ã‚ˆã€œï¼ï¼‰

---

## 15.4 import ãƒ«ãƒ¼ãƒ«ï¼ˆä¾å­˜ã®å‘ãï¼‰ã‚’å›ºå®šã™ã‚‹ã‚ˆ ğŸ§­ğŸ”¥

ã“ã“ãŒè¿·å­é˜²æ­¢ã®**æœ€å¼·ãƒ«ãƒ¼ãƒ«**ğŸ’ªâœ¨

âœ… **OKï¼ˆè¨±å¯ï¼‰**

* `app` â†’ `domain` ã‚’ä½¿ã†ğŸ‘Œ
* `adapters` â†’ `app` / `domain` ã‚’ä½¿ã†ğŸ‘Œ

âŒ **NGï¼ˆç¦æ­¢ï¼‰**

* `domain` â†’ `app` / `adapters` ã‚’å‚ç…§ã—ãªã„ğŸ™…â€â™€ï¸
* `app` â†’ `adapters` ã‚’å‚ç…§ã—ãªã„ğŸ™…â€â™€ï¸

ã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ã“ã‚ŒğŸ‘‡âœ¨

```text
domain   â† ã ã‚Œã«ã‚‚ä¾å­˜ã—ãªã„ğŸ›¡ï¸
  â†‘
app      â† domain ã ã‘çŸ¥ã£ã¦OKğŸ®
  â†‘
adapters â† app/domain ã‚’å‘¼ã³å‡ºã—ã¦OKğŸŒ
```

---

## 15.5 å‘½åãƒ«ãƒ¼ãƒ«ï¼ˆè¿·å­ã«ãªã‚‰ãªã„åå‰ã®ä»˜ã‘æ–¹ï¼‰ğŸ·ï¸âœ¨

ãƒ•ã‚©ãƒ«ãƒ€ã ã‘ã˜ã‚ƒãªãã€**ãƒ•ã‚¡ã‚¤ãƒ«åã‚‚å‹**ã¿ãŸã„ã«åŠ¹ãã‚ˆã€œğŸ˜†âœ¨

### ğŸ”Œ Portï¼ˆç´„æŸï¼‰å´

* `ã€œPort` ã§ã€Œã“ã‚Œã¯ç´„æŸã ã‚ˆï¼ã€ãŒä¸€ç¬ã§åˆ†ã‹ã‚‹âœ¨
  ä¾‹ï¼š
* `TodoRepositoryPort`
* `ClockPort`

### ğŸ§© Adapterï¼ˆå®Ÿè£…ï¼‰å´

* `ã€œAdapter` ã§ã€Œã“ã‚Œã¯å¤‰æ›ãƒ»æ¥ç¶šå½¹ã ã‚ˆï¼ã€ãŒåˆ†ã‹ã‚‹âœ¨
  ä¾‹ï¼š
* `InMemoryTodoRepositoryAdapter`
* `FileTodoRepositoryAdapter`
* `CliAdapter`

---

## 15.6 ãƒ‘ã‚¹ã‚’çŸ­ãã™ã‚‹ï¼ˆtsconfig ã® pathsï¼‰ğŸª„ğŸ“¦

æ·±ã„ç›¸å¯¾ãƒ‘ã‚¹ã£ã¦ã€åœ°å‘³ã«å¿ƒã‚’å‰Šã‚‹ã‚ˆã­â€¦ğŸ¥¹
ãªã®ã§ `@domain/*` ã¿ãŸã„ã«çŸ­ãã—ã¡ã‚ƒã†âœ¨

```json
// tsconfig.jsonï¼ˆä¾‹ï¼‰
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@domain/*": ["src/domain/*"],
      "@app/*": ["src/app/*"],
      "@adapters/*": ["src/adapters/*"]
    }
  }
}
```

âš ï¸ã“ã“å¤§äº‹ï¼š`paths` ã¯ **TypeScriptã®è§£æ±ºãƒ«ãƒ¼ãƒ«**ã§ã‚ã£ã¦ã€`tsc` ã®å‡ºåŠ›ï¼ˆå®Ÿè¡Œæ™‚ï¼‰ã‚’è‡ªå‹•ã§æ›¸ãæ›ãˆã‚‹æ©Ÿèƒ½ã§ã¯ãªã„ã‚ˆã€œï¼
ï¼ˆå®Ÿè¡Œæ–¹æ³•ã‚„ãƒ†ã‚¹ãƒˆå´ã§åˆ¥é€”å¯¾å¿œãŒå¿…è¦ã«ãªã‚‹å ´åˆã‚ã‚Šï¼‰ğŸ“Œâœ¨ ([typescriptlang.org][1])

---

## 15.7 â€œãƒ«ãƒ¼ãƒ«ã‚’å®ˆã‚Œã¦ã‚‹ã‹â€ã‚’æ©Ÿæ¢°ã«è¦‹å¼µã‚‰ã›ã‚‹ ğŸ‘®â€â™€ï¸ğŸ§¹âœ¨ï¼ˆè¶…ãŠã™ã™ã‚ï¼‰

ã€Œæ°—ã‚’ã¤ã‘ã‚‹ã€ã£ã¦äººé–“ã¯å¿˜ã‚Œã‚‹ã®ã§â€¦
**ESLintã«æ€’ã£ã¦ã‚‚ã‚‰ã†**ã®ãŒæœ€å¼·ğŸ’¥ğŸ˜†

### âœ… ESLint ã¯ â€œflat configï¼ˆeslint.config.jsï¼‰â€ ãŒä»Šã®ä¸»æµ

ESLint v9 ã‹ã‚‰æ–°ã—ã„è¨­å®šæ–¹å¼ï¼ˆflat configï¼‰ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã ã‚ˆğŸ“Œâœ¨ ([ESLint][2])

### ã¾ãšã¯æœ€å°ï¼š`no-restricted-imports` ã§ â€œé€†æµâ€ ã‚’æ­¢ã‚ã‚‹ğŸ›‘

ä¾‹ï¼š`domain` ã‹ã‚‰ `adapters` ã‚’ import ã§ããªã„ã‚ˆã†ã«ã™ã‚‹ï¼ˆã–ã£ãã‚Šã‚¬ãƒ¼ãƒ‰ï¼‰ğŸ’ª
ã“ã®ãƒ«ãƒ¼ãƒ«ã¯ `paths` / `patterns` æŒ‡å®šãŒã§ãã‚‹ã‚ˆğŸ“Œ ([ESLint][3])

```js
// eslint.config.jsï¼ˆä¾‹ï¼šè¶…ãƒŸãƒ‹ã®æ–¹å‘æ€§ã‚¬ãƒ¼ãƒ‰ï¼‰
export default [
  {
    files: ["src/domain/**/*.ts"],
    rules: {
      "no-restricted-imports": ["error", {
        "patterns": [
          { "group": ["@adapters/*", "../adapters/*", "../../adapters/*"], "message": "domain ã‹ã‚‰ adapters ã¯å‚ç…§ã—ãªã„ã§ã­ğŸ›¡ï¸" },
          { "group": ["@app/*", "../app/*", "../../app/*"], "message": "domain ã‹ã‚‰ app ã‚‚å‚ç…§ã—ãªã„ã§ã­ğŸ›¡ï¸" }
        ]
      }]
    }
  }
];
```

> ã“ã‚Œã ã‘ã§ã‚‚ã€Œã†ã£ã‹ã‚Šé€†å‘ãã€ã‚’ã‹ãªã‚Šé˜²ã’ã‚‹ã‚ˆã€œğŸ˜†ğŸ›¡ï¸

---

## 15.8 ã‚‚ã£ã¨å¼·ãå®ˆã‚‹ï¼šJS Boundaries ã§ â€œãƒ•ã‚©ãƒ«ãƒ€å¢ƒç•Œâ€ ã‚’ã‚¬ãƒã‚¬ãƒã«ã™ã‚‹ ğŸ§±âœ¨

ã€Œdomain/app/adapters ã®é–¢ä¿‚ã€ã‚’**ãƒ«ãƒ¼ãƒ«ã¨ã—ã¦å®£è¨€**ã§ãã‚‹ã‚„ã¤ï¼ã‚ã¡ã‚ƒä¾¿åˆ©ğŸ˜
`boundaries/elements` ã§è¦ç´ ã‚’å®šç¾©ã—ã¦ã€`boundaries/element-types` ã§ä¾å­˜ãƒ«ãƒ¼ãƒ«ã‚’æ›¸ãæ„Ÿã˜ã ã‚ˆğŸ“Œ ([jsboundaries.dev][4])

```js
// eslint.config.jsï¼ˆä¾‹ï¼šdomain/app/adapters ã®3ç‚¹ã‚»ãƒƒãƒˆã‚’å¼·åˆ¶ï¼‰
import boundaries from "eslint-plugin-boundaries";

export default [
  {
    plugins: { boundaries },
    settings: {
      "boundaries/elements": [
        { type: "domain", pattern: "src/domain/**", mode: "file" },
        { type: "app", pattern: "src/app/**", mode: "file" },
        { type: "adapters", pattern: "src/adapters/**", mode: "file" }
      ]
    },
    rules: {
      "boundaries/element-types": [2, {
        default: "disallow",
        rules: [
          { from: ["domain"], allow: ["domain"] },
          { from: ["app"], allow: ["app", "domain"] },
          { from: ["adapters"], allow: ["adapters", "app", "domain"] }
        ]
      }]
    }
  }
];
```

ã“ã‚Œã§ã€ã‚‚ã— `app` ã‹ã‚‰ `adapters` ã‚’ç›´æ¥ import ã—ãŸã‚‰
**ã€Œãƒ€ãƒ¡ã€œã€œï¼ã€ã£ã¦ãƒ“ã‚·ãƒƒã¨æ€’ã£ã¦ãã‚Œã‚‹**ğŸ˜†ğŸ’¥

---

## 15.9 VS Code ã§è¿·å­ã«ãªã‚‰ãªã„å°æŠ€ ğŸ§­âœ¨

* `Ctrl+P`ï¼šãƒ•ã‚¡ã‚¤ãƒ«åã§ç¬é–“ç§»å‹•ğŸš€
* `Ctrl+Shift+F`ï¼šãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“æ¤œç´¢ğŸ”
* `src/domain` / `src/app` / `src/adapters` ã‚’**å¸¸ã«è¦‹ãˆã‚‹ä½ç½®**ã«ç½®ãï¼ˆé–‹ã„ã¦ãŠãï¼‰ğŸ“Œâœ¨
* `index.ts` ã‚’â€œå‡ºå£â€ã«ã—ã¦ãŠãã¨ import ãŒæ•´ã†ğŸ’…âœ¨

---

## 15.10 AIã«é ¼ã‚€ãªã‚‰ã“ã“ï¼ğŸ¤–ğŸ’–ï¼ˆãƒ•ã‚©ãƒ«ãƒ€ä½œã‚Šã¯å¾—æ„ï¼‰

AIã«ã¯ã€Œè¨­è¨ˆã®èŠ¯ã€ã˜ã‚ƒãªãã¦ã€**éª¨çµ„ã¿ä½œã‚Š**ã‚’ä»»ã›ã‚‹ã®ãŒå®‰å…¨ğŸ™†â€â™€ï¸âœ¨
ãã®ã¾ã¾ä½¿ãˆã‚‹ãŠé¡˜ã„ãƒ†ãƒ³ãƒ—ãƒ¬ğŸ‘‡

```text
ã‚ãªãŸã¯TypeScriptãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é››å½¢ä½œã‚Šæ‹…å½“ã§ã™ã€‚
Hexagonalã®æ–¹é‡ã§ src/domain, src/app, src/adapters ã‚’ä½œã‚Šã€
å„ãƒ•ã‚©ãƒ«ãƒ€ã« index.ts ã‚’ç½®ãã€TodoãƒŸãƒ‹ã‚¢ãƒ—ãƒªå‘ã‘ã®ç©ºãƒ•ã‚¡ã‚¤ãƒ«ã‚‚ä½œã£ã¦ãã ã•ã„ã€‚
ãŸã ã— domain/app ã¯ adapters ã‚’ import ã—ãªã„å‰æã§ã€ä¾å­˜ã®å‘ãã‚’ã‚³ãƒ¡ãƒ³ãƒˆã§æ˜è¨˜ã—ã¦ãã ã•ã„ã€‚
```

---

## 15.11 ã¾ã¨ã‚ï¼ˆã“ã®ç« ã®åˆæ ¼ãƒ©ã‚¤ãƒ³ï¼‰ğŸ€âœ…

* `domain / app / adapters` ã®3ç‚¹ã‚»ãƒƒãƒˆãŒä½œã‚Œã¦ã‚‹ğŸ“âœ¨
* **ä¾å­˜ã®å‘ã**ãŒå®ˆã‚Œã¦ã‚‹ğŸ§­ğŸ›¡ï¸
* Port ã¨ Adapter ã®å‘½åãŒãƒ–ãƒ¬ã¦ãªã„ğŸ”ŒğŸ§©
* ã§ãã‚Œã° ESLint ã§ â€œé€†æµâ€ ã‚’æ­¢ã‚ã¦ã‚‹ğŸ‘®â€â™€ï¸âœ¨

---

## è‡ªä¸»èª²é¡Œï¼ˆ5åˆ†ã§OKï¼‰ğŸ“ğŸ’–

1. ã„ã¾ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã« `src/domain`, `src/app`, `src/adapters` ã‚’ä½œã‚‹ğŸ“
2. `domain` ã«ä»®ã§ `Todo.ts` ã‚’ç½®ãğŸ“
3. ã‚ã–ã¨ `domain` ã‹ã‚‰ `adapters` ã‚’ import ã—ã¦ã¿ã‚‹ï¼ˆæ€’ã‚‰ã‚ŒãŸã‚‰å‹ã¡ğŸ˜†ğŸ’¥ï¼‰

---

å¿…è¦ãªã‚‰æ¬¡ã®ç« ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ãƒ«ãƒ¼ãƒ«ç½®ãå ´ğŸ ğŸ“Œï¼‰ã¸ã¤ãªã’ã¦ã€**ã€Œã˜ã‚ƒã‚ domain ã«ä½•ã‚’æ›¸ã‘ã°ã„ã„ã®ï¼Ÿã€**ã‚’æ°—æŒã¡ã‚ˆãã‚„ã£ã¦ã„ã“ã€œï¼ğŸ˜Šâœ¨

[1]: https://www.typescriptlang.org/tsconfig/paths.html "TypeScript: TSConfig Option: paths"
[2]: https://eslint.org/blog/2025/03/flat-config-extends-define-config-global-ignores/ "Evolving flat config with extends - ESLint - Pluggable JavaScript Linter"
[3]: https://eslint.org/docs/latest/rules/no-restricted-imports "no-restricted-imports - ESLint - Pluggable JavaScript Linter"
[4]: https://www.jsboundaries.dev/docs/rules/dependencies/ "Rule element-types | JS Boundaries"
