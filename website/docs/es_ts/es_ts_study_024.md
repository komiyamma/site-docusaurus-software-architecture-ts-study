# 24ç« ï¼šç«¶åˆã—ãŸã¨ãã€ã©ã†ã™ã‚‹ï¼Ÿï¼ˆæ–¹é‡ã ã‘ï¼‰ğŸ§¯ğŸ§ 

## ã“ã®ç« ã§ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã“ã¨ğŸ¯âœ¨

* ã€Œç«¶åˆï¼ˆåŒæ™‚æ›´æ–°ï¼‰ã€ãŒèµ·ããŸã¨ãã« **ä½•ãŒèµ·ãã¦ã‚‹ã®ã‹** ã‚’èª¬æ˜ã§ãã‚‹ğŸ—£ï¸ğŸ’¡
* å®Ÿå‹™ã§ã‚ˆãä½¿ã† **3ã¤ã®å¯¾å¿œæ–¹é‡**ï¼ˆãƒªãƒˆãƒ©ã‚¤ï¼å†å…¥åŠ›ä¿ƒã—ï¼ãƒãƒ¼ã‚¸ï¼‰ã‚’ä½¿ã„åˆ†ã‘ã‚‰ã‚Œã‚‹ğŸ§°âœ…
* ã¾ãšã¯æœ€å°ã§ã€Œãƒªãƒˆãƒ©ã‚¤æ–¹é‡ã€ã‚’ **TypeScriptã§å®Ÿè£…** ã§ãã‚‹ğŸ”ğŸ§‘â€ğŸ’»

---

## ã¾ãšçµè«–ï¼šç«¶åˆå¯¾å¿œã¯ â€œã“ã®3æŠâ€ ãŒåŸºæœ¬ã ã‚ˆğŸ§¡

ç«¶åˆã¯ã€å‰ç« ã® **expectedVersionï¼ˆæ¥½è¦³ãƒ­ãƒƒã‚¯ï¼‰** ã§æ¤œçŸ¥ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã‚ˆã­ğŸ”’
ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ãƒˆã‚¢å´ã§ã€Œ**ãã®versionã®ã¯ãš**ã€ã£ã¦æŒ‡å®šã—ã¦Appendã—ã¦ã€ã‚ºãƒ¬ã¦ãŸã‚‰å¤±æ•—ã«ã™ã‚‹ã‚„ã¤ï¼([Kurrent Docs][1])

ãã®ã€Œå¤±æ•—ã€ã«ãªã£ãŸã‚ã¨ã€ç¾å ´ã§ã¯ã ã„ãŸã„æ¬¡ã®3ãƒ‘ã‚¿ãƒ¼ãƒ³ã«è½ã¡ã‚‹ã‚ˆğŸ‘‡âœ¨

1. **è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤ï¼ˆå†èª­ã¿è¾¼ã¿â†’å†åˆ¤æ–­â†’å†Appendï¼‰** ğŸ”
2. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«â€œæœ€æ–°ã§ã‚„ã‚Šç›´ã—â€ã—ã¦ã‚‚ã‚‰ã†ï¼ˆå†å…¥åŠ›ä¿ƒã—ï¼‰** ğŸ§‘â€ğŸ’»ğŸŒ€
3. **ãƒãƒ¼ã‚¸ï¼ˆä¸¡æ–¹ã®å¤‰æ›´ã‚’ã„ã„æ„Ÿã˜ã«åˆä½“ï¼‰** ğŸ§©âœ¨ï¼ˆãŸã ã—é›£ã—ã‚ï¼ï¼‰

---

## ç«¶åˆã£ã¦ä½•ãŒèµ·ãã¦ã‚‹ã®ï¼ŸğŸ˜µâ€ğŸ’«ï¼ˆ30ç§’ã§ç†è§£ï¼‰

ãŸã¨ãˆã°åŒã˜ã‚«ãƒ¼ãƒˆğŸ›’ã‚’ã€Aã•ã‚“ã¨Bã•ã‚“ãŒã»ã¼åŒæ™‚ã«æ›´æ–°ã—ãŸã¨ã™ã‚‹ã­ã€‚

* Aã•ã‚“ï¼šã‚«ãƒ¼ãƒˆã‚’èª­ã¿è¾¼ã‚“ã ï¼ˆversion=10ï¼‰ğŸ“–
* Bã•ã‚“ï¼šã‚«ãƒ¼ãƒˆã‚’èª­ã¿è¾¼ã‚“ã ï¼ˆversion=10ï¼‰ğŸ“–
* Bã•ã‚“ï¼šå…ˆã«ä¿å­˜ã—ãŸ â†’ versionãŒ11ã«ãªã£ãŸâœ…
* Aã•ã‚“ï¼šversion=10ã®ã¤ã‚‚ã‚Šã§ä¿å­˜ â†’ **ã‚ºãƒ¬ã¦ã‚‹ã‹ã‚‰å¤±æ•—ï¼ˆç«¶åˆï¼‰** ğŸ’¥

ã“ã“ã§å¤§äº‹ãªã®ã¯ã€**ã€Œèª°ãŒæ‚ªã„ã€ã˜ã‚ƒãªãã¦**
â€œåŒæ™‚ã«èµ·ããŸã ã‘â€ ã£ã¦ã“ã¨ğŸ˜ŠğŸŒ¸

---

## æ–¹é‡ã®é¸ã³æ–¹ï¼šè¿·ã£ãŸã‚‰ã“ã®ãƒ«ãƒ¼ãƒ«ã§OKğŸ§­âœ¨

## â‘  è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤ãŒå‘ã„ã¦ã‚‹ã‚±ãƒ¼ã‚¹ğŸ”âœ…

* ã‚³ãƒãƒ³ãƒ‰ãŒ **â€œè¶³ã—ç®—ç³»â€**ï¼ˆAddã¨ã‹Incrementã¨ã‹ï¼‰ã§ã€
  æœ€æ–°çŠ¶æ…‹ã«å¯¾ã—ã¦ã‚‚ã†ä¸€å›åˆ¤æ–­ã—ç›´ã›ã°è‡ªç„¶ã«é€šã‚‹ã‚„ã¤ğŸ’¡
* ä¾‹ï¼š`AddItem` / `IncreaseQuantity` / `AddTag` ãªã©ğŸ§ºâ•
* ãƒªãƒˆãƒ©ã‚¤ã§å†åº¦ã€Œæœ€æ–°ã®ã‚¤ãƒ™ãƒ³ãƒˆåˆ—ã‹ã‚‰çŠ¶æ…‹ã‚’å¾©å…ƒã—ã¦ã‚„ã‚Šç›´ã™ã€ã¯ã€ä¸€èˆ¬çš„ãªæ¥½è¦³ãƒ­ãƒƒã‚¯ã®å®šç•ªå¯¾å¿œã§ã‚‚ã‚ã‚‹ã‚ˆğŸ”([Microsoft Learn][2])

ğŸ‘‰ **åˆå¿ƒè€…ãŒæœ€åˆã«æ¡ç”¨ã™ã‚‹ãªã‚‰ã‚³ãƒ¬ãŒä¸€ç•ªå®‰å…¨** ğŸ§¸âœ¨

## â‘¡ å†å…¥åŠ›ä¿ƒã—ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚„ã‚Šç›´ã—ã¦ã‚‚ã‚‰ã†ï¼‰ãŒå‘ã„ã¦ã‚‹ã‚±ãƒ¼ã‚¹ğŸ§‘â€ğŸ’»ğŸŒ€

* â€œç·¨é›†ç³»â€ ã§ **æ„å›³ãŒå¤§äº‹** ãªã‚„ã¤ï¼ˆä¸Šæ›¸ããƒ»æ–‡ç« ç·¨é›†ãƒ»ä½æ‰€ç·¨é›†â€¦ï¼‰âœï¸ğŸ 
* ä¾‹ï¼š`ChangeShippingAddress` / `EditProfile` / `SetMemoText`
* è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤ã§é€šã—ã¦ã—ã¾ã†ã¨ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ„å›³ã¨ã‚ºãƒ¬ã‚‹ã“ã¨ãŒã‚ã‚‹ğŸ˜£

ğŸ‘‰ **409 Conflictã«ã—ã¦ã€æœ€æ–°ã‚’è¦‹ã›ã¦ã€Œã‚‚ã†ä¸€å›ã‚„ã£ã¦ã­ã€** ãŒç‹é“ğŸ™†â€â™€ï¸âœ¨

## â‘¢ ãƒãƒ¼ã‚¸ãŒå‘ã„ã¦ã‚‹ã‚±ãƒ¼ã‚¹ğŸ§©âœ¨ï¼ˆãŸã ã—æ¡ä»¶ã¤ãï¼‰

* ä¸¡æ–¹ã®å¤‰æ›´ãŒ **è¡çªã—ã«ãã„** or **åˆä½“ãƒ«ãƒ¼ãƒ«ãŒæ˜ç¢º** ãªã¨ã
* ä¾‹ï¼šã‚¿ã‚°è¿½åŠ åŒå£«ã¯åˆä½“ã§ãã‚‹ğŸ·ï¸ï¼‹ğŸ·ï¸ã€æ•°é‡å¤‰æ›´ã¯ãƒ«ãƒ¼ãƒ«æ¬¡ç¬¬ğŸ”¢

ğŸ‘‰ ãƒãƒ¼ã‚¸ã¯ã§ãã‚‹ã¨æ°—æŒã¡ã„ã„ã‘ã©ã€**ãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜ãŒè¦ã‚‹**ï¼ˆï¼è¨­è¨ˆãŒè¦ã‚‹ï¼‰ã®ã§ã€æœ€åˆã¯å°ã•ãã‚„ã‚‹ã®ãŒãŠã™ã™ã‚ğŸ˜Š

---

## â€œã‚„ã£ã¡ã‚ƒãƒ€ãƒ¡å¯„ã‚Šâ€ã®å¯¾å¿œã‚‚çŸ¥ã£ã¦ãŠã“ã†ğŸ™…â€â™€ï¸ğŸ’¦

## âŒ Last Writer Winsï¼ˆæœ€å¾Œã«æ¥ãŸäººãŒå‹ã¤ï¼‰ğŸ

çŠ¶æ…‹ä¿å­˜ã®ä¸–ç•Œã ã¨ã‚„ã‚ŠãŒã¡ã ã‘ã©ã€**æ›´æ–°ãŒæ¶ˆãˆã‚‹ï¼ˆãƒ­ã‚¹ãƒˆã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆï¼‰** äº‹æ•…ã«ã¤ãªãŒã‚Šã‚„ã™ã„ğŸ˜±
ã‚¤ãƒ™ãƒ³ãƒˆã‚½ãƒ¼ã‚·ãƒ³ã‚°ã§ã‚‚ã€Œè¡çªã‚’ç„¡è¦–ã™ã‚‹ã€è¨­å®šã«ã™ã‚‹ã¨å±é™ºãªã®ã§ã€ã¾ãšã¯é¿ã‘ã‚ˆã†ã­âš ï¸([Kurrent Docs][1])

---

## ãƒŸãƒ‹æ¼”ç¿’ï¼šæ–¹é‡ã‚’1ã¤é¸ã‚“ã§å®Ÿè£…ã™ã‚‹ï¼ˆæœ€å°ï¼‰âœ…ğŸ§ª

ã“ã“ã§ã¯ **â‘  è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤** ã‚’å®Ÿè£…ã™ã‚‹ã‚ˆğŸ”âœ¨
ï¼ˆã„ã¡ã°ã‚“æ¡ç”¨ç‡ãŒé«˜ãã¦ã€å­¦ç¿’ã«ã‚‚ãƒ”ãƒƒã‚¿ãƒªğŸ’›ï¼‰

## ç›®æ¨™ğŸ¯

* ç«¶åˆã§Appendå¤±æ•—ã—ãŸã‚‰ã€æœ€å¤§Nå›ã¾ã§ **èª­ã¿ç›´ã—ã¦å†æŒ‘æˆ¦** ã™ã‚‹
* ãã‚Œã§ã‚‚ãƒ€ãƒ¡ãªã‚‰ **Conflictã‚¨ãƒ©ãƒ¼** ã‚’è¿”ã™

---

## å®Ÿè£…ã‚¤ãƒ¡ãƒ¼ã‚¸å›³ğŸ§ ğŸ—ºï¸

![è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤æ–¹é‡ï¼šå¤±æ•—ã—ãŸã‚‰èª­ã¿ç›´ã—ã¦å†æŒ‘æˆ¦](./picture/es_ts_study_024_retry.png)

```mermaid
flowchart TD
    Read[Read Stream] --> Decide[Decide]
    Decide --> Append[Append w/ Lock]
    Append -- Success --> End([End])
    Append -- Conflict? --o Retry{Retry < N?}
    Retry -- Yes --> Read
    Retry -- No --> Error([Conflict Error])
```

1. ReadStreamï¼ˆã‚¤ãƒ™ãƒ³ãƒˆèª­ã‚€ï¼‰ğŸ“–
2. Rehydrateï¼ˆçŠ¶æ…‹å¾©å…ƒï¼‰ğŸ”
3. Decideï¼ˆæ–°ã‚¤ãƒ™ãƒ³ãƒˆä½œã‚‹ï¼‰ğŸ§ âœ¨
4. Appendï¼ˆexpectedVersionä»˜ãï¼‰ğŸ“Œ
5. ç«¶åˆãªã‚‰ 1 ã«æˆ»ã‚‹ğŸ”

---

## TypeScriptã‚³ãƒ¼ãƒ‰ä¾‹ï¼ˆæœ€å°ãƒªãƒˆãƒ©ã‚¤ç‰ˆï¼‰ğŸ§‘â€ğŸ’»âœ¨

```ts
// ç«¶åˆã‚¨ãƒ©ãƒ¼ï¼ˆexpectedVersion mismatchï¼‰ã‚’è¡¨ã™å°‚ç”¨ã‚¨ãƒ©ãƒ¼
export class ConcurrencyError extends Error {
  constructor(message = "Concurrency conflict") {
    super(message);
    this.name = "ConcurrencyError";
  }
}

export type StoredEvent = {
  type: string;
  data: unknown;
  meta: { occurredAt: string; eventId: string };
};

export interface EventStore {
  readStream(streamId: string): Promise<{ events: StoredEvent[]; version: number }>;
  appendToStream(
    streamId: string,
    expectedVersion: number,
    newEvents: StoredEvent[]
  ): Promise<{ newVersion: number }>;
}

// ãƒ‰ãƒ¡ã‚¤ãƒ³çŠ¶æ…‹ï¼ˆä¾‹ï¼šã‚«ãƒ¼ãƒˆï¼‰
export type CartState = {
  items: Record<string, number>; // sku -> qty
  isClosed: boolean;
};

// Rehydrateï¼ˆã‚¤ãƒ™ãƒ³ãƒˆåˆ—ã‹ã‚‰çŠ¶æ…‹ã‚’ä½œã‚‹ï¼‰
export function rehydrateCart(events: StoredEvent[]): CartState {
  const state: CartState = { items: {}, isClosed: false };

  for (const ev of events) {
    switch (ev.type) {
      case "CartCreated":
        // no-op (åˆæœŸçŠ¶æ…‹ã¯ã™ã§ã«ç”¨æ„)
        break;

      case "ItemAdded": {
        const { sku, qty } = ev.data as { sku: string; qty: number };
        state.items[sku] = (state.items[sku] ?? 0) + qty;
        break;
      }

      case "CartClosed":
        state.isClosed = true;
        break;

      default:
        // æœªçŸ¥ã‚¤ãƒ™ãƒ³ãƒˆã¯ç„¡è¦–ã›ãšã€é–‹ç™ºä¸­ã¯æ°—ã¥ã‘ã‚‹ã‚ˆã†ã«ã™ã‚‹ã®ãŒå®‰å…¨âœ¨
        throw new Error(`Unknown event type: ${ev.type}`);
    }
  }

  return state;
}

// Decideï¼ˆã‚³ãƒãƒ³ãƒ‰â†’æ–°ã‚¤ãƒ™ãƒ³ãƒˆï¼‰
// â€»ã“ã“ã§ã¯è¶…ã‚·ãƒ³ãƒ—ãƒ«ãªä¾‹ï¼šAddItemã‚³ãƒãƒ³ãƒ‰ã ã‘
export type AddItemCommand = { kind: "AddItem"; cartId: string; sku: string; qty: number };

export function decideCart(state: CartState, cmd: AddItemCommand): StoredEvent[] {
  if (state.isClosed) {
    // æœ¬å½“ã¯ç¬¬21ç« ã®Resultå‹ã£ã½ãè¿”ã™ã®ãŒç¶ºéº—ã ã‘ã©ã€ã“ã“ã§ã¯æœ€å°ã§throwä¾‹
    throw new Error("Cart is closed");
  }
  if (cmd.qty <= 0) throw new Error("qty must be positive");

  return [
    {
      type: "ItemAdded",
      data: { sku: cmd.sku, qty: cmd.qty },
      meta: { occurredAt: new Date().toISOString(), eventId: crypto.randomUUID() },
    },
  ];
}

// âœ… ç«¶åˆå¯¾å¿œï¼šè‡ªå‹•ãƒªãƒˆãƒ©ã‚¤ï¼ˆæœ€å¤§maxRetrieså›ï¼‰
export async function handleAddItemWithRetry(
  store: EventStore,
  cmd: AddItemCommand,
  maxRetries = 3
): Promise<{ ok: true } | { ok: false; reason: "conflict" }> {
  for (let attempt = 1; attempt <= maxRetries; attempt++) {
    const { events, version } = await store.readStream(cmd.cartId);
    const state = rehydrateCart(events);

    const newEvents = decideCart(state, cmd);

    try {
      await store.appendToStream(cmd.cartId, version, newEvents);
      return { ok: true };
    } catch (e) {
      if (e instanceof ConcurrencyError) {
        // ç«¶åˆï¼â†’ èª­ã¿ç›´ã—ã¦å†æŒ‘æˆ¦ğŸ”
        continue;
      }
      // ç«¶åˆä»¥å¤–ã¯ä¸Šã«æŠ•ã’ã‚‹ï¼ˆã‚¤ãƒ³ãƒ•ãƒ©éšœå®³ãªã©ï¼‰
      throw e;
    }
  }

  // ä½•å›ã‚„ã£ã¦ã‚‚ç«¶åˆã™ã‚‹ãªã‚‰ã€å‘¼ã³å‡ºã—å…ƒã¸ã€Œè¡çªã—ãŸã‚ˆã€ã‚’è¿”ã™ğŸ§¯
  return { ok: false, reason: "conflict" };
}
```

## ã“ã“ãŒãƒã‚¤ãƒ³ãƒˆã ã‚ˆğŸ’¡âœ¨

* **ãƒªãƒˆãƒ©ã‚¤å›æ•°ã¯å¿…ãšä¸Šé™ã‚’æ±ºã‚ã‚‹**ï¼ˆç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢ï¼‰ğŸŒ€ğŸš«
* ãƒªãƒˆãƒ©ã‚¤ã¯ã€Œ**èª­ã¿ç›´ã—â†’å†åˆ¤æ–­**ã€ãŒåŸºæœ¬ï¼ˆå¤ã„stateã§å†Appendã—ãªã„ï¼‰ğŸ”
* â€œè¶³ã—ç®—ç³»ã‚³ãƒãƒ³ãƒ‰â€ ãªã‚‰ã“ã®æ–¹å¼ãŒã‹ãªã‚Šå¼·ã„ğŸ’ªğŸ˜Š

---

## APIã«ã—ãŸã¨ãã®è¿”ã—æ–¹ï¼ˆè¶…ãƒŸãƒ‹ï¼‰ğŸŒâœ¨

ãƒªãƒˆãƒ©ã‚¤ã—ã¦ã‚‚ãƒ€ãƒ¡ã ã£ãŸã‚‰ã€ã ã„ãŸã„ã¯ã“ã†ã™ã‚‹ã‚ˆğŸ‘‡

* HTTPãªã‚‰ **409 Conflict** ã‚’è¿”ã™ğŸ›‘
* ç”»é¢ã«ã¯
  ã€Œä»–ã®äººãŒå…ˆã«æ›´æ–°ã—ãŸã¿ãŸã„ğŸ™ æœ€æ–°ã‚’èª­ã¿è¾¼ã‚“ã§ã‚‚ã†ä¸€å›ãŠé¡˜ã„ï¼ã€
  ã¿ãŸã„ã«å‡ºã™ğŸ“£ğŸ’

---

## ãƒãƒ¼ã‚¸æ–¹é‡ã‚’ â€œã¡ã‚‡ã£ã¨ã ã‘â€ ç¾å®Ÿå¯„ã›ã§èªã‚‹ğŸ§©âœ¨

ã‚¤ãƒ™ãƒ³ãƒˆã‚½ãƒ¼ã‚·ãƒ³ã‚°ã§ã®ã€Œãƒãƒ¼ã‚¸ã€ã£ã¦ã€åŸºæœ¬ã¯ã“ã†ã„ã†ç™ºæƒ³ã ã‚ˆğŸ‘‡

* ã‚¤ãƒ™ãƒ³ãƒˆå±¥æ­´ã¯ **æ”¹ã–ã‚“ã—ãªã„**ï¼ˆAppend-onlyï¼‰ğŸ“œâœ¨
* ã ã‹ã‚‰ã€Œè¡çªã—ãŸ2ã¤ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ··ãœã‚‹ã€ã‚ˆã‚Šã‚‚ã€
  **æœ€æ–°çŠ¶æ…‹ã«å¯¾ã—ã¦ã€ã‚‚ã†ä¸€å›ã‚³ãƒãƒ³ãƒ‰ã‚’è§£é‡ˆã—ç›´ã™**ï¼ˆï¼å†åˆ¤æ–­ï¼‰ãŒå¤šã„ğŸ”

ãŸã¨ãˆã° `AddItem` åŒå£«ã®è¡çªã¯ã€å†åˆ¤æ–­ã§è‡ªç„¶ã«åˆä½“ã§ãã‚‹ã“ã¨ãŒå¤šã„ã‚ˆğŸ›’â•ğŸ›’

---

## ã‚ˆãã‚ã‚‹è½ã¨ã—ç©´ğŸ•³ï¸ğŸ˜µ

## è½ã¨ã—ç©´1ï¼šãƒªãƒˆãƒ©ã‚¤ã§ â€œãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ„å›³â€ ãŒã‚ºãƒ¬ã‚‹ğŸŒ€

* â€œä¸Šæ›¸ãç³»â€ã¯ç‰¹ã«å±é™ºâš ï¸
* ãã®å ´åˆã¯ **å†å…¥åŠ›ä¿ƒã—** ãŒç´ ç›´ã§å®‰å…¨ğŸ§‘â€ğŸ’»âœ¨

## è½ã¨ã—ç©´2ï¼šãƒªãƒˆãƒ©ã‚¤ãŒå¤šã™ãã¦é‡ã„ğŸ¢

* ãƒªãƒˆãƒ©ã‚¤ã¯æœ€å¤§2ã€œ3å›ãã‚‰ã„ãŒç›®å®‰
* ãã‚Œä»¥ä¸Šã¯è¨­è¨ˆã‚’è¦‹ç›´ã™ã‚µã‚¤ãƒ³ã‹ã‚‚ğŸ‘€ğŸ”

---

## AIæ´»ç”¨ï¼ˆCopilot / Codexæƒ³å®šï¼‰ğŸ¤–ğŸ’–

## 1) æ–¹é‡é¸æŠã®ãŸã‚ã®è³ªå•ãƒ†ãƒ³ãƒ—ãƒ¬ğŸ§ 

```text
ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€Œè‡ªå‹•ãƒªãƒˆãƒ©ã‚¤ã€ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å†å…¥åŠ›ä¿ƒã—ã€ã€Œãƒãƒ¼ã‚¸ã€ã®ã©ã‚ŒãŒé©åˆ‡ï¼Ÿ
ãƒ‰ãƒ¡ã‚¤ãƒ³ã¯ã€‡ã€‡ã€‚ã‚³ãƒãƒ³ãƒ‰ã¯ã€‡ã€‡ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ„å›³ãŒé‡è¦ã‹ã€è¶³ã—ç®—ç³»ã‹ã€è¡çªæ™‚ã«ä½•ãŒå›°ã‚‹ã‹ã‚’æ•´ç†ã—ã¦è¡¨ã«ã—ã¦ã€‚
```

## 2) 409 Conflictã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ¡ˆã¥ãã‚ŠğŸ“£

```text
409 Conflictæ™‚ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å‡ºã™ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã€ã‚„ã•ã—ããƒ»çŸ­ããƒ»ä¸å®‰ã‚’ç…½ã‚‰ãšã«3æ¡ˆãã ã•ã„ï¼ˆçµµæ–‡å­—å¤šã‚ï¼‰ã€‚
```

---

## æœ€æ–°äº‹æƒ…ãƒ¡ãƒ¢ï¼ˆ2026ã£ã½ã„è¦–ç‚¹ï¼‰ğŸ—“ï¸âœ¨

* Node.jsã¯ **v24ãŒActive LTS**ã€v22ã¯Maintenance LTSã«å…¥ã£ã¦ã‚‹ã‚ˆğŸ“¦([Node.js][3])
* Nodeã«ã¯ `node:sqlite` ãŒå…¥ã£ã¦ãã¦ã„ã¦ã€v22.5.0ä»¥é™ã§ä½¿ãˆã‚‹ï¼ˆãŸã ã— â€œã¾ã experimentalâ€ æ‰±ã„ï¼‰ğŸ§ª([Node.js][4])
* TypeScriptã¯2025å¹´ç§‹ã« **5.9ç³»** ãŒå‡ºã¦ã‚‹ã‚ˆğŸ§¡([GitHub][5])
* VS Codeã®æ›´æ–°ã¯ **1.108ï¼ˆDecember 2025ï¼‰** ãŒ2026å¹´1æœˆã«å‡ºã¦ã‚‹ğŸ“Œ([Visual Studio Code][6])

---

## ã“ã®ç« ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆâœ…ğŸ“

* [ ] ç«¶åˆãŒã€ŒexpectedVersionã®ã‚ºãƒ¬ã€ã ã¨èª¬æ˜ã§ãã‚‹ğŸ”’
* [ ] ãƒªãƒˆãƒ©ã‚¤ï¼å†å…¥åŠ›ä¿ƒã—ï¼ãƒãƒ¼ã‚¸ ã®ä½¿ã„åˆ†ã‘ãŒè¨€ãˆã‚‹ğŸ§­
* [ ] ãƒªãƒˆãƒ©ã‚¤å®Ÿè£…ã«ã€Œä¸Šé™å›æ•°ã€ãŒå…¥ã£ã¦ã‚‹ğŸ”ğŸš«
* [ ] ãã‚Œã§ã‚‚ãƒ€ãƒ¡ãªã‚‰ â€œConflictã¨ã—ã¦è¿”ã™â€ æ–¹é‡ã«ãªã£ã¦ã‚‹ğŸ§¯

[1]: https://docs.kurrent.io/clients/tcp/dotnet/21.2/appending?utm_source=chatgpt.com "Appending events - Kurrent Docs"
[2]: https://learn.microsoft.com/en-us/ef/core/saving/concurrency?utm_source=chatgpt.com "Handling Concurrency Conflicts - EF Core"
[3]: https://nodejs.org/en/about/previous-releases?utm_source=chatgpt.com "Node.js Releases"
[4]: https://nodejs.org/api/sqlite.html?utm_source=chatgpt.com "SQLite | Node.js v25.5.0 Documentation"
[5]: https://github.com/microsoft/typescript/releases?utm_source=chatgpt.com "Releases Â· microsoft/TypeScript"
[6]: https://code.visualstudio.com/updates?utm_source=chatgpt.com "December 2025 (version 1.108)"
