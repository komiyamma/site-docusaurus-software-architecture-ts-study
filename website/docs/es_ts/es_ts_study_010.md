# 10ç« ï¼šAggregateï¼ˆé›†ç´„ï¼‰ã¨å¢ƒç•Œã®æ±ºã‚æ–¹ğŸ£ğŸ§©

## ã“ã®ç« ã§ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã“ã¨ğŸ¯âœ¨

* ã€ŒAggregateã£ã¦ãªã«ï¼Ÿã€ã‚’ã€**ã‚¤ãƒ™ãƒ³ãƒˆã‚½ãƒ¼ã‚·ãƒ³ã‚°è¦–ç‚¹**ã§èª¬æ˜ã§ãã‚‹ğŸ˜Š
* **ã©ã“ã¾ã§ã‚’â€œã²ã¨ã¾ã¨ã¾ã‚Šâ€ã«ã™ã‚‹ã‹ï¼ˆå¢ƒç•Œï¼‰**ã‚’ã€ãƒ«ãƒ¼ãƒ«ï¼ˆä¸å¤‰æ¡ä»¶ï¼‰ã‹ã‚‰æ±ºã‚ã‚‰ã‚Œã‚‹ğŸ§ ğŸ”
* å¢ƒç•Œã®â€œè‰¯ã—æ‚ªã—â€ã‚’ **2æ¡ˆæ¯”è¼ƒ** ã§åˆ¤æ–­ã§ãã‚‹âš–ï¸âœ¨

---

## 1. é›†ç´„ï¼ˆAggregateï¼‰ï¼ã€Œæ•´åˆæ€§ã®å¢ƒç•Œã€ğŸ›¡ï¸âœ¨

![é›†ç´„ã®å¢ƒç•Œï¼š1ã‚¹ãƒˆãƒªãƒ¼ãƒ ã«é–‰ã˜ãŸæ•´åˆæ€§](./picture/es_ts_study_010_boundary.png)

ã€Œé›†ç´„ã£ã¦ä½•ï¼Ÿã€ã‚’ã²ã¨è¨€ã§ã„ã†ã¨ã€
ã–ã£ãã‚Šè¨€ã†ã¨â€¦

> **ã€Œã“ã®ä¸­ã®å¤‰æ›´ã¯ã€å¿…ãšã¾ã¨ã‚ã¦æ•´åˆæ€§ã‚’ä¿ã¡ãŸã„ï¼ã€**
> ã¨ã„ã†â€œã²ã¨ã¾ã¨ã¾ã‚Šâ€ã®å˜ä½ã ã‚ˆğŸ“¦âœ¨

ã‚¤ãƒ™ãƒ³ãƒˆã‚½ãƒ¼ã‚·ãƒ³ã‚°ã§ã¯ã€ã“ã“ãŒè¶…é‡è¦ãƒã‚¤ãƒ³ãƒˆğŸ‘‡

* **1ã¤ã®Aggregateï¼ˆé›†ç´„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼‰ï¼ 1ã¤ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ãƒˆãƒªãƒ¼ãƒ **
* ãã®ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®ä¸­ã§ **ä¸å¤‰æ¡ä»¶ï¼ˆçµ¶å¯¾å®ˆã‚‹ãƒ«ãƒ¼ãƒ«ï¼‰** ã‚’å®ˆã‚‹
* å¤–ã‹ã‚‰è§¦ã£ã¦ã„ã„å…¥å£ã¯ **Aggregate Rootï¼ˆãƒ«ãƒ¼ãƒˆï¼‰ã ã‘**

â€¦ã¨ã„ã†å½¢ã«ã™ã‚‹ã¨å®‰å®šã—ã‚„ã™ã„ã‚ˆğŸ˜Š([Event Sourcing Guide][1])

---

## 2. ã€Œå¢ƒç•Œã€ã£ã¦ãªã«ï¼Ÿã©ã“ã§åˆ‡ã‚‹ã®ï¼Ÿâœ‚ï¸ğŸ§ 

å¢ƒç•Œã¯ã€åˆ¥ã®è¨€ã„æ–¹ã‚’ã™ã‚‹ã¨ **Consistency Boundaryï¼ˆæ•´åˆæ€§å¢ƒç•Œï¼‰**ã€‚

* å¢ƒç•Œã®ä¸­ï¼š**ãã®å ´ã§å¿…ãšä¸€è‡´ï¼ˆåŸå­çš„/å³æ™‚ï¼‰**
* å¢ƒç•Œã®å¤–ï¼š**æœ€çµ‚çš„ã«åˆãˆã°OKï¼ˆçµæœæ•´åˆï¼‰** ã«ãªã‚ŠãŒã¡

ã¤ã¾ã‚Šè³ªå•ã¯ã“ã‚ŒğŸ‘‡

> ã€Œã©ã“ã¾ã§ã‚’â€œåŒæ™‚ã«å¿…ãšæ›´æ–°ã•ã‚Œã‚‹ã¹ãç¯„å›²â€ã«ã™ã‚‹ï¼Ÿã€

ã“ã®è€ƒãˆæ–¹ãŒã€Aggregateã‚„ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³è¨­è¨ˆã®ã‚«ã‚®ã ã‚ˆğŸ”‘âœ¨([cqrs.com][2])

---

## 3. å¢ƒç•Œã®æ±ºã‚æ–¹ï¼šã¾ãšâ€œä¸å¤‰æ¡ä»¶â€ã‹ã‚‰é€†ç®—ã—ã‚ˆã†ğŸ§·ğŸ›¡ï¸

å¢ƒç•Œã‚’æ„Ÿè¦šã§æ±ºã‚ã‚‹ã¨äº‹æ•…ã‚Šã‚„ã™ã„ã®ã§ã€é †ç•ªã¯ã“ã‚ŒãŒé‰„æ¿ğŸ˜Š

## ã‚¹ãƒ†ãƒƒãƒ—Aï¼šä¸å¤‰æ¡ä»¶ã‚’3ã¤æ›¸ãğŸ“âœ¨

ä¾‹ï¼ˆã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ã‚«ãƒ¼ãƒˆé¡ŒæğŸ›’ï¼‰

* â‘  ã‚«ãƒ¼ãƒˆå†…ã®æ•°é‡ã¯ **1ä»¥ä¸Š**
* â‘¡ åŒã˜å•†å“ã¯ **1è¡Œã«ã¾ã¨ã‚ã‚‹**ï¼ˆé‡è¤‡è¡Œã¯ç¦æ­¢ï¼‰
* â‘¢ ã‚«ãƒ¼ãƒˆã®åˆè¨ˆé‡‘é¡ã¯ **å„è¡Œã®åˆè¨ˆã¨ä¸€è‡´**

ã“ã®ã€Œ**åŒæ™‚ã«å¿…ãšå®ˆã‚ŠãŸã„**ã€ãƒ«ãƒ¼ãƒ«ãŒã€å¢ƒç•Œã®ä¸­å¿ƒã«ãªã‚‹ã‚ˆğŸ§ ğŸ”¥

## ã‚¹ãƒ†ãƒƒãƒ—Bï¼šãã®ãƒ«ãƒ¼ãƒ«ã‚’â€œèª°ãŒè²¬ä»»æŒã¤ã‹â€æ±ºã‚ã‚‹ğŸ‘®â€â™€ï¸âœ…

* ãƒ«ãƒ¼ãƒ«ã‚’å®ˆã‚‹è²¬ä»»è€…ï¼**Aggregate Root** ã«ãªã‚Šã‚„ã™ã„

## ã‚¹ãƒ†ãƒƒãƒ—Cï¼šã€Œä¸€ç·’ã«åŸå­çš„ã«æ›´æ–°ã—ãŸã„ã‚‚ã®ã€ã‚’åŒã˜é›†ç´„ã¸ğŸ”—

* åŒæ™‚ã«å®ˆã‚ŠãŸã„ãªã‚‰åŒã˜é›†ç´„
* ãã†ã˜ã‚ƒãªã„ãªã‚‰åˆ¥é›†ç´„ï¼ˆçµæœæ•´åˆã§ã¤ãªãï¼‰

---

## 4. å…·ä½“ä¾‹ï¼šã‚«ãƒ¼ãƒˆã¯ã©ã“ã¾ã§â€œ1ã¤â€ã«ã™ã‚‹ï¼ŸğŸ›’âš–ï¸

ã“ã“ãŒä¸€ç•ªæ‚©ã‚€ã¨ã“ã‚ï¼ãªã®ã§ã€ã‚ˆãã‚ã‚‹2æ¡ˆã‚’æ¯”ã¹ã‚‹ã‚ˆğŸ˜Š

## æ¡ˆ1ï¼šCarté›†ç´„ï¼ˆã‚«ãƒ¼ãƒˆï¼‹æ˜ç´°ï¼‰ã ã‘ã‚’1ã¤ã«ã™ã‚‹ğŸ§ºâœ…

**å…¥ã‚Œã‚‹ã‚‚ã®**

* Cartï¼ˆãƒ«ãƒ¼ãƒˆï¼‰
* CartItemï¼ˆå†…éƒ¨ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ï¼‰

**è‰¯ã„ã¨ã“ã‚**

* ã‚«ãƒ¼ãƒˆå†…ãƒ«ãƒ¼ãƒ«ãŒã‚·ãƒ³ãƒ—ãƒ«ã«å®ˆã‚Œã‚‹ğŸ˜Š
* 1ã‚¹ãƒˆãƒªãƒ¼ãƒ ã§å®Œçµã—ã‚„ã™ã„ğŸ“¼âœ¨

**æ‚©ã¿ã©ã“ã‚**

* åœ¨åº«ï¼ˆInventoryï¼‰ã‚„ä¾¡æ ¼ï¼ˆPricingï¼‰ã¾ã§ã€Œå¸¸ã«åŒæ™‚ã«æ­£ã—ã„ã€ã‚’ç‹™ã†ã¨ã€å¢ƒç•Œã®å¤–ã«ãªã‚‹
  â†’ â€œè³¼å…¥ç¢ºå®šâ€ã®ç¬é–“ã«åˆ¥ã®ä»•çµ„ã¿ã§ãƒã‚§ãƒƒã‚¯ã™ã‚‹è¨­è¨ˆã«ãªã‚Šã‚„ã™ã„ğŸ§¯

## æ¡ˆ2ï¼šCartï¼‹Inventoryã¾ã§1ã¤ã®é›†ç´„ã«ã¾ã¨ã‚ã‚‹ğŸ“¦âš ï¸

**è‰¯ã„ã¨ã“ã‚**

* ã€Œåœ¨åº«ã‚’æ¸›ã‚‰ã™ã€ã¨ã€Œã‚«ãƒ¼ãƒˆæ›´æ–°ã€ã‚’åŸå­çš„ã«ã§ãã‚‹ã‹ã‚‚âœ¨

**ã§ã‚‚â€¦**

* é›†ç´„ãŒå·¨å¤§åŒ–ã—ã‚„ã™ã„ğŸ˜µâ€ğŸ’«
* ç«¶åˆï¼ˆåŒæ™‚æ›´æ–°ï¼‰ãŒå¢—ãˆã‚„ã™ã„âš”ï¸
* â€œã‚«ãƒ¼ãƒˆæ›´æ–°â€ãŒåœ¨åº«å…¨ä½“ã®éƒ½åˆã§é‡ããªã‚‹ã“ã¨ã‚‚

> â€»ã€Œä½•ã‚’åŸå­çš„ã«å®ˆã‚ŠãŸã„ã‹ã€ãŒæœ€å„ªå…ˆï¼

```mermaid
graph TD
    subgraph AggregateBoundary["Aggregate: Cart (é›†ç´„ã®å¢ƒç•Œ)"]
        CartRoot((Cart Root))
        Item1[Item A]
        Item2[Item B]
        CartRoot --- Item1
        CartRoot --- Item2
    end
    
    Inventory[(Inventory DB)] --- External[External Service]
    External -. "çµæœæ•´åˆæ€§" .-> CartRoot
```

---

## 5. åˆè¨€è‘‰ï¼šã€Œ1é›†ç´„ï¼1ã‚¹ãƒˆãƒªãƒ¼ãƒ ã€ã£ã¦ã€ä½•ãŒå¬‰ã—ã„ã®ï¼ŸğŸ“¼âœ¨

ã‚¤ãƒ™ãƒ³ãƒˆã‚½ãƒ¼ã‚·ãƒ³ã‚°ã§ã¯ã€Aggregateã‚’æ±ºã‚ã‚‹ï¼**ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®å˜ä½**ã‚’æ±ºã‚ã‚‹ã“ã¨ã§ã‚‚ã‚ã‚‹ã‚ˆğŸ˜Š([Event Sourcing Guide][1])

## ã“ã“ãŒå¬‰ã—ã„ğŸ

* ãƒ«ãƒ¼ãƒ«ï¼ˆä¸å¤‰æ¡ä»¶ï¼‰ã‚’ **1ã‹æ‰€ã§å®ˆã‚Œã‚‹**ğŸ›¡ï¸
* ã‚¤ãƒ™ãƒ³ãƒˆãŒ1åˆ—ã«ä¸¦ã¶ã‹ã‚‰ **é †åºãŒæ˜ç¢º**â³
* ç«¶åˆã‚’é˜²ãè¨­è¨ˆï¼ˆexpectedVersionãªã©ï¼‰ã«ç¹‹ã’ã‚„ã™ã„ğŸ”’

---

## 6. ã‚ˆãã‚ã‚‹å¢ƒç•ŒãƒŸã‚¹é›†ğŸ™…â€â™€ï¸ğŸ’¥

## ãƒŸã‚¹1ï¼šãªã‚“ã§ã‚‚1é›†ç´„ã«å…¥ã‚Œã‚‹ï¼ˆå·¨å¤§é›†ç´„ï¼‰ğŸ˜ğŸ’¦

* å¤‰æ›´ã™ã‚‹ãŸã³ã«èª­ã¿è¾¼ã‚€ã‚¤ãƒ™ãƒ³ãƒˆãŒå¤šã„
* åŒæ™‚æ›´æ–°ãŒå¢—ãˆã¦å¤±æ•—ã—ã‚„ã™ã„
* â€œå°ã•ãªå¤‰æ›´â€ãŒâ€œã§ã‹ã„ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³â€ã«ãªã‚‹ğŸ˜µâ€ğŸ’«

## ãƒŸã‚¹2ï¼šé€†ã«ç´°ã‹ãå‰²ã‚Šã™ãï¼ˆé›†ç´„ãŒç²‰ã€…ï¼‰ğŸ§©ğŸŒ€

* 1ã¤ã®æ“ä½œã§è¤‡æ•°ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’â€œåŒæ™‚ã«â€æ›´æ–°ã—ãŸããªã£ã¦åœ°ç„
* çµå±€ã€ŒåŒæ™‚æ›´æ–°ã—ãŸã„ã‹ã‚‰åˆä½“â€¦ã€ã¨ãªã‚ŠãŒã¡

## ãƒŸã‚¹3ï¼šå¢ƒç•Œã‚’â€œãƒ‡ãƒ¼ã‚¿æ§‹é€ â€ã§æ±ºã‚ã‚‹ğŸ“šâŒ

* DBãƒ†ãƒ¼ãƒ–ãƒ«å˜ä½ã§æ±ºã‚ã‚‹ã¨ã€ãƒ«ãƒ¼ãƒ«ã®è²¬ä»»ãŒæ•£ã‚Šã‚„ã™ã„
* **ãƒ«ãƒ¼ãƒ«ï¼ˆä¸å¤‰æ¡ä»¶ï¼‰â†’è²¬ä»»è€…â†’å¢ƒç•Œ** ã®é †ãŒå¼·ã„ã‚ˆğŸ˜Š

---

## 7. TypeScriptã§â€œå¢ƒç•Œâ€ã‚’ã‚³ãƒ¼ãƒ‰ã«è½ã¨ã™ãƒŸãƒ‹ä¾‹ğŸ±ğŸ§‘â€ğŸ’»

ã“ã“ã§ã¯ã€ŒCarté›†ç´„ï¼ˆæ¡ˆ1ï¼‰ã€ã®é›°å›²æ°—ã ã‘æ´ã‚‚ã†ğŸ˜Š
ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆã‚¹ãƒˆã‚¢ã¯å¾Œã®ç« ã§æœ¬æ ¼åŒ–ã™ã‚‹ã®ã§ã€ã“ã“ã§ã¯ **é›†ç´„ã®å½¢** ã«é›†ä¸­ï¼ï¼‰

## ã‚¤ãƒ™ãƒ³ãƒˆå‹ï¼ˆCartã‚¹ãƒˆãƒªãƒ¼ãƒ ã«ç©ã‚€ã‚‚ã®ï¼‰ğŸ“®

```ts
type CartId = string;
type ProductId = string;

type CartEvent =
  | { type: "CartCreated"; cartId: CartId; createdAt: string }
  | { type: "ItemAdded"; cartId: CartId; productId: ProductId; qty: number }
  | { type: "ItemQtyChanged"; cartId: CartId; productId: ProductId; qty: number }
  | { type: "ItemRemoved"; cartId: CartId; productId: ProductId };
```

## çŠ¶æ…‹ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆåˆ—ã‹ã‚‰å¾©å…ƒã•ã‚Œã‚‹â€œç¾åœ¨ã®å§¿â€ï¼‰ğŸ”

```ts
type CartState = {
  cartId: CartId;
  exists: boolean;
  items: Map<ProductId, number>; // qty
};

const emptyCart = (cartId: CartId): CartState => ({
  cartId,
  exists: false,
  items: new Map(),
});
```

## Applyï¼ˆã‚¤ãƒ™ãƒ³ãƒˆâ†’çŠ¶æ…‹å¤‰åŒ–ï¼‰ğŸª„

```ts
function apply(state: CartState, e: CartEvent): CartState {
  switch (e.type) {
    case "CartCreated": {
      return { ...state, exists: true };
    }
    case "ItemAdded": {
      const items = new Map(state.items);
      items.set(e.productId, (items.get(e.productId) ?? 0) + e.qty);
      return { ...state, items };
    }
    case "ItemQtyChanged": {
      const items = new Map(state.items);
      items.set(e.productId, e.qty);
      return { ...state, items };
    }
    case "ItemRemoved": {
      const items = new Map(state.items);
      items.delete(e.productId);
      return { ...state, items };
    }
  }
}
```

## Decideï¼ˆä¸å¤‰æ¡ä»¶ãƒã‚§ãƒƒã‚¯â†’æ–°ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ±ºã‚ã‚‹ï¼‰ğŸ›¡ï¸â¡ï¸ğŸ“®

```ts
type AddItemCommand = {
  type: "AddItem";
  cartId: CartId;
  productId: ProductId;
  qty: number;
};

function decideAddItem(state: CartState, cmd: AddItemCommand): CartEvent[] {
  // ä¸å¤‰æ¡ä»¶ï¼šqtyã¯1ä»¥ä¸Š
  if (cmd.qty < 1) {
    throw new Error("æ•°é‡ã¯1ä»¥ä¸Šã ã‚ˆğŸ¥º"); // å¾Œã®ç« ã§Resultå‹ã«ã™ã‚‹äºˆå®šğŸš¦
  }

  // ã“ã“ã§ã¯ â€œåœ¨åº«ãƒã‚§ãƒƒã‚¯â€ ã¯å¢ƒç•Œã®å¤–ï¼ˆåˆ¥é›†ç´„/åˆ¥ä»•çµ„ã¿ï¼‰ã«ã™ã‚‹
  // â†’ Carté›†ç´„ã¯ã€Œã‚«ãƒ¼ãƒˆå†…ã®ä¸€è²«æ€§ã€ã«é›†ä¸­ã™ã‚‹ğŸ˜Š

  // è¿½åŠ ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿”ã™
  return [
    {
      type: "ItemAdded",
      cartId: cmd.cartId,
      productId: cmd.productId,
      qty: cmd.qty,
    },
  ];
}
```

ã“ã®ã‚³ãƒ¼ãƒ‰ãŒè¡¨ã—ã¦ã‚‹ã“ã¨ğŸ‘‡

* **Carté›†ç´„ãŒå®ˆã‚‹ã®ã¯ã€Œã‚«ãƒ¼ãƒˆå†…ãƒ«ãƒ¼ãƒ«ã€**ã ã‘
* åœ¨åº«ã‚„ä¾¡æ ¼ã¿ãŸã„ã«ã€Œå¤–ã®ä¸–ç•Œã€ã¯ã€åˆ¥é›†ç´„ or åˆ¥ãƒ—ãƒ­ã‚»ã‚¹ã§æ‰±ã†è¨­è¨ˆã«ã—ã‚„ã™ã„
* å¢ƒç•Œã‚’æ±ºã‚ã‚‹ï¼ã€Œã“ã®é›†ç´„ãŒå®ˆã‚‹è²¬ä»»ã®ç¯„å›²ã€ã‚’æ±ºã‚ã‚‹ã“ã¨ğŸ§ âœ¨

---

## 8. ãƒŸãƒ‹æ¼”ç¿’ï¼šå¢ƒç•Œæ¡ˆã‚’2ã¤ä½œã£ã¦æ¯”è¼ƒã—ã‚ˆã†âš–ï¸ğŸ“

é¡Œæï¼ˆä¾‹ï¼šã‚«ãƒ¼ãƒˆğŸ›’ï¼‰ã§ã€æ¬¡ã‚’ã‚„ã£ã¦ã¿ã¦ã­ğŸ˜Š

## â‘  ä¸å¤‰æ¡ä»¶ã‚’3ã¤æ›¸ãğŸ§·

* ï¼ˆä¾‹ï¼‰æ•°é‡ã€é‡è¤‡ã€åˆè¨ˆâ€¦ãªã©

## â‘¡ å¢ƒç•Œæ¡ˆã‚’2ã¤ä½œã‚‹ğŸ§ºğŸ§º

* æ¡ˆAï¼šCartã ã‘
* æ¡ˆBï¼šCartï¼‹Inventoryã‚‚ä¸€ç·’

## â‘¢ 3é …ç›®ã§æ¯”è¼ƒã™ã‚‹ğŸ“‹âœ¨

* åŸå­çš„ã«å®ˆã‚Œã‚‹ãƒ«ãƒ¼ãƒ«ã¯ä½•ï¼Ÿ
* ç«¶åˆï¼ˆåŒæ™‚æ›´æ–°ï¼‰ã¯å¢—ãˆãã†ï¼Ÿ
* å°†æ¥å¤‰æ›´ï¼ˆæ‹¡å¼µï¼‰ã«å¼·ãã†ï¼Ÿ

---

## 9. AIæ´»ç”¨ï¼šå¢ƒç•Œãƒ¬ãƒ“ãƒ¥ãƒ¼ã®â€œå‹â€ğŸ¤–ğŸ§ âœ¨

AIã«æŠ•ã’ã‚‹ã¨ãã¯ã€ãµã‚ã£ã¨èã‹ãšã«ã“ã‚ŒãŒå®‰å®šğŸ˜Š

* **ä¸å¤‰æ¡ä»¶**ï¼šã“ã®æ“ä½œã§çµ¶å¯¾å®ˆã‚ŠãŸã„ãƒ«ãƒ¼ãƒ«ã¯ã“ã‚Œ
* **å¢ƒç•Œæ¡ˆA/B**ï¼šãã‚Œãã‚Œä½•ã‚’å«ã‚ã‚‹ã‹
* **æƒ³å®šãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹**ï¼š1ç§’é–“ã«ä½•å›ãã‚‰ã„æ›´æ–°ï¼ŸåŒæ™‚æ›´æ–°ã‚ã‚‹ï¼Ÿ
* **è³ªå•**ï¼šã©ã®æ¡ˆãŒäº‹æ•…ã‚Šã«ãã„ï¼Ÿç†ç”±ã¯ï¼Ÿ

AIã«ã€Œ**æ¡ˆA/Bã®ãƒ¡ãƒªãƒ‡ãƒ¡ã‚’ã€ç«¶åˆãƒ»å¤‰æ›´å®¹æ˜“æ€§ãƒ»è²¬ä»»åˆ†é›¢ã®è¦³ç‚¹ã§**ã€ã£ã¦è¨€ã†ã¨ã€ã ã„ã¶ä½¿ãˆã‚‹ã‚ˆğŸ“Œâœ¨

---

## ğŸ§  ã¡ã‚‡ã„æœ€æ–°ãƒ¡ãƒ¢ï¼ˆ2026ã£ã½ã„çŸ¥è­˜ï¼‰ğŸ†•âœ¨

* Node.js ã¯ **v24 ãŒ Active LTS**ã€v25 ã¯ Current ã§é€²ã‚“ã§ã‚‹ã‚ˆï¼ˆ2026-01-12æ™‚ç‚¹ã®æ›´æ–°ã‚ã‚Šï¼‰ã€‚([Node.js][3])
* TypeScriptå´ã¯ã€Nodeã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å‘¨ã‚Šã«åˆã‚ã›ãŸ `--module node18` ã®ã‚ˆã†ãªâ€œå®‰å®šç‚¹â€ãŒå¢—ãˆã¦ãã¦ã‚‹ï¼ˆTS 5.8ï¼‰ã€‚([TypeScript][4])
* TS 5.9 ã§ã¯ `import defer` ã¿ãŸã„ãªæ–°ã—ã„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ©Ÿèƒ½ã‚µãƒãƒ¼ãƒˆã‚‚å…¥ã£ã¦ãã¦ã‚‹ã‚ˆï¼ˆå®Ÿè¡Œç’°å¢ƒå´ã®å¯¾å¿œãŒå‰æï¼‰ã€‚([TypeScript][5])

---

## ã¾ã¨ã‚ğŸ€âœ¨

* Aggregateã¯ **ã€Œä¸å¤‰æ¡ä»¶ã‚’å®ˆã‚‹è²¬ä»»ç¯„å›²ã€**ã®å˜ä½ã ã‚ˆğŸ›¡ï¸
* å¢ƒç•Œã¯ **â€œåŒæ™‚ã«å¿…ãšæ•´åˆã™ã‚‹ã¹ãç¯„å›²â€**ã¨ã—ã¦æ±ºã‚ã‚‹ã®ãŒã‚³ãƒ„ğŸ§ âœ¨([cqrs.com][2])
* ã‚¤ãƒ™ãƒ³ãƒˆã‚½ãƒ¼ã‚·ãƒ³ã‚°ã§ã¯ **1é›†ç´„ï¼1ã‚¹ãƒˆãƒªãƒ¼ãƒ ** ã®æ„Ÿè¦šãŒè¶…å¤§äº‹ğŸ“¼ğŸ˜Š([Event Sourcing Guide][1])

---

## æ¬¡ç« ã®äºˆå‘ŠğŸ“˜âœï¸

æ¬¡ã¯ã€ã‚¤ãƒ™ãƒ³ãƒˆãŒçŠ¶æ…‹ã‚’ã©ã†å¤‰ãˆã‚‹ã‹ã‚’ **æ‰‹æ›¸ãã§è¦‹ãˆã‚‹åŒ–** ã—ã¦ã€å¢ƒç•Œã®å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯ã‚‚ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã‚ˆğŸ”âœ¨

[1]: https://www.eventsourcing.dev/best-practices/designing-aggregates "Designing Aggregates - Best Practices - Event Sourcing Guide"
[2]: https://www.cqrs.com/deeper-insights/consistency-boundaries/ "Consistency Boundaries - CQRS, Event Sourcing & co."
[3]: https://nodejs.org/en/about/previous-releases "Node.js â€” Node.js Releases"
[4]: https://www.typescriptlang.org/docs/handbook/release-notes/typescript-5-8.html "TypeScript: Documentation - TypeScript 5.8"
[5]: https://www.typescriptlang.org/docs/handbook/release-notes/typescript-5-9.html "TypeScript: Documentation - TypeScript 5.9"
