# 16ç« ï¼šCommandå‡¦ç†ã®â€œå‹â€â‘ ï¼ˆLoad â†’ Decide â†’ Appendï¼‰ğŸ“®âœ…

## ã“ã®ç« ã§ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã“ã¨ğŸ¯âœ¨

* ã€Œã‚³ãƒãƒ³ãƒ‰ã‚’å—ã‘ãŸã‚‰ã€ã„ã¤ã‚‚ã“ã®é †ç•ªã§æ›¸ãï¼ã€ã£ã¦ã„ã† **å®‰å…¨ãªå‹** ã‚’ä½œã‚Œã‚‹ğŸ§°ğŸ’–
* **Loadï¼ˆéå»ã‚¤ãƒ™ãƒ³ãƒˆèª­ã‚€ï¼‰â†’ Decideï¼ˆåˆ¤æ–­ã—ã¦æ–°ã‚¤ãƒ™ãƒ³ãƒˆä½œã‚‹ï¼‰â†’ Appendï¼ˆä¿å­˜ï¼‰** ãŒã‚¹ãƒ©ã‚¹ãƒ©æ›¸ã‘ã‚‹ğŸ”âœ…
* â€œè¨­è¨ˆã£ã½ã„ã“ã¨â€ãŒåˆã‚ã¦ã§ã‚‚ã€è¿·å­ã«ãªã‚‰ãšã«å®Ÿè£…ã§ãã‚‹ğŸ§­ğŸŒ¸

---

## ã¾ãšã¯è¶…ã‚¤ãƒ¡ãƒ¼ã‚¸ğŸŒˆğŸ§ 

ã‚¤ãƒ™ãƒ³ãƒˆã‚½ãƒ¼ã‚·ãƒ³ã‚°ã®ã‚¢ãƒ—ãƒªã¯ã€ã–ã£ãã‚Šã“ã†å‹•ãã‚ˆğŸ‘‡âœ¨

1. **Load**ï¼šä»Šã¾ã§ã®å‡ºæ¥äº‹ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆï¼‰ã‚’å…¨éƒ¨èª­ã‚€ğŸ“š
2. **Decide**ï¼šãƒ«ãƒ¼ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã€Œæ–°ã—ã„å‡ºæ¥äº‹ã€ã‚’ä½œã‚‹ğŸ§ ğŸ’¡
3. **Append**ï¼šãã®å‡ºæ¥äº‹ã‚’ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ãƒˆã‚¢ã«ç©ã‚€ğŸ“¦âœ…

ã€ŒçŠ¶æ…‹ã‚’ç›´æ¥ã„ã˜ã‚‹ã€ã‚“ã˜ã‚ƒãªãã¦ã€**å‡ºæ¥äº‹ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆï¼‰ã‚’è¿½åŠ ã™ã‚‹**ã®ãŒä¸»å½¹ã ã‚ˆğŸ¬âœ¨

---

## â€œå‹â€ãŒå¿…è¦ãªç†ç”±ï¼ˆè¶…ãŸã„ã›ã¤ï¼‰ğŸ¥ºğŸ§·

æœ€åˆã®ã†ã¡ã¯ã€ã‚³ãƒãƒ³ãƒ‰å‡¦ç†ã£ã¦â€¦

* ã©ã“ã§ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã®ï¼ŸğŸ¤”
* ã„ã¤ä¿å­˜ã™ã‚‹ã®ï¼ŸğŸ˜µ
* çŠ¶æ…‹ã¯ã©ã“ã§ä½œã‚‹ã®ï¼ŸğŸŒ€

ã£ã¦ãªã‚ŠãŒã¡ğŸ’¦

ã ã‹ã‚‰ã“ã®ç« ã§ã¯ã€**æ¯å›åŒã˜æ‰‹é †**ã§æ›¸ã‘ã‚‹ã‚ˆã†ã«ã€å‡¦ç†ã®å½¢ã‚’å›ºå®šã—ã¡ã‚ƒã†ã‚ˆğŸ§°ğŸ’

---

## 2026å¹´ã®â€œå‘¨è¾ºã®æœ€æ–°â€ã¡ã‚‡ã„ãƒ¡ãƒ¢ğŸ—“ï¸âœ¨ï¼ˆèª­ã‚€ã ã‘ã§OKï¼‰

* Node.js ã¯ **v24 ãŒ Active LTS**ï¼ˆ2026å¹´1æœˆæ™‚ç‚¹ï¼‰ã§ã€LTSæœ€æ–°ç‰ˆã¯ **v24.13.0** ãŒæ¡ˆå†…ã•ã‚Œã¦ã‚‹ã‚ˆğŸ“Œ([Node.js][1])
* TypeScript ã¯ **5.9 ã®ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆ**ãŒå…¬é–‹ã•ã‚Œã¦ã„ã¦ã€`import defer` ãªã©æ–°ã—ã„ä»•æ§˜è¿½å¾“ã‚‚é€²ã‚“ã§ã‚‹ã‚ˆğŸ§ âœ¨([TypeScript][2])
* VS Code ã¯ **2026å¹´1æœˆã® Insiders 1.109** æ›´æ–°æƒ…å ±ãŒå‡ºã¦ã‚‹ã‚ˆğŸªŸâœ¨([Visual Studio Code][3])
* ãƒ†ã‚¹ãƒˆã¯ Vitest ãŒ **4.0 ãƒªãƒªãƒ¼ã‚¹**ã•ã‚Œã¦ã€ç§»è¡Œã‚¬ã‚¤ãƒ‰ã‚‚æ›´æ–°ã•ã‚Œã¦ã‚‹ã‚ˆğŸ§ªâœ¨([Vitest][4])

ï¼ˆã“ã®ç« ã®ã‚³ãƒ¼ãƒ‰è‡ªä½“ã¯ã€æœ€æ–°æ©Ÿèƒ½ã‚´ãƒªã‚´ãƒªã˜ã‚ƒãªãã¦ã€Œå‹ã€ã‚’è¦šãˆã‚‹ã®ãŒç›®çš„ã ã‚ˆğŸ˜Šï¼‰

---

## ä»Šå›ã®é¡Œæï¼šãƒŸãƒ‹ãƒ»ã‚«ãƒ¼ãƒˆğŸ›’âœ¨

ã€Œã‚«ãƒ¼ãƒˆã«å•†å“ã‚’è¿½åŠ ã™ã‚‹ã€ã‚³ãƒãƒ³ãƒ‰ã§ç·´ç¿’ã™ã‚‹ã‚ˆï¼

* Commandï¼š`AddItemToCart` ğŸ“®
* Eventï¼š`ItemAddedToCart` ğŸ“œ
* Stateï¼š`CartState` ğŸ§º

---

## å…¨ä½“å›³ï¼ˆã“ã®ç« ã®ã‚´ãƒ¼ãƒ«ï¼‰ğŸ—ºï¸âœ¨

![ã‚³ãƒãƒ³ãƒ‰ãƒãƒ³ãƒ‰ãƒ©ãƒ•ãƒ­ãƒ¼](./picture/es_ts_study_016_handler.png)


```text
Commandï¼ˆãŠé¡˜ã„ï¼‰  â†’  Handler
                     â”œâ”€ Load   : eventStore.readStream()
                     â”œâ”€ Rehydrate : applyã§çŠ¶æ…‹ã‚’å¾©å…ƒ
                     â”œâ”€ Decide : ãƒ«ãƒ¼ãƒ«ç¢ºèª â†’ æ–°Eventä½œæˆ
                     â””â”€ Append : eventStore.appendToStream()
```

```mermaid
sequenceDiagram
    participant User
    participant Handler
    participant Store as EventStore
    participant Domain as Domain (Decide)

    User->>Handler: Command ğŸ“®
    Handler->>Store: readStream(id) ğŸ“š
    Store-->>Handler: Event[]
    Handler->>Handler: Rehydrate (Stateç”Ÿæˆ) ğŸ”
    Handler->>Domain: decide(State, Command) ğŸ§ 
    Domain-->>Handler: Result<NewEvent[], Error>
    Handler->>Store: appendToStream(id, version, NewEvent[]) ğŸ“¦
    Handler-->>User: Result ğŸš¦
```

---

## 1) å‹ã¥ãã‚Šã®æº–å‚™ï¼šå…±é€šã®å‹ï¼ˆCommand / Event / Resultï¼‰ğŸ§©âœ¨

```ts
// 1) Commandï¼ˆå…¥åŠ›ï¼‰ğŸ“®
export type Command = {
  type: string;
  // ã ã„ãŸã„ commandId ã¯å¾Œã§å†ªç­‰æ€§ã§ä½¿ã†ã“ã¨ãŒå¤šã„ã‚ˆï¼ˆã“ã®ç« ã§ã¯æ¸©å­˜ã§OKï¼‰
  commandId: string;
  at: string; // ISOæ–‡å­—åˆ—ï¼ˆä¾‹: new Date().toISOString()ï¼‰
};

// 2) DomainEventï¼ˆå‡ºæ¥äº‹ï¼‰ğŸ“œ
export type DomainEvent<TType extends string, TData> = {
  type: TType;
  data: TData;
  meta: {
    eventId: string;
    at: string;         // ã„ã¤èµ·ããŸï¼Ÿ
    commandId: string;  // ã©ã®ã‚³ãƒãƒ³ãƒ‰ãŒèµ·ã“ã—ãŸï¼Ÿ
  };
};

// 3) è¶…ã‚·ãƒ³ãƒ—ãƒ«ãª Resultï¼ˆä¾‹å¤–ã¾ã¿ã‚Œé˜²æ­¢ã®å…¥å£ï¼‰ğŸš¦
// â€» ãã¡ã‚“ã¨ã‚„ã‚‹ã®ã¯å¾Œã®ç« ã§æ·±æ˜ã‚Šã™ã‚‹ã‚ˆâœ¨
export type Result<T, E> =
  | { ok: true; value: T }
  | { ok: false; error: E };

export const ok = <T>(value: T): Result<T, never> => ({ ok: true, value });
export const err = <E>(error: E): Result<never, E> => ({ ok: false, error });
```

---

## 2) EventStoreï¼ˆæœ€å°ï¼‰ğŸ“¦âœ¨ï¼šRead ã¨ Append ã ã‘

ã“ã®ç« ã®ä¸»å½¹ã¯ã€Œå‹ã€ã ã‹ã‚‰ã€ã¾ãšã¯ **ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒª**ã§OKğŸ‘ŒğŸŒ¸

```ts
export type StreamId = string;

export type StoredEvent = {
  streamId: StreamId;
  version: number; // 0,1,2... ã®é€£ç•ª
  event: DomainEvent<string, unknown>;
};

export type ReadStreamResult = {
  events: StoredEvent[];
  lastVersion: number; // æœ€å¾Œã®versionï¼ˆã‚¤ãƒ™ãƒ³ãƒˆ0ä»¶ãªã‚‰ -1ï¼‰
};

export interface EventStore {
  readStream(streamId: StreamId): Promise<ReadStreamResult>;

  // expectedVersion ã¯å¾Œã§ã€Œç«¶åˆå¯¾ç­–ã€ã§å¤§æ´»èºã™ã‚‹ã‚ˆğŸ”’ï¼ˆã“ã®ç« ã§ã¯ "å‹" ã¨ã—ã¦å…¥ã‚Œã¦ãŠãï¼‰
  appendToStream(
    streamId: StreamId,
    expectedVersion: number,
    events: DomainEvent<string, unknown>[]
  ): Promise<{ newLastVersion: number }>;
}

export class InMemoryEventStore implements EventStore {
  private streams = new Map<StreamId, StoredEvent[]>();

  async readStream(streamId: StreamId): Promise<ReadStreamResult> {
    const events = this.streams.get(streamId) ?? [];
    const lastVersion = events.length === 0 ? -1 : events[events.length - 1].version;
    return { events, lastVersion };
  }

  async appendToStream(
    streamId: StreamId,
    expectedVersion: number,
    newEvents: DomainEvent<string, unknown>[]
  ): Promise<{ newLastVersion: number }> {
    const current = this.streams.get(streamId) ?? [];
    const currentLast = current.length === 0 ? -1 : current[current.length - 1].version;

    // â˜…ã“ã“ãŒã€Œå‹ã€ï¼šã“ã®ç« ã§ã¯è»½ããƒã‚§ãƒƒã‚¯ã™ã‚‹ã ã‘ï¼ˆæœ¬æ ¼é‹ç”¨ã¯å¾Œã®ç« ï¼‰
    if (currentLast !== expectedVersion) {
      throw new Error(
        `ConcurrencyError: expectedVersion=${expectedVersion}, actual=${currentLast}`
      );
    }

    let version = currentLast;
    const stored: StoredEvent[] = newEvents.map((e) => {
      version += 1;
      return { streamId, version, event: e };
    });

    const next = current.concat(stored);
    this.streams.set(streamId, next);

    const newLastVersion = next.length === 0 ? -1 : next[next.length - 1].version;
    return { newLastVersion };
  }
}
```

---

## 3) Aggregateï¼ˆçŠ¶æ…‹ï¼‰ã¨ Applyï¼ˆå¾©å…ƒï¼‰ğŸ”ğŸ§ 

## ã‚«ãƒ¼ãƒˆã®çŠ¶æ…‹ğŸ›’

```ts
export type CartState = {
  exists: boolean;
  items: Record<string, number>; // sku -> qty
};

export const emptyCart = (): CartState => ({
  exists: false,
  items: {},
});
```

## ã‚¤ãƒ™ãƒ³ãƒˆå®šç¾©ğŸ“œ

```ts
export type CartCreated = DomainEvent<"CartCreated", { cartId: string }>;
export type ItemAddedToCart = DomainEvent<
  "ItemAddedToCart",
  { cartId: string; sku: string; qty: number }
>;

export type CartEvent = CartCreated | ItemAddedToCart;
```

## Applyï¼ˆã‚¤ãƒ™ãƒ³ãƒˆ1ã¤ã§çŠ¶æ…‹ã‚’æ›´æ–°ï¼‰ğŸ§·

```ts
export const applyCartEvent = (state: CartState, event: CartEvent): CartState => {
  switch (event.type) {
    case "CartCreated":
      return { ...state, exists: true };

    case "ItemAddedToCart": {
      const prev = state.items[event.data.sku] ?? 0;
      return {
        ...state,
        items: { ...state.items, [event.data.sku]: prev + event.data.qty },
      };
    }
  }
};
```

## Rehydrateï¼ˆã‚¤ãƒ™ãƒ³ãƒˆåˆ—â†’ç¾åœ¨çŠ¶æ…‹ï¼‰ğŸ”âœ¨

```ts
export const rehydrateCart = (events: CartEvent[]): CartState => {
  return events.reduce((s, e) => applyCartEvent(s, e), emptyCart());
};
```

---

## 4) Decideï¼ˆåˆ¤æ–­ï¼‰ğŸ§ ğŸ’¡ï¼šãƒ«ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯ â†’ æ–°ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä½œã‚‹

ã“ã“ãŒã€Œè¨­è¨ˆã£ã½ã•ã€ã®å…¥ã‚Šå£ã ã‚ˆğŸŒ¸
**Decide ã¯ â€œæ–°ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿”ã™ã ã‘â€** ã«ã™ã‚‹ã¨ã€ã‚ã£ã¡ã‚ƒèª­ã¿ã‚„ã™ã„âœ¨

## Commandå®šç¾©ğŸ“®

```ts
export type AddItemToCart = Command & {
  type: "AddItemToCart";
  cartId: string;
  sku: string;
  qty: number;
};

export type CreateCart = Command & {
  type: "CreateCart";
  cartId: string;
};

export type CartCommand = CreateCart | AddItemToCart;
```

## ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼ï¼ˆæ–‡å­—åˆ—ã§ã‚‚OKã ã‘ã©ã€å‹ã«ã™ã‚‹ã¨ä¾¿åˆ©ï¼‰ğŸš§

```ts
export type CartError =
  | { type: "CartNotFound" }
  | { type: "CartAlreadyExists" }
  | { type: "InvalidQuantity"; message: string };
```

## Decideé–¢æ•°ï¼ˆã‚³ãƒãƒ³ãƒ‰ã”ã¨ï¼‰âœ¨

```ts
const makeMeta = (command: Command) => ({
  eventId: crypto.randomUUID(),
  at: new Date().toISOString(),
  commandId: command.commandId,
});

export const decideCreateCart = (
  state: CartState,
  cmd: CreateCart
): Result<CartCreated[], CartError> => {
  if (state.exists) return err({ type: "CartAlreadyExists" });

  const event: CartCreated = {
    type: "CartCreated",
    data: { cartId: cmd.cartId },
    meta: makeMeta(cmd),
  };
  return ok([event]);
};

export const decideAddItemToCart = (
  state: CartState,
  cmd: AddItemToCart
): Result<ItemAddedToCart[], CartError> => {
  if (!state.exists) return err({ type: "CartNotFound" });
  if (!Number.isInteger(cmd.qty) || cmd.qty <= 0) {
    return err({ type: "InvalidQuantity", message: "qty ã¯ 1 ä»¥ä¸Šã®æ•´æ•°ã ã‚ˆğŸ¥º" });
  }

  const event: ItemAddedToCart = {
    type: "ItemAddedToCart",
    data: { cartId: cmd.cartId, sku: cmd.sku, qty: cmd.qty },
    meta: makeMeta(cmd),
  };
  return ok([event]);
};
```

---

## 5) ã“ã“ãŒæœ¬é¡Œï¼Handlerï¼ˆLoad â†’ Decide â†’ Appendï¼‰ğŸ“®âœ…

ã“ã® â€œå‹â€ ã‚’ã€ã¾ã‚‹ã”ã¨ãƒ†ãƒ³ãƒ—ãƒ¬ã¨ã—ã¦è¦šãˆã¡ã‚ƒãŠã†ğŸ§°ğŸ’

```ts
const cartStreamId = (cartId: string) => `cart-${cartId}`;

export type HandleResult =
  | { ok: true }
  | { ok: false; error: CartError };

export const handleCartCommand = async (
  store: EventStore,
  cmd: CartCommand
): Promise<HandleResult> => {
  // â‘  Loadï¼šéå»ã‚¤ãƒ™ãƒ³ãƒˆã‚’èª­ã‚€ğŸ“š
  const streamId = cartStreamId(cmd.cartId);
  const { events: stored, lastVersion } = await store.readStream(streamId);

  // â‘¡ Rehydrateï¼šçŠ¶æ…‹ã‚’å¾©å…ƒã™ã‚‹ğŸ”
  const domainEvents = stored.map((x) => x.event) as CartEvent[];
  const state = rehydrateCart(domainEvents);

  // â‘¢ Decideï¼šãƒ«ãƒ¼ãƒ«ç¢ºèª â†’ æ–°ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆğŸ§ âœ¨
  const decided =
    cmd.type === "CreateCart"
      ? decideCreateCart(state, cmd)
      : decideAddItemToCart(state, cmd);

  if (!decided.ok) {
    return { ok: false, error: decided.error };
  }

  // â‘£ Appendï¼šã‚¤ãƒ™ãƒ³ãƒˆã‚’ä¿å­˜ğŸ“¦âœ…
  // expectedVersion ã¯ã€Œèª­ã‚“ã æ™‚ç‚¹ã®æœ€å¾Œã®versionã€
  await store.appendToStream(streamId, lastVersion, decided.value);

  return { ok: true };
};
```

---

## ãƒŸãƒ‹æ¼”ç¿’â‘ ğŸ“âœ¨ï¼šã€ŒCreate â†’ AddItemã€ã¾ã§é€šã—ã¦ã¿ã‚ˆã†ğŸ¬

```ts
import { InMemoryEventStore } from "./eventStore";
import { handleCartCommand } from "./handler";

const store = new InMemoryEventStore();

const cartId = "C-001";

const r1 = await handleCartCommand(store, {
  type: "CreateCart",
  commandId: crypto.randomUUID(),
  at: new Date().toISOString(),
  cartId,
});

const r2 = await handleCartCommand(store, {
  type: "AddItemToCart",
  commandId: crypto.randomUUID(),
  at: new Date().toISOString(),
  cartId,
  sku: "SKU-AAA",
  qty: 2,
});

console.log({ r1, r2 });
```

æœŸå¾…ï¼šã©ã£ã¡ã‚‚ `{ ok: true }` ã«ãªã‚Œã°OKâœ…ğŸ‰

---

## ãƒŸãƒ‹æ¼”ç¿’â‘¡ğŸ§©âœ¨ï¼šã‚ã–ã¨å¤±æ•—ã•ã›ã‚ˆã†ğŸ™…â€â™€ï¸

æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’æŠ•ã’ãŸã‚‰ã€ã©ã†ãªã‚‹ï¼ŸğŸ‘€

* ã¾ã ä½œã£ã¦ãªã„ `cartId` ã« `AddItemToCart`
* `qty: 0` ã§ `AddItemToCart`

ã€ŒLoad â†’ Decide â†’ Appendã€ã®ã©ã“ã§æ­¢ã¾ã‚‹ã‹ã€è¨€è‘‰ã§èª¬æ˜ã—ã¦ã¿ã¦ã­ğŸ—£ï¸ğŸ’•

---

## ãƒ†ã‚¹ãƒˆã®è¶…ãƒŸãƒ‹ç‰ˆï¼ˆVitestï¼‰ğŸ§ªâœ¨

Vitest 4.x ã§OKï¼([Vitest][4])

```ts
import { describe, it, expect } from "vitest";
import { InMemoryEventStore } from "./eventStore";
import { handleCartCommand } from "./handler";

describe("Cart command handler", () => {
  it("CreateCart â†’ ok", async () => {
    const store = new InMemoryEventStore();
    const cartId = "C-100";

    const res = await handleCartCommand(store, {
      type: "CreateCart",
      commandId: crypto.randomUUID(),
      at: new Date().toISOString(),
      cartId,
    });

    expect(res.ok).toBe(true);
  });

  it("AddItemToCart before create â†’ CartNotFound", async () => {
    const store = new InMemoryEventStore();

    const res = await handleCartCommand(store, {
      type: "AddItemToCart",
      commandId: crypto.randomUUID(),
      at: new Date().toISOString(),
      cartId: "C-999",
      sku: "SKU-ZZZ",
      qty: 1,
    });

    expect(res.ok).toBe(false);
    if (!res.ok) expect(res.error.type).toBe("CartNotFound");
  });
});
```

---

## AIæ‹¡å¼µã«é ¼ã‚€ã¨ãã®â€œå‹ã¡ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ€ä¾‹ğŸ¤–âœ¨

## â‘  å©ãå°ã‚’ä½œã‚‰ã›ã‚‹ï¼ˆçŸ­ãã¦å¼·ã„ï¼‰ğŸ§°

```text
ã‚¤ãƒ™ãƒ³ãƒˆã‚½ãƒ¼ã‚·ãƒ³ã‚°ã® Command Handler ã‚’ TypeScript ã§å®Ÿè£…ã—ãŸã„ã§ã™ã€‚
è¦ä»¶:
- å‹: Load â†’ Rehydrate â†’ Decide â†’ Append
- InMemoryEventStoreï¼ˆreadStream / appendToStream expectedVersion ä»˜ãï¼‰
- Cart: CreateCart / AddItemToCart
- Decide ã¯ Result å‹ã§ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™
å‡ºåŠ›:
- ãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²æ¡ˆã¨ TypeScript ã‚³ãƒ¼ãƒ‰
æ³¨æ„:
- Decide ã¯çŠ¶æ…‹ã‚’ç›´æ¥å¤‰æ›´ã›ãšã€æ–°ã‚¤ãƒ™ãƒ³ãƒˆé…åˆ—ã‚’è¿”ã™
```

## â‘¡ ãƒ¬ãƒ“ãƒ¥ãƒ¼è¦³ç‚¹ã‚’å‡ºã•ã›ã‚‹ğŸ‘€âœ¨

```text
ã“ã®ãƒãƒ³ãƒ‰ãƒ©å®Ÿè£…ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ã€‚
è¦³ç‚¹:
- Load/Decide/Append ã®è²¬å‹™ãŒæ··ã–ã£ã¦ãªã„ï¼Ÿ
- Decide ãŒ â€œæ–°ã‚¤ãƒ™ãƒ³ãƒˆç”Ÿæˆâ€ ã«é–‰ã˜ã¦ã‚‹ï¼Ÿ
- apply/rehydrate ã®æ¼ã‚ŒãŒèµ·ããã†ï¼Ÿ
- expectedVersion ã®ä½¿ã„æ–¹ã¯è‡ªç„¶ï¼Ÿ
- å‹ã®å®‰å…¨æ€§ï¼ˆevent/command ã® unionï¼‰ãŒæ´»ãã¦ã‚‹ï¼Ÿ
```

---

## ã‚ˆãã‚ã‚‹ãƒŸã‚¹é›†ï¼ˆã“ã“ã ã‘æ³¨æ„âš ï¸ğŸ¥ºï¼‰

* **Decide ã§ä¿å­˜ã—ã¡ã‚ƒã†**ï¼šDecide ã¯ â€œæ–°ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä½œã‚‹ã ã‘â€ ã«ã™ã‚‹ğŸ§ âœ¨
* **Load ã›ãšã«çŠ¶æ…‹ã‚’ä¿¡ã˜ã‚‹**ï¼šå¿…ãšã‚¤ãƒ™ãƒ³ãƒˆã‹ã‚‰å¾©å…ƒã™ã‚‹ğŸ”
* **apply ã®æ›¸ãå¿˜ã‚Œ**ï¼šã‚¤ãƒ™ãƒ³ãƒˆå¢—ã‚„ã—ãŸã‚‰ apply ã‚‚å¢—ã‚„ã™ğŸ“Œ
* **ã‚¤ãƒ™ãƒ³ãƒˆã« â€œçŠ¶æ…‹â€ ã‚’å…¥ã‚Œã™ãã‚‹**ï¼šå‡ºæ¥äº‹ã®äº‹å®Ÿã«å¯„ã›ã‚‹ğŸ±ï¼ˆç››ã‚Šã™ãæ³¨æ„ï¼ï¼‰

---

## ã¾ã¨ã‚ğŸ“Œâœ¨

* Commandå‡¦ç†ã¯ **Load â†’ Decide â†’ Append** ã®å‹ã§å›ºå®šã™ã‚‹ã¨å®‰å¿ƒğŸ˜ŒğŸ’–
* **Decide ã¯ â€œæ–°ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿”ã™â€** ã ã‘ã«ã™ã‚‹ã¨ã€è¨­è¨ˆãŒæ€¥ã«ã‚­ãƒ¬ã‚¤ã«ãªã‚‹âœ¨
* â€œçŠ¶æ…‹â€ ã¯ **ã‚¤ãƒ™ãƒ³ãƒˆåˆ—ã‹ã‚‰å¾©å…ƒï¼ˆRehydrateï¼‰** ã—ã¦ä½œã‚‹ğŸ”âœ…

æ¬¡ã®ç« ã§ã¯ã€ã“ã® Decide ã®ä¸­ã§ **ä¸å¤‰æ¡ä»¶ã§ã¡ã‚ƒã‚“ã¨å¼¾ã**ï¼ˆã‚¨ãƒ©ãƒ¼ã®æ‰±ã„ã‚‚ãã‚Œã„ã«ã™ã‚‹ï¼‰ã‚’ã‚„ã‚‹ã‚ˆğŸ›¡ï¸ğŸš§

[1]: https://nodejs.org/en/about/previous-releases?utm_source=chatgpt.com "Node.js Releases"
[2]: https://www.typescriptlang.org/docs/handbook/release-notes/typescript-5-9.html?utm_source=chatgpt.com "Documentation - TypeScript 5.9"
[3]: https://code.visualstudio.com/updates/v1_109?utm_source=chatgpt.com "January 2026 Insiders (version 1.109)"
[4]: https://vitest.dev/blog/vitest-4?utm_source=chatgpt.com "Vitest 4.0 is out!"
