# ç¬¬5ç« ï¼šæœ€å°é¡Œæã‚’æ±ºã‚ã‚ˆã†ï¼ˆæ•™æã®ãƒŸãƒ‹ã‚¢ãƒ—ãƒªè¨­è¨ˆï¼‰ğŸ°ğŸ§‘â€ğŸ’»

## ã“ã®ç« ã®ã‚´ãƒ¼ãƒ«ğŸ¯âœ¨

* ã€Œå†ªç­‰æ€§ãŒå¿…è¦ã«ãªã‚‹å ´æ‰€ã€ãŒãƒãƒƒã‚­ãƒªè¦‹ãˆã‚‹ãƒŸãƒ‹é¡Œæã‚’æ±ºã‚ã‚‹ğŸ”ğŸ”
* ãšã£ã¨ä½¿ã„å›ã›ã‚‹ **â€œãƒŸãƒ‹æ³¨æ–‡APIâ€** ã®ä»•æ§˜ï¼ˆç™»å ´äººç‰©ãƒ»çŠ¶æ…‹ãƒ»APIï¼‰ã‚’1æšã«ã¾ã¨ã‚ã‚‹ğŸ“„ğŸ§
* æ¬¡ã®ç« ä»¥é™ã§ã€Œå†ªç­‰ã‚­ãƒ¼ã€ã€ŒåŒæ™‚å®Ÿè¡Œã€ã€Œã‚¨ãƒ©ãƒ¼è¨­è¨ˆã€ã‚’ä¹—ã›ã¦ã„ã‘ã‚‹åœŸå°ã‚’ä½œã‚‹ğŸ—ï¸ğŸ’–

![Concept](./picture/idem_ts_study_005_api_map.png)

---

## ã¾ãšçµè«–ï¼šé¡Œæã¯ã€ŒãƒŸãƒ‹æ³¨æ–‡APIã€ã§ã„ãã‚ˆğŸ°ğŸ§¾

ã“ã®æ•™æã§ã¯ã€å†ªç­‰æ€§ã®äº‹æ•…ãŒã„ã¡ã°ã‚“èµ·ãã‚„ã™ã„ â€œã“ã‚ã„æ“ä½œâ€ ã‚’å…¥ã‚ŒãŸã„ã®ã­ğŸ˜µğŸ’¦
ãã‚ŒãŒ **æ³¨æ–‡ä½œæˆ** ã¨ **æ”¯æ‰•ã„ç¢ºå®šï¼ˆã£ã½ã„å‡¦ç†ï¼‰** ğŸ’³âœ¨

* **æ³¨æ–‡ä½œæˆ**ï¼šé€£æ‰“ãƒ»å†é€ã§ã€Œæ³¨æ–‡ãŒ2å€‹ã§ããŸğŸ˜±ã€ãŒèµ·ãã‚„ã™ã„
* **æ”¯æ‰•ã„ç¢ºå®š**ï¼šã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã§ã€Œæ±ºæ¸ˆãŒ2å›èµ°ã£ãŸğŸ˜±ã€ã¿ãŸã„ãªæœ€æ‚ªãŒèµ·ãã†ã‚‹

ãã—ã¦ã“ã“ãŒãƒã‚¤ãƒ³ãƒˆğŸ‘‡
**Idempotency-Keyï¼ˆå†ªç­‰ã‚­ãƒ¼ï¼‰ãƒ˜ãƒƒãƒ€ãƒ¼** ã¯ã€POSTã¿ãŸã„ã«æœ¬æ¥â€œå†ªç­‰ã˜ã‚ƒãªã„æ“ä½œâ€ã‚’ã€ãƒªãƒˆãƒ©ã‚¤ã«å¼·ãã™ã‚‹ãŸã‚ã®ä»•çµ„ã¿ã¨ã—ã¦æ¨™æº–åŒ–ã®è­°è«–ãŒé€²ã‚“ã§ã‚‹ã‚ˆğŸ“œğŸ”‘ ([datatracker.ietf.org][1])

---

## ä»•æ§˜ã‚’â€œã¡ã£ã¡ã‚ƒãâ€ã—ã¦å‹ã¤ğŸ§ âœ‚ï¸âœ¨ï¼ˆã‚„ã‚‹ã“ã¨ / ã‚„ã‚‰ãªã„ã“ã¨ï¼‰

é¡ŒæãŒãƒ‡ã‚«ã„ã¨ã€å†ªç­‰æ€§ã®å­¦ç¿’ãŒãƒœãƒ¤ã‘ã‚‹ã®ğŸ¥º
ã“ã“ã¯å‰²ã‚Šåˆ‡ã£ã¦ã€**å­¦ç¿’ã«å¿…è¦ãªæœ€å°ã ã‘** ã«ã™ã‚‹ã‚ˆğŸ™†â€â™€ï¸ğŸŒ¸

### ã‚„ã‚‹ã“ã¨âœ…

* æ³¨æ–‡ã‚’ä½œã‚‹ï¼ˆæ³¨æ–‡IDãŒã§ãã‚‹ï¼‰ğŸ§¾
* æ³¨æ–‡ã®çŠ¶æ…‹ã‚’è¦‹ã‚Œã‚‹ï¼ˆä½œæˆã§ããŸï¼Ÿæ”¯æ‰•ã„æ¸ˆã¿ï¼Ÿï¼‰ğŸ‘€
* æ”¯æ‰•ã„ç¢ºå®šã‚’ã™ã‚‹ï¼ˆçŠ¶æ…‹ãŒå¤‰ã‚ã‚‹ï¼‰ğŸ’³â¡ï¸âœ…
* ï¼ˆå¾Œã§ï¼‰å†ªç­‰ã‚­ãƒ¼ã§ **äºŒé‡å®Ÿè¡Œã‚’é˜²ã** ğŸ”‘ğŸ”

### ã‚„ã‚‰ãªã„ã“ã¨âŒï¼ˆå…¨éƒ¨â€œä»Šã¯â€æ¨ã¦ã‚‹ï¼ï¼‰

* ãƒ­ã‚°ã‚¤ãƒ³èªè¨¼ï¼ˆJWTã¨ã‹ï¼‰ğŸ”’ğŸš«
* æœ¬ç‰©ã®æ±ºæ¸ˆã‚µãƒ¼ãƒ“ã‚¹é€£æºï¼ˆStripeç­‰ï¼‰ğŸŒğŸš«
* åœ¨åº«ãƒ»é…é€ãƒ»ãƒã‚¤ãƒ³ãƒˆãƒ»ã‚¯ãƒ¼ãƒãƒ³å…¨éƒ¨ğŸ«ğŸ“¦ğŸš«
* ç®¡ç†ç”»é¢ãƒ»UIï¼ˆAPIã ã‘ã§OKï¼‰ğŸ–¥ï¸ğŸš«

---

## ãƒŸãƒ‹é¡Œæã®ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ï¼ˆã“ã‚ŒãŒã‚ã‚‹ã¨ç†è§£ãŒçˆ†é€Ÿï¼‰ğŸ“–ğŸ’¨

ã€Œæ¨ã—ã‚°ãƒƒã‚ºé€šè²©ï¼ˆãƒŸãƒ‹ï¼‰ã€ã‚’æƒ³åƒã—ã¦ã­ğŸ›ï¸ğŸ’–
1å›ç›®ã®æ”¯æ‰•ã„ç¢ºå®šã§æˆåŠŸã—ã¦ã‚‹ã®ã«ã€é€šä¿¡ãŒé€”åˆ‡ã‚Œã¦è¿”äº‹ãŒå±Šã‹ãªã„â€¦ğŸ“¶ğŸ˜‡
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚‚ã†ä¸€å›æŠ¼ã™â†’ **åŒã˜å‡¦ç†ãŒ2å›èµ°ã‚‹** â†’ äº‹æ•…ğŸ’¥

ã ã‹ã‚‰ã€ã“ã®æ•™æã®ä¸»å½¹ã¯ã‚³ã‚³ğŸ‘‡
**ã€Œæ”¯æ‰•ã„ç¢ºå®šã€ã¿ãŸã„ãªå±é™ºæ“ä½œã‚’ã€åŒã˜ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½•å›é€ã£ã¦ã‚‚å£Šã‚Œãªã„ã‚ˆã†ã«ã™ã‚‹** ğŸ”ğŸ›¡ï¸

---

## ç™»å ´ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ï¼ˆå‹ï¼‰ã‚’æ±ºã‚ã‚ˆã†ğŸ§±âœ¨

ã¾ãšã¯â€œæ•™æã§ä½¿ã†è¾æ›¸â€ã‚’ä½œã‚‹æ„Ÿã˜ã ã‚ˆğŸ“šğŸ’•

### Orderï¼ˆæ³¨æ–‡ï¼‰

* `orderId`ï¼šæ³¨æ–‡IDï¼ˆã‚µãƒ¼ãƒãƒ¼ãŒä½œã‚‹æƒ³å®šï¼‰ğŸ†”
* `userId`ï¼šèª°ã®æ³¨æ–‡ã‹ğŸ‘¤
* `items`ï¼šä½•ã‚’è²·ã£ãŸã‹ğŸ§¸
* `amount`ï¼šåˆè¨ˆé‡‘é¡ğŸ’°
* `status`ï¼šæ³¨æ–‡ã®çŠ¶æ…‹ğŸš¦
* `createdAt` / `updatedAt`ï¼šä½œæˆãƒ»æ›´æ–°ğŸ•’

### OrderStatusï¼ˆçŠ¶æ…‹ï¼‰ğŸš¦

æœ€å°ã§ã“ã†ã™ã‚‹ã‚ˆğŸ‘‡ï¼ˆå¢—ã‚„ã—ãŸããªã£ã¦ã‚‚ä»Šã¯ã‚¬ãƒãƒ³ğŸ¥ºï¼‰

* `created`ï¼ˆæ³¨æ–‡ã§ããŸï¼ï¼‰ğŸ§¾
* `payment_pending`ï¼ˆæ”¯æ‰•ã„å‡¦ç†ä¸­ï¼‰â³
* `paid`ï¼ˆæ”¯æ‰•ã„ç¢ºå®šï¼‰âœ…ğŸ’³
* `payment_failed`ï¼ˆæ”¯æ‰•ã„å¤±æ•—ï¼‰âŒ

çŠ¶æ…‹é·ç§»ã¯ã“ã‚Œã ã‘ã§OKğŸ™†â€â™€ï¸âœ¨
`created â†’ payment_pending â†’ paid`
`created â†’ payment_pending â†’ payment_failed`

```mermaid
stateDiagram-v2
    [*] --> created: æ³¨æ–‡ä½œæˆ
    created --> payment_pending: æ”¯æ‰•ã„å‡¦ç†é–‹å§‹
    payment_pending --> paid: æˆåŠŸ
    payment_pending --> payment_failed: å¤±æ•—
    paid --> [*]
    payment_failed --> payment_pending: ãƒªãƒˆãƒ©ã‚¤
```

---

## APIã®å½¢ã‚’æ±ºã‚ã‚‹ï¼ˆã“ã®ç« ã®ãƒ¡ã‚¤ãƒ³ï¼‰ğŸŒğŸ§©

ã“ã“ã§ã®ç›®çš„ã¯ã€Œå†ªç­‰æ€§ã®å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆãŒè‡ªç„¶ã«å…¥ã‚‹APIã€ã«ã™ã‚‹ã“ã¨ã ã‚ˆğŸ”ğŸ’•

### ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸€è¦§ï¼ˆæœ€å°ã‚»ãƒƒãƒˆï¼‰ğŸ“Œ

1. **æ³¨æ–‡ä½œæˆ**

* `POST /orders`
* æ³¨æ–‡ã‚’1ã¤ä½œã‚‹ğŸ§¾ï¼ˆã“ã“ã¯äºŒé‡ä½œæˆãŒèµ·ãã‚„ã™ã„âš ï¸ï¼‰

2. **æ³¨æ–‡å–å¾—**

* `GET /orders/{orderId}`
* æ³¨æ–‡ã®çŠ¶æ…‹ã‚’è¦‹ã‚‹ğŸ‘€ï¼ˆå®‰å…¨ãƒ»å†ªç­‰å¯„ã‚Šï¼‰

3. **æ”¯æ‰•ã„ç¢ºå®šï¼ˆå±é™ºæ“ä½œğŸ”¥ï¼‰**

* `POST /orders/{orderId}/confirm-payment`
* æ”¯æ‰•ã„ç¢ºå®šã£ã½ã„ã“ã¨ã‚’ã™ã‚‹ğŸ’³âœ…ï¼ˆã“ã“ãŒå†ªç­‰æ€§ã®ä¸»æˆ¦å ´ğŸ”¥ï¼‰

4. **å†ªç­‰ã‚­ãƒ¼ã®ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆå¾Œã§å°å…¥ã™ã‚‹ç´„æŸï¼‰**

* `Idempotency-Key: <uuidãªã©>` ğŸ”‘
  ã“ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã¯ã€ŒåŒã˜æ“ä½œã‚’1å›æ‰±ã„ã«ã™ã‚‹ã€ãŸã‚ã«ä½¿ã†æµã‚ŒãŒã‚ˆãç´¹ä»‹ã•ã‚Œã‚‹ã‚ˆğŸ“œ ([datatracker.ietf.org][1])

---

## ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹ï¼ˆã‚¤ãƒ¡ãƒ¼ã‚¸ãŒæ¹§ãã‚„ã¤ï¼‰ğŸ§ âœ¨

### 1) æ³¨æ–‡ä½œæˆï¼šPOST /orders ğŸ§¾

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¾‹**

```json
{
  "userId": "u_123",
  "items": [
    { "sku": "cake_001", "qty": 1, "price": 480 },
    { "sku": "tea_002",  "qty": 2, "price": 200 }
  ]
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹ï¼ˆæˆåŠŸï¼‰**

```json
{
  "orderId": "o_1001",
  "status": "created",
  "amount": 880
}
```

ã“ã“ã§èµ·ããŒã¡ãªäº‹æ•…ğŸ˜±

* ãƒ¦ãƒ¼ã‚¶ãƒ¼é€£æ‰“ â†’ `o_1001` ã¨ `o_1002` ãŒã§ãã‚‹
* è¿”äº‹ãŒé…ã„ â†’ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒå†é€ â†’ äºŒé‡ä½œæˆ

---

### 2) æ³¨æ–‡å–å¾—ï¼šGET /orders/{orderId} ğŸ‘€

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹**

```json
{
  "orderId": "o_1001",
  "userId": "u_123",
  "status": "paid",
  "amount": 880,
  "updatedAt": "2026-01-29T12:34:56.000Z"
}
```

---

### 3) æ”¯æ‰•ã„ç¢ºå®šï¼šPOST /orders/{orderId}/confirm-payment ğŸ’³âœ…

ã“ã“ã¯ã€ŒåŒã˜æ“ä½œãŒ2å›èµ°ã£ã¦ã‚‚ã€çµæœãŒå£Šã‚Œãªã„ã€ã‚ˆã†ã«ã—ãŸã„ï¼ğŸ”ğŸ›¡ï¸

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¾‹ï¼ˆå†ªç­‰ã‚­ãƒ¼ã¤ãï¼‰**

```http
POST /orders/o_1001/confirm-payment
Idempotency-Key: 8a3e1c9b-0c3f-4a62-8f31-2e1f5d6c2a10
Content-Type: application/json

{
  "paymentMethod": "card"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹ï¼ˆæˆåŠŸï¼‰**

```json
{
  "orderId": "o_1001",
  "status": "paid",
  "paidAt": "2026-01-29T12:35:01.000Z"
}
```

ãƒã‚¤ãƒ³ãƒˆğŸ’¡

* 2å›ç›®ã‚‚åŒã˜ `Idempotency-Key` ãªã‚‰ã€**åŒã˜çµæœã‚’è¿”ã™**ï¼ˆå¾Œã§å®Ÿè£…ã™ã‚‹ã‚ˆğŸ”‘ï¼‰
* â€œPOSTã‚’å†ªç­‰ã«å¯„ã›ã‚‹â€è€ƒãˆæ–¹ã¨ã—ã¦ã€`Idempotency-Key` ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã®ã¯APIè¨­è¨ˆã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã¨ã—ã¦ã‚‚è¨€åŠã•ã‚Œã‚‹ã‚ˆğŸ“˜ ([schweizerischebundesbahnen.github.io][2])

---

## ã€Œæ•™æã®ãƒŸãƒ‹ã‚¢ãƒ—ãƒªã€è¨­è¨ˆå›³ã‚’1æšã«ã¾ã¨ã‚ã‚ˆã†ğŸ—ºï¸âœ¨

ã“ã“ã¾ã§æ±ºã‚ãŸã‚‰ã€ãƒãƒ¼ãƒˆï¼ˆor Markdownï¼‰ã«ã“ã‚Œã‚’æ›¸ã‘ã°å®ŒæˆğŸ‘ğŸ’•

### âœ…ãƒŸãƒ‹æ³¨æ–‡APIï¼šè¨­è¨ˆãƒ¡ãƒ¢ï¼ˆã‚³ãƒ”ãƒšç”¨ï¼‰ğŸ“

* ãƒªã‚½ãƒ¼ã‚¹ï¼šOrder
* çŠ¶æ…‹ï¼šcreated / payment_pending / paid / payment_failed
* APIï¼š

  * POST /ordersï¼ˆæ³¨æ–‡ä½œæˆï¼‰
  * GET /orders/{orderId}ï¼ˆæ³¨æ–‡å–å¾—ï¼‰
  * POST /orders/{orderId}/confirm-paymentï¼ˆæ”¯æ‰•ã„ç¢ºå®šï¼‰
* å†ªç­‰æ€§ã®å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆï¼š

  * POSTã¯ãã®ã¾ã¾ã ã¨äºŒé‡å®Ÿè¡ŒãŒèµ·ãã‚„ã™ã„
  * Idempotency-Key ã‚’å°å…¥ã—ã¦ã€ŒåŒã˜ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’1å›æ‰±ã„ã€ã«ã™ã‚‹

---

## OpenAPIé¢¨ã®å©ãå°ï¼ˆãƒŸãƒ‹ç‰ˆï¼‰ğŸ“„âœ¨

OpenAPIã¯ã€ŒAPIã®èª¬æ˜æ›¸ã€ã‚’æ©Ÿæ¢°ã«ã‚‚èª­ã‚ã‚‹å½¢ã«ã™ã‚‹ä»•æ§˜ã ã‚ˆğŸ“˜
3.1ç³»ã¯ç¶™ç¶šçš„ã«æ”¹å–„ã•ã‚Œã¦ã„ã¦ã€3.1.1 ã®ãƒªãƒªãƒ¼ã‚¹ã‚‚å‡ºã¦ã‚‹ã‚ˆğŸ› ï¸ ([GitHub][3])

ï¼ˆã¾ãšã¯â€œé›°å›²æ°—â€ã§OKï¼å®Œç’§ã«æ›¸ãå¿…è¦ãªã—ğŸ™†â€â™€ï¸ï¼‰

```yaml
openapi: 3.1.1
info:
  title: Mini Order API
  version: 0.1.0
paths:
  /orders:
    post:
      summary: Create an order
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [userId, items]
              properties:
                userId: { type: string }
                items:
                  type: array
                  items:
                    type: object
                    required: [sku, qty, price]
                    properties:
                      sku: { type: string }
                      qty: { type: integer, minimum: 1 }
                      price: { type: integer, minimum: 0 }
      responses:
        "201":
          description: Created
  /orders/{orderId}:
    get:
      summary: Get an order
      parameters:
        - name: orderId
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: OK
  /orders/{orderId}/confirm-payment:
    post:
      summary: Confirm payment (idempotent by Idempotency-Key)
      parameters:
        - name: orderId
          in: path
          required: true
          schema: { type: string }
        - name: Idempotency-Key
          in: header
          required: false
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [paymentMethod]
              properties:
                paymentMethod:
                  type: string
                  enum: [card]
      responses:
        "200":
          description: OK
        "409":
          description: Conflict
```

---

## AIæ´»ç”¨ã‚³ãƒ¼ãƒŠãƒ¼ğŸ¤–ğŸ’–ï¼ˆãã®ã¾ã¾è²¼ã£ã¦OKï¼‰

### â‘  OpenAPIã‚’â€œã‚‚ã†ã¡ã‚‡ã„ã¡ã‚ƒã‚“ã¨â€ã—ã¦ã‚‚ã‚‰ã†ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆğŸ“„âœ¨

* ç›®çš„ï¼šãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å‹ï¼ˆOrderï¼‰ã‚’componentsã«åˆ‡ã‚Šå‡ºã—ã¦æ•´ç†ã—ã¦ã‚‚ã‚‰ã†ğŸ§¹

```text
ã‚ãªãŸã¯OpenAPI 3.1ã®å°‚é–€å®¶ã§ã™ã€‚
æ¬¡ã®ãƒŸãƒ‹æ³¨æ–‡APIä»•æ§˜ã‚’ã€åˆå¿ƒè€…ã«ã‚‚èª­ã¿ã‚„ã™ã„OpenAPI 3.1.1 YAMLã«æ•´ç†ã—ã¦ãã ã•ã„ã€‚

- POST /orders: æ³¨æ–‡ä½œæˆã€‚201ã§ {orderId, status, amount} ã‚’è¿”ã™
- GET /orders/{orderId}: æ³¨æ–‡å–å¾—ã€‚200ã§ Order ã‚’è¿”ã™
- POST /orders/{orderId}/confirm-payment: æ”¯æ‰•ã„ç¢ºå®šã€‚Idempotency-Keyãƒ˜ãƒƒãƒ€ãƒ¼ã‚’å—ã‘å–ã‚Œã‚‹ã€‚200ã§ Order ã‚’è¿”ã™ã€‚ç«¶åˆã¯409

è¦ä»¶:
- components.schemas ã« Order / OrderItem / Error ã‚’ä½œã‚‹
- status ã¯ created/payment_pending/paid/payment_failed ã®enum
- amount/price ã¯æ•´æ•°ï¼ˆå††ï¼‰
- ä¾‹ï¼ˆexampleï¼‰ã‚‚å°‘ã—å…¥ã‚Œã‚‹
å‡ºåŠ›ã¯YAMLã ã‘ã«ã—ã¦
```

### â‘¡ â€œå†ªç­‰æ€§ãŒå¿…è¦ãªå ´æ‰€â€ã®ç¢ºèªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆğŸ”ğŸ”

```text
ã“ã®ãƒŸãƒ‹æ³¨æ–‡APIã§ã€å†ªç­‰æ€§ãŒç‰¹ã«å¿…è¦ãªæ“ä½œã‚’3ã¤æŒ™ã’ã¦ã€
ãã‚Œãã‚Œã€Œä½•ãŒäºŒé‡ã«ãªã‚‹ã¨å›°ã‚‹ã‹ã€ã‚’1è¡Œã§èª¬æ˜ã—ã¦ã€‚
ãã®ä¸Šã§ã€Idempotency-Keyæ–¹å¼ãŒåŠ¹ãç†ç”±ã‚’ã‚„ã•ã—ãèª¬æ˜ã—ã¦ã€‚
```

---

## ãƒŸãƒ‹æ¼”ç¿’ğŸ“ğŸ€ï¼ˆ10åˆ†ã§OKï¼‰

### æ¼”ç¿’Aï¼šAPIã®æ„å›³ã‚’1è¡Œã§æ›¸ã“ã†âœï¸

æ¬¡ã®3ã¤ã‚’ **1è¡Œãšã¤** æ›¸ã„ã¦ã¿ã¦ã­ğŸ‘‡

* POST /orders ã¯ä½•ã‚’ã™ã‚‹ï¼ŸğŸ§¾
* GET /orders/{orderId} ã¯ä½•ã‚’ã™ã‚‹ï¼ŸğŸ‘€
* confirm-payment ã¯ä½•ãŒæ€–ã„ï¼ŸğŸ˜±

### æ¼”ç¿’Bï¼šçŠ¶æ…‹é·ç§»ã‚’çŸ¢å°ã§æ›¸ã“ã†ğŸ”

* `created â†’ payment_pending â†’ paid`
* `created â†’ payment_pending â†’ payment_failed`

ã€Œå¤±æ•—ã—ãŸã‚‰ã©ã†æˆ»ã™ï¼Ÿã€ã¯æ¬¡ã®ç« ä»¥é™ã§ã‚„ã‚‹ã‚ˆğŸ§¯âœ¨

---

## ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆâœ…âœ¨

* [ ] ãƒŸãƒ‹é¡ŒæãŒ **å°ã•ã** ã¾ã¨ã¾ã£ã¦ã‚‹ï¼ˆã‚„ã‚‰ãªã„ã“ã¨ãŒæ±ºã¾ã£ã¦ã‚‹ï¼‰âœ‚ï¸
* [ ] ã€Œå†ªç­‰æ€§ãŒå¿…è¦ãªå ´æ‰€ã€ãŒ **APIã®å½¢ã¨ã—ã¦** å…¥ã£ã¦ã‚‹ï¼ˆconfirm-paymentï¼‰ğŸ”‘
* [ ] Order ã®çŠ¶æ…‹ãŒ **å°‘ãªã‚** ã§èª¬æ˜ã§ãã‚‹ğŸš¦
* [ ] OpenAPIã®å©ãå°ãŒã§ããŸğŸ“„

---

æ¬¡ç« ã‹ã‚‰ã€ã“ã®ãƒŸãƒ‹æ³¨æ–‡APIã« **HTTPã®å†ªç­‰æ€§ã®è€ƒãˆæ–¹** ã‚’é‡ã­ã¦ã„ãã‚ˆğŸŒğŸ”

[1]: https://datatracker.ietf.org/doc/draft-ietf-httpapi-idempotency-key-header/?utm_source=chatgpt.com "The Idempotency-Key HTTP Header Field"
[2]: https://schweizerischebundesbahnen.github.io/api-principles/restful/best-practices/?utm_source=chatgpt.com "Best Practices | API Principles"
[3]: https://github.com/OAI/OpenAPI-Specification/releases?utm_source=chatgpt.com "Releases Â· OAI/OpenAPI-Specification"

